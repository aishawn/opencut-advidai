{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/tabbar.tsx"],"sourcesContent":["\"use client\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Tab, tabs, useMediaPanelStore } from \"./store\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useEffect, useRef, useState } from \"react\";\n\nexport function TabBar() {\n  const { activeTab, setActiveTab } = useMediaPanelStore();\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const [showTopFade, setShowTopFade] = useState(false);\n  const [showBottomFade, setShowBottomFade] = useState(false);\n\n  const checkScrollPosition = () => {\n    const element = scrollRef.current;\n    if (!element) return;\n\n    const { scrollTop, scrollHeight, clientHeight } = element;\n    setShowTopFade(scrollTop > 0);\n    setShowBottomFade(scrollTop < scrollHeight - clientHeight - 1);\n  };\n\n  useEffect(() => {\n    const element = scrollRef.current;\n    if (!element) return;\n\n    checkScrollPosition();\n    element.addEventListener(\"scroll\", checkScrollPosition);\n    \n    const resizeObserver = new ResizeObserver(checkScrollPosition);\n    resizeObserver.observe(element);\n\n    return () => {\n      element.removeEventListener(\"scroll\", checkScrollPosition);\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  return (\n    <div className=\"flex relative\">\n      <div \n        ref={scrollRef}\n        className=\"h-full px-4 flex flex-col justify-start items-center gap-5 overflow-y-auto scrollbar-hidden relative w-full py-4\"\n      >\n        {(Object.keys(tabs) as Tab[]).map((tabKey) => {\n          const tab = tabs[tabKey];\n          return (\n            <div\n              className={cn(\n                \"flex z-[100] flex-col gap-0.5 items-center cursor-pointer\",\n                activeTab === tabKey\n                  ? \"text-primary !opacity-100\"\n                  : \"text-muted-foreground\"\n              )}\n              onClick={() => setActiveTab(tabKey)}\n              key={tabKey}\n            >\n              <Tooltip delayDuration={10}>\n                <TooltipTrigger asChild>\n                  <tab.icon className=\"size-[1.1rem]! opacity-100 hover:opacity-75\" />\n                </TooltipTrigger>\n                <TooltipContent\n                  side=\"right\"\n                  align=\"center\"\n                  variant=\"sidebar\"\n                  sideOffset={8}\n                >\n                  <div className=\"dark:text-base-gray-950 text-black text-sm font-medium leading-none dark:text-white\">\n                    {tab.label}\n                  </div>\n                </TooltipContent>\n              </Tooltip>\n            </div>\n          );\n        })}\n      </div>\n      \n      <FadeOverlay direction=\"top\" show={showTopFade} />\n      <FadeOverlay direction=\"bottom\" show={showBottomFade} />\n    </div>\n  );\n}\n\nfunction FadeOverlay({ direction, show }: { direction: \"top\" | \"bottom\", show: boolean }) {\n  return (\n    <div \n      className={cn(\n        \"absolute left-0 right-0 h-6 pointer-events-none z-[101] transition-opacity duration-200\",\n        direction === \"top\" && show\n          ? \"top-0 bg-gradient-to-b from-panel to-transparent\" \n          : \"bottom-0 bg-gradient-to-t from-panel to-transparent\"\n      )}\n    />\n  );\n}"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAKA;AATA;;;;;;AAWO,SAAS;IACd,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,GAAG,CAAA,GAAA,qKAAA,CAAA,qBAAkB,AAAD;IACrD,MAAM,YAAY,CAAA,GAAA,0QAAA,CAAA,SAAM,AAAD,EAAkB;IACzC,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,0QAAA,CAAA,WAAQ,AAAD,EAAE;IAC/C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,0QAAA,CAAA,WAAQ,AAAD,EAAE;IAErD,MAAM,sBAAsB;QAC1B,MAAM,UAAU,UAAU,OAAO;QACjC,IAAI,CAAC,SAAS;QAEd,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG;QAClD,eAAe,YAAY;QAC3B,kBAAkB,YAAY,eAAe,eAAe;IAC9D;IAEA,CAAA,GAAA,0QAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,UAAU,UAAU,OAAO;QACjC,IAAI,CAAC,SAAS;QAEd;QACA,QAAQ,gBAAgB,CAAC,UAAU;QAEnC,MAAM,iBAAiB,IAAI,eAAe;QAC1C,eAAe,OAAO,CAAC;QAEvB,OAAO;YACL,QAAQ,mBAAmB,CAAC,UAAU;YACtC,eAAe,UAAU;QAC3B;IACF,GAAG,EAAE;IAEL,qBACE,mTAAC;QAAI,WAAU;;0BACb,mTAAC;gBACC,KAAK;gBACL,WAAU;0BAET,AAAC,OAAO,IAAI,CAAC,qKAAA,CAAA,OAAI,EAAY,GAAG,CAAC,CAAC;oBACjC,MAAM,MAAM,qKAAA,CAAA,OAAI,CAAC,OAAO;oBACxB,qBACE,mTAAC;wBACC,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EACV,6DACA,cAAc,SACV,8BACA;wBAEN,SAAS,IAAM,aAAa;kCAG5B,cAAA,mTAAC,kJAAA,CAAA,UAAO;4BAAC,eAAe;;8CACtB,mTAAC,kJAAA,CAAA,iBAAc;oCAAC,OAAO;8CACrB,cAAA,mTAAC,IAAI,IAAI;wCAAC,WAAU;;;;;;;;;;;8CAEtB,mTAAC,kJAAA,CAAA,iBAAc;oCACb,MAAK;oCACL,OAAM;oCACN,SAAQ;oCACR,YAAY;8CAEZ,cAAA,mTAAC;wCAAI,WAAU;kDACZ,IAAI,KAAK;;;;;;;;;;;;;;;;;uBAbX;;;;;gBAmBX;;;;;;0BAGF,mTAAC;gBAAY,WAAU;gBAAM,MAAM;;;;;;0BACnC,mTAAC;gBAAY,WAAU;gBAAS,MAAM;;;;;;;;;;;;AAG5C;AAEA,SAAS,YAAY,EAAE,SAAS,EAAE,IAAI,EAAkD;IACtF,qBACE,mTAAC;QACC,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EACV,2FACA,cAAc,SAAS,OACnB,qDACA;;;;;;AAIZ","debugId":null}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/drag-overlay.tsx"],"sourcesContent":["import { Upload, Plus, Image } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface MediaDragOverlayProps {\n  isVisible: boolean;\n  isProcessing?: boolean;\n  progress?: number;\n  onClick?: () => void;\n  isEmptyState?: boolean;\n}\n\nexport function MediaDragOverlay({\n  isVisible,\n  isProcessing = false,\n  progress = 0,\n  onClick,\n  isEmptyState = false,\n}: MediaDragOverlayProps) {\n  if (!isVisible) return null;\n\n  const handleClick = (e: React.MouseEvent) => {\n    if (isProcessing || !onClick) return;\n    e.preventDefault();\n    e.stopPropagation();\n    onClick();\n  };\n\n  return (\n    <div\n      className=\"flex flex-col items-center justify-center gap-4 h-full text-center rounded-lg bg-foreground/5 hover:bg-foreground/10 transition-all duration-200 p-8\"\n      onClick={handleClick}\n    >\n      <div className=\"flex items-center justify-center\">\n        <Upload className=\"h-10 w-10 text-foreground\" />\n      </div>\n\n      <div className=\"space-y-2\">\n        <p className=\"text-xs text-muted-foreground max-w-sm\">\n          {isProcessing\n            ? `Processing your files (${progress}%)`\n            : \"Drag and drop videos, photos, and audio files here\"}\n        </p>\n      </div>\n\n      {isProcessing && (\n        <div className=\"w-full max-w-xs\">\n          <div className=\"w-full bg-muted/50 rounded-full h-2\">\n            <div\n              className=\"bg-primary h-2 rounded-full transition-all duration-300\"\n              style={{ width: `${progress}%` }}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;;;AAWO,SAAS,iBAAiB,EAC/B,SAAS,EACT,eAAe,KAAK,EACpB,WAAW,CAAC,EACZ,OAAO,EACP,eAAe,KAAK,EACE;IACtB,IAAI,CAAC,WAAW,OAAO;IAEvB,MAAM,cAAc,CAAC;QACnB,IAAI,gBAAgB,CAAC,SAAS;QAC9B,EAAE,cAAc;QAChB,EAAE,eAAe;QACjB;IACF;IAEA,qBACE,mTAAC;QACC,WAAU;QACV,SAAS;;0BAET,mTAAC;gBAAI,WAAU;0BACb,cAAA,mTAAC,uRAAA,CAAA,SAAM;oBAAC,WAAU;;;;;;;;;;;0BAGpB,mTAAC;gBAAI,WAAU;0BACb,cAAA,mTAAC;oBAAE,WAAU;8BACV,eACG,CAAC,uBAAuB,EAAE,SAAS,EAAE,CAAC,GACtC;;;;;;;;;;;YAIP,8BACC,mTAAC;gBAAI,WAAU;0BACb,cAAA,mTAAC;oBAAI,WAAU;8BACb,cAAA,mTAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,OAAO,GAAG,SAAS,CAAC,CAAC;wBAAC;;;;;;;;;;;;;;;;;;;;;;AAO7C","debugId":null}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/views/media.tsx"],"sourcesContent":["\"use client\";\n\nimport { useDragDrop } from \"@/hooks/use-drag-drop\";\nimport { processMediaFiles } from \"@/lib/media-processing\";\nimport { useMediaStore } from \"@/stores/media-store\";\nimport { MediaFile } from \"@/types/media\";\nimport {\n  ArrowDown01,\n  CloudUpload,\n  Grid2X2,\n  Image,\n  List,\n  Loader2,\n  Music,\n  Video,\n} from \"lucide-react\";\nimport { useRef, useState, useMemo } from \"react\";\nimport { useHighlightScroll } from \"@/hooks/use-highlight-scroll\";\nimport { toast } from \"sonner\";\nimport { Button } from \"@/components/ui/button\";\nimport { MediaDragOverlay } from \"@/components/editor/media-panel/drag-overlay\";\nimport {\n  ContextMenu,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuTrigger,\n} from \"@/components/ui/context-menu\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { DraggableMediaItem } from \"@/components/ui/draggable-item\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { usePanelStore } from \"@/stores/panel-store\";\nimport { useMediaPanelStore } from \"../store\";\n\nfunction MediaItemWithContextMenu({\n  item,\n  children,\n  onRemove,\n}: {\n  item: MediaFile;\n  children: React.ReactNode;\n  onRemove: (e: React.MouseEvent, id: string) => Promise<void>;\n}) {\n  return (\n    <ContextMenu>\n      <ContextMenuTrigger>{children}</ContextMenuTrigger>\n      <ContextMenuContent>\n        <ContextMenuItem>Export clips</ContextMenuItem>\n        <ContextMenuItem\n          variant=\"destructive\"\n          onClick={(e) => onRemove(e, item.id)}\n        >\n          Delete\n        </ContextMenuItem>\n      </ContextMenuContent>\n    </ContextMenu>\n  );\n}\n\nexport function MediaView() {\n  const { mediaFiles, addMediaFile, removeMediaFile } = useMediaStore();\n  const { activeProject } = useProjectStore();\n  const { mediaViewMode, setMediaViewMode } = usePanelStore();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [sortBy, setSortBy] = useState<\"name\" | \"type\" | \"duration\" | \"size\">(\n    \"name\"\n  );\n  const [sortOrder, setSortOrder] = useState<\"asc\" | \"desc\">(\"asc\");\n  const { highlightMediaId, clearHighlight } = useMediaPanelStore();\n  const { highlightedId, registerElement } = useHighlightScroll(\n    highlightMediaId,\n    clearHighlight\n  );\n\n  const processFiles = async (files: FileList | File[]) => {\n    if (!files || files.length === 0) return;\n    if (!activeProject) {\n      toast.error(\"No active project\");\n      return;\n    }\n\n    setIsProcessing(true);\n    setProgress(0);\n    try {\n      const processedItems = await processMediaFiles(files, (p) =>\n        setProgress(p)\n      );\n      for (const item of processedItems) {\n        await addMediaFile(activeProject.id, item);\n      }\n    } catch (error) {\n      console.error(\"Error processing files:\", error);\n      toast.error(\"Failed to process files\");\n    } finally {\n      setIsProcessing(false);\n      setProgress(0);\n    }\n  };\n\n  const { isDragOver, dragProps } = useDragDrop({\n    // When files are dropped, process them\n    onDrop: processFiles,\n  });\n\n  const handleFileSelect = () => fileInputRef.current?.click(); // Open file picker\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) processFiles(e.target.files);\n    e.target.value = \"\"; // Reset input\n  };\n\n  const handleRemove = async (e: React.MouseEvent, id: string) => {\n    e.stopPropagation();\n\n    if (!activeProject) {\n      toast.error(\"No active project\");\n      return;\n    }\n\n    await removeMediaFile(activeProject.id, id);\n  };\n\n  const formatDuration = (duration: number) => {\n    // Format seconds as mm:ss\n    const min = Math.floor(duration / 60);\n    const sec = Math.floor(duration % 60);\n    return `${min}:${sec.toString().padStart(2, \"0\")}`;\n  };\n\n  const filteredMediaItems = useMemo(() => {\n    let filtered = mediaFiles.filter((item) => {\n      if (item.ephemeral) return false;\n      return true;\n    });\n\n    filtered.sort((a, b) => {\n      let valueA: string | number;\n      let valueB: string | number;\n\n      switch (sortBy) {\n        case \"name\":\n          valueA = a.name.toLowerCase();\n          valueB = b.name.toLowerCase();\n          break;\n        case \"type\":\n          valueA = a.type;\n          valueB = b.type;\n          break;\n        case \"duration\":\n          valueA = a.duration || 0;\n          valueB = b.duration || 0;\n          break;\n        case \"size\":\n          valueA = a.file.size;\n          valueB = b.file.size;\n          break;\n        default:\n          return 0;\n      }\n\n      if (valueA < valueB) return sortOrder === \"asc\" ? -1 : 1;\n      if (valueA > valueB) return sortOrder === \"asc\" ? 1 : -1;\n      return 0;\n    });\n\n    return filtered;\n  }, [mediaFiles, sortBy, sortOrder]);\n\n  const previewComponents = useMemo(() => {\n    const previews = new Map<string, React.ReactNode>();\n\n    filteredMediaItems.forEach((item) => {\n      let preview: React.ReactNode;\n\n      if (item.type === \"image\") {\n        preview = (\n          <div className=\"w-full h-full flex items-center justify-center\">\n            <img\n              src={item.url}\n              alt={item.name}\n              className=\"w-full max-h-full object-cover\"\n              loading=\"lazy\"\n            />\n          </div>\n        );\n      } else if (item.type === \"video\") {\n        if (item.thumbnailUrl) {\n          preview = (\n            <div className=\"relative w-full h-full\">\n              <img\n                src={item.thumbnailUrl}\n                alt={item.name}\n                className=\"w-full h-full object-cover rounded\"\n                loading=\"lazy\"\n              />\n              <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 rounded\">\n                <Video className=\"h-6 w-6 text-white drop-shadow-md\" />\n              </div>\n              {item.duration && (\n                <div className=\"absolute bottom-1 right-1 bg-black/70 text-white text-xs px-1 rounded\">\n                  {formatDuration(item.duration)}\n                </div>\n              )}\n            </div>\n          );\n        } else {\n          preview = (\n            <div className=\"w-full h-full bg-muted/30 flex flex-col items-center justify-center text-muted-foreground rounded\">\n              <Video className=\"h-6 w-6 mb-1\" />\n              <span className=\"text-xs\">Video</span>\n              {item.duration && (\n                <span className=\"text-xs opacity-70\">\n                  {formatDuration(item.duration)}\n                </span>\n              )}\n            </div>\n          );\n        }\n      } else if (item.type === \"audio\") {\n        preview = (\n          <div className=\"w-full h-full bg-linear-to-br from-green-500/20 to-emerald-500/20 flex flex-col items-center justify-center text-muted-foreground rounded border border-green-500/20\">\n            <Music className=\"h-6 w-6 mb-1\" />\n            <span className=\"text-xs\">Audio</span>\n            {item.duration && (\n              <span className=\"text-xs opacity-70\">\n                {formatDuration(item.duration)}\n              </span>\n            )}\n          </div>\n        );\n      } else {\n        preview = (\n          <div className=\"w-full h-full bg-muted/30 flex flex-col items-center justify-center text-muted-foreground rounded\">\n            <Image className=\"h-6 w-6\" />\n            <span className=\"text-xs mt-1\">Unknown</span>\n          </div>\n        );\n      }\n\n      previews.set(item.id, preview);\n    });\n\n    return previews;\n  }, [filteredMediaItems]);\n\n  const renderPreview = (item: MediaFile) => previewComponents.get(item.id);\n\n  return (\n    <>\n      {/* Hidden file input for uploading media */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*,video/*,audio/*\"\n        multiple\n        className=\"hidden\"\n        onChange={handleFileChange}\n      />\n\n      <div\n        className={`h-full flex flex-col gap-1 transition-colors relative ${isDragOver ? \"bg-accent/30\" : \"\"}`}\n        {...dragProps}\n      >\n        <div className=\"p-3 pb-2 bg-panel\">\n          {/* Search and filter controls */}\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"lg\"\n              onClick={handleFileSelect}\n              disabled={isProcessing}\n              className=\"!bg-background px-4 flex-1 justify-center items-center h-9 opacity-100 hover:opacity-75 transition-opacity\"\n            >\n              {isProcessing ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                <CloudUpload className=\"h-4 w-4\" />\n              )}\n              <span>Upload</span>\n            </Button>\n            <div className=\"flex items-center gap-0\">\n              <TooltipProvider>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button\n                      size=\"icon\"\n                      variant=\"text\"\n                      onClick={() =>\n                        setMediaViewMode(\n                          mediaViewMode === \"grid\" ? \"list\" : \"grid\"\n                        )\n                      }\n                      disabled={isProcessing}\n                      className=\"justify-center items-center\"\n                    >\n                      {mediaViewMode === \"grid\" ? (\n                        <List strokeWidth={1.5} className=\"!size-[1.05rem]\" />\n                      ) : (\n                        <Grid2X2\n                          strokeWidth={1.5}\n                          className=\"!size-[1.05rem]\"\n                        />\n                      )}\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent>\n                    <p>\n                      {mediaViewMode === \"grid\"\n                        ? \"Switch to list view\"\n                        : \"Switch to grid view\"}\n                    </p>\n                  </TooltipContent>\n                  <Tooltip>\n                    <DropdownMenu>\n                      <TooltipTrigger asChild>\n                        <DropdownMenuTrigger asChild>\n                          <Button\n                            size=\"icon\"\n                            variant=\"text\"\n                            disabled={isProcessing}\n                            className=\"justify-center items-center\"\n                          >\n                            <ArrowDown01\n                              strokeWidth={1.5}\n                              className=\"!size-[1.05rem]\"\n                            />\n                          </Button>\n                        </DropdownMenuTrigger>\n                      </TooltipTrigger>\n                      <DropdownMenuContent align=\"end\">\n                        <DropdownMenuItem\n                          onClick={() => {\n                            if (sortBy === \"name\") {\n                              setSortOrder(\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\n                              );\n                            } else {\n                              setSortBy(\"name\");\n                              setSortOrder(\"asc\");\n                            }\n                          }}\n                        >\n                          Name{\" \"}\n                          {sortBy === \"name\" &&\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\n                        </DropdownMenuItem>\n                        <DropdownMenuItem\n                          onClick={() => {\n                            if (sortBy === \"type\") {\n                              setSortOrder(\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\n                              );\n                            } else {\n                              setSortBy(\"type\");\n                              setSortOrder(\"asc\");\n                            }\n                          }}\n                        >\n                          Type{\" \"}\n                          {sortBy === \"type\" &&\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\n                        </DropdownMenuItem>\n                        <DropdownMenuItem\n                          onClick={() => {\n                            if (sortBy === \"duration\") {\n                              setSortOrder(\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\n                              );\n                            } else {\n                              setSortBy(\"duration\");\n                              setSortOrder(\"asc\");\n                            }\n                          }}\n                        >\n                          Duration{\" \"}\n                          {sortBy === \"duration\" &&\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\n                        </DropdownMenuItem>\n                        <DropdownMenuItem\n                          onClick={() => {\n                            if (sortBy === \"size\") {\n                              setSortOrder(\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\n                              );\n                            } else {\n                              setSortBy(\"size\");\n                              setSortOrder(\"asc\");\n                            }\n                          }}\n                        >\n                          File Size{\" \"}\n                          {sortBy === \"size\" &&\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\n                        </DropdownMenuItem>\n                      </DropdownMenuContent>\n                    </DropdownMenu>\n                    <TooltipContent>\n                      <p>\n                        Sort by {sortBy} (\n                        {sortOrder === \"asc\" ? \"ascending\" : \"descending\"})\n                      </p>\n                    </TooltipContent>\n                  </Tooltip>\n                </Tooltip>\n              </TooltipProvider>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"h-full w-full overflow-y-auto scrollbar-thin pt-1\">\n          <div className=\"flex-1 p-3 pt-0 w-full\">\n            {isDragOver || filteredMediaItems.length === 0 ? (\n              <MediaDragOverlay\n                isVisible={true}\n                isProcessing={isProcessing}\n                progress={progress}\n                onClick={handleFileSelect}\n                isEmptyState={filteredMediaItems.length === 0 && !isDragOver}\n              />\n            ) : mediaViewMode === \"grid\" ? (\n              <GridView\n                filteredMediaItems={filteredMediaItems}\n                renderPreview={renderPreview}\n                handleRemove={handleRemove}\n                highlightedId={highlightedId}\n                registerElement={registerElement}\n              />\n            ) : (\n              <ListView\n                filteredMediaItems={filteredMediaItems}\n                renderPreview={renderPreview}\n                handleRemove={handleRemove}\n                highlightedId={highlightedId}\n                registerElement={registerElement}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\nfunction GridView({\n  filteredMediaItems,\n  renderPreview,\n  handleRemove,\n  highlightedId,\n  registerElement,\n}: {\n  filteredMediaItems: MediaFile[];\n  renderPreview: (item: MediaFile) => React.ReactNode;\n  handleRemove: (e: React.MouseEvent, id: string) => Promise<void>;\n  highlightedId: string | null;\n  registerElement: (id: string, element: HTMLElement | null) => void;\n}) {\n  const { addElementAtTime } = useTimelineStore();\n\n  return (\n    <div\n      className=\"grid gap-2\"\n      style={{\n        gridTemplateColumns: \"repeat(auto-fill, 160px)\",\n      }}\n    >\n      {filteredMediaItems.map((item) => (\n        <div key={item.id} ref={(el) => registerElement(item.id, el)}>\n          <MediaItemWithContextMenu item={item} onRemove={handleRemove}>\n            <DraggableMediaItem\n              name={item.name}\n              preview={renderPreview(item)}\n              dragData={{\n                id: item.id,\n                type: item.type,\n                name: item.name,\n              }}\n              showPlusOnDrag={false}\n              onAddToTimeline={(currentTime) =>\n                addElementAtTime(item, currentTime)\n              }\n              rounded={false}\n              variant=\"card\"\n              isHighlighted={highlightedId === item.id}\n            />\n          </MediaItemWithContextMenu>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction ListView({\n  filteredMediaItems,\n  renderPreview,\n  handleRemove,\n  highlightedId,\n  registerElement,\n}: {\n  filteredMediaItems: MediaFile[];\n  renderPreview: (item: MediaFile) => React.ReactNode;\n  handleRemove: (e: React.MouseEvent, id: string) => Promise<void>;\n  highlightedId: string | null;\n  registerElement: (id: string, element: HTMLElement | null) => void;\n}) {\n  const { addElementAtTime } = useTimelineStore();\n\n  return (\n    <div className=\"space-y-1\">\n      {filteredMediaItems.map((item) => (\n        <div key={item.id} ref={(el) => registerElement(item.id, el)}>\n          <MediaItemWithContextMenu item={item} onRemove={handleRemove}>\n            <DraggableMediaItem\n              name={item.name}\n              preview={renderPreview(item)}\n              dragData={{\n                id: item.id,\n                type: item.type,\n                name: item.name,\n              }}\n              showPlusOnDrag={false}\n              onAddToTimeline={(currentTime) =>\n                addElementAtTime(item, currentTime)\n              }\n              variant=\"compact\"\n              isHighlighted={highlightedId === item.id}\n            />\n          </MediaItemWithContextMenu>\n        </div>\n      ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1003, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/panel-base-view.tsx"],"sourcesContent":["import { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface PanelBaseViewProps {\r\n  children?: React.ReactNode;\r\n  defaultTab?: string;\r\n  value?: string;\r\n  onValueChange?: (value: string) => void;\r\n  tabs?: {\r\n    value: string;\r\n    label: string;\r\n    icon?: React.ReactNode;\r\n    content: React.ReactNode;\r\n  }[];\r\n  className?: string;\r\n  ref?: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nfunction ViewContent({\r\n  children,\r\n  className,\r\n}: {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <ScrollArea className=\"flex-1\">\r\n      <div className={cn(\"p-5\", className)}>{children}</div>\r\n    </ScrollArea>\r\n  );\r\n}\r\n\r\nexport function PanelBaseView({\r\n  children,\r\n  defaultTab,\r\n  value,\r\n  onValueChange,\r\n  tabs,\r\n  className = \"\",\r\n  ref,\r\n}: PanelBaseViewProps) {\r\n  return (\r\n    <div className={cn(\"h-full flex flex-col\", className)} ref={ref}>\r\n      {!tabs || tabs.length === 0 ? (\r\n        <ViewContent className={className}>{children}</ViewContent>\r\n      ) : (\r\n        <Tabs\r\n          defaultValue={defaultTab}\r\n          value={value}\r\n          onValueChange={onValueChange}\r\n          className=\"flex flex-col h-full\"\r\n        >\r\n          <div className=\"sticky top-0 z-10 bg-panel\">\r\n            <div className=\"px-3 pt-3.5 pb-0\">\r\n              <TabsList>\r\n                {tabs.map((tab) => (\r\n                  <TabsTrigger key={tab.value} value={tab.value}>\r\n                    {tab.icon ? (\r\n                      <span className=\"inline-flex items-center mr-1\">\r\n                        {tab.icon}\r\n                      </span>\r\n                    ) : null}\r\n                    {tab.label}\r\n                  </TabsTrigger>\r\n                ))}\r\n              </TabsList>\r\n            </div>\r\n            <Separator className=\"mt-3.5\" />\r\n          </div>\r\n          {tabs.map((tab) => (\r\n            <TabsContent\r\n              key={tab.value}\r\n              value={tab.value}\r\n              className=\"mt-0 flex-1 flex flex-col min-h-0\"\r\n            >\r\n              <ViewContent className={className}>{tab.content}</ViewContent>\r\n            </TabsContent>\r\n          ))}\r\n        </Tabs>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;AAiBA,SAAS,YAAY,EACnB,QAAQ,EACR,SAAS,EAIV;IACC,qBACE,mTAAC,yJAAA,CAAA,aAAU;QAAC,WAAU;kBACpB,cAAA,mTAAC;YAAI,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EAAE,OAAO;sBAAa;;;;;;;;;;;AAG7C;AAEO,SAAS,cAAc,EAC5B,QAAQ,EACR,UAAU,EACV,KAAK,EACL,aAAa,EACb,IAAI,EACJ,YAAY,EAAE,EACd,GAAG,EACgB;IACnB,qBACE,mTAAC;QAAI,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EAAE,wBAAwB;QAAY,KAAK;kBACzD,CAAC,QAAQ,KAAK,MAAM,KAAK,kBACxB,mTAAC;YAAY,WAAW;sBAAY;;;;;iCAEpC,mTAAC,+IAAA,CAAA,OAAI;YACH,cAAc;YACd,OAAO;YACP,eAAe;YACf,WAAU;;8BAEV,mTAAC;oBAAI,WAAU;;sCACb,mTAAC;4BAAI,WAAU;sCACb,cAAA,mTAAC,+IAAA,CAAA,WAAQ;0CACN,KAAK,GAAG,CAAC,CAAC,oBACT,mTAAC,+IAAA,CAAA,cAAW;wCAAiB,OAAO,IAAI,KAAK;;4CAC1C,IAAI,IAAI,iBACP,mTAAC;gDAAK,WAAU;0DACb,IAAI,IAAI;;;;;uDAET;4CACH,IAAI,KAAK;;uCANM,IAAI,KAAK;;;;;;;;;;;;;;;sCAWjC,mTAAC,oJAAA,CAAA,YAAS;4BAAC,WAAU;;;;;;;;;;;;gBAEtB,KAAK,GAAG,CAAC,CAAC,oBACT,mTAAC,+IAAA,CAAA,cAAW;wBAEV,OAAO,IAAI,KAAK;wBAChB,WAAU;kCAEV,cAAA,mTAAC;4BAAY,WAAW;sCAAY,IAAI,OAAO;;;;;;uBAJ1C,IAAI,KAAK;;;;;;;;;;;;;;;;AAW5B","debugId":null}},
    {"offset": {"line": 1129, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/views/text.tsx"],"sourcesContent":["import { DraggableMediaItem } from \"@/components/ui/draggable-item\";\nimport { PanelBaseView as BaseView } from \"@/components/editor/panel-base-view\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { DEFAULT_TEXT_ELEMENT } from \"@/constants/text-constants\";\n\nexport function TextView() {\n  return (\n    <BaseView>\n      <DraggableMediaItem\n        name=\"Default text\"\n        preview={\n          <div className=\"flex items-center justify-center w-full h-full bg-panel-accent rounded\">\n            <span className=\"text-xs select-none\">Default text</span>\n          </div>\n        }\n        dragData={{\n          id: \"temp-text-id\",\n          type: DEFAULT_TEXT_ELEMENT.type,\n          name: DEFAULT_TEXT_ELEMENT.name,\n          content: DEFAULT_TEXT_ELEMENT.content,\n        }}\n        aspectRatio={1}\n        onAddToTimeline={(currentTime) =>\n          useTimelineStore.getState().addElementAtTime(\n            {\n              ...DEFAULT_TEXT_ELEMENT,\n              id: \"temp-text-id\",\n            },\n            currentTime\n          )\n        }\n        showLabel={false}\n      />\n    </BaseView>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;AAEO,SAAS;IACd,qBACE,mTAAC,oKAAA,CAAA,gBAAQ;kBACP,cAAA,mTAAC,4JAAA,CAAA,qBAAkB;YACjB,MAAK;YACL,uBACE,mTAAC;gBAAI,WAAU;0BACb,cAAA,mTAAC;oBAAK,WAAU;8BAAsB;;;;;;;;;;;YAG1C,UAAU;gBACR,IAAI;gBACJ,MAAM,oJAAA,CAAA,uBAAoB,CAAC,IAAI;gBAC/B,MAAM,oJAAA,CAAA,uBAAoB,CAAC,IAAI;gBAC/B,SAAS,oJAAA,CAAA,uBAAoB,CAAC,OAAO;YACvC;YACA,aAAa;YACb,iBAAiB,CAAC,cAChB,iJAAA,CAAA,mBAAgB,CAAC,QAAQ,GAAG,gBAAgB,CAC1C;oBACE,GAAG,oJAAA,CAAA,uBAAoB;oBACvB,IAAI;gBACN,GACA;YAGJ,WAAW;;;;;;;;;;;AAInB","debugId":null}},
    {"offset": {"line": 1188, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/views/sounds.tsx"],"sourcesContent":["\"use client\";\n\nimport { Input } from \"@/components/ui/input\";\nimport { useState, useMemo, useEffect } from \"react\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  PlayIcon,\n  PauseIcon,\n  HeartIcon,\n  PlusIcon,\n  ListFilter,\n} from \"lucide-react\";\nimport { useSoundsStore } from \"@/stores/sounds-store\";\nimport { useSoundSearch } from \"@/hooks/use-sound-search\";\nimport type { SoundEffect, SavedSound } from \"@/types/sounds\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuCheckboxItem,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { cn } from \"@/lib/utils\";\nimport { useInfiniteScroll } from \"@/hooks/use-infinite-scroll\";\n\nexport function SoundsView() {\n  return (\n    <div className=\"h-full flex flex-col\">\n      <Tabs defaultValue=\"sound-effects\" className=\"flex flex-col h-full\">\n        <div className=\"px-3 pt-4 pb-0\">\n          <TabsList>\n            <TabsTrigger value=\"sound-effects\">Sound effects</TabsTrigger>\n            <TabsTrigger value=\"songs\">Songs</TabsTrigger>\n            <TabsTrigger value=\"saved\">Saved</TabsTrigger>\n          </TabsList>\n        </div>\n        <Separator className=\"my-4\" />\n        <TabsContent\n          value=\"sound-effects\"\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\n        >\n          <SoundEffectsView />\n        </TabsContent>\n        <TabsContent\n          value=\"saved\"\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\n        >\n          <SavedSoundsView />\n        </TabsContent>\n        <TabsContent\n          value=\"songs\"\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\n        >\n          <SongsView />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nfunction SoundEffectsView() {\n  const {\n    topSoundEffects,\n    isLoading,\n    searchQuery,\n    setSearchQuery,\n    scrollPosition,\n    setScrollPosition,\n    loadSavedSounds,\n    isSoundSaved,\n    toggleSavedSound,\n    showCommercialOnly,\n    toggleCommercialFilter,\n    hasLoaded,\n    setTopSoundEffects,\n    setLoading,\n    setError,\n    setHasLoaded,\n    setCurrentPage,\n    setHasNextPage,\n    setTotalCount,\n  } = useSoundsStore();\n  const {\n    results: searchResults,\n    isLoading: isSearching,\n    loadMore,\n    hasNextPage,\n    isLoadingMore,\n  } = useSoundSearch(searchQuery, showCommercialOnly);\n\n  // Audio playback state\n  const [playingId, setPlayingId] = useState<number | null>(null);\n  const [audioElement, setAudioElement] = useState<HTMLAudioElement | null>(\n    null\n  );\n\n  const { scrollAreaRef, handleScroll } = useInfiniteScroll({\n    onLoadMore: loadMore,\n    hasMore: hasNextPage,\n    isLoading: isLoadingMore || isSearching,\n  });\n\n  useEffect(() => {\n    loadSavedSounds();\n\n    if (!hasLoaded) {\n      let ignore = false;\n\n      const fetchTopSounds = async () => {\n        try {\n          if (!ignore) {\n            setLoading(true);\n            setError(null);\n          }\n\n          const response = await fetch(\n            \"/api/sounds/search?page_size=50&sort=downloads\"\n          );\n\n          if (!ignore) {\n            if (!response.ok) {\n              throw new Error(`Failed to fetch: ${response.status}`);\n            }\n\n            const data = await response.json();\n            setTopSoundEffects(data.results);\n            setHasLoaded(true);\n\n            setCurrentPage(1);\n            setHasNextPage(!!data.next);\n            setTotalCount(data.count);\n          }\n        } catch (error) {\n          if (!ignore) {\n            console.error(\"Failed to fetch top sounds:\", error);\n            setError(\n              error instanceof Error ? error.message : \"Failed to load sounds\"\n            );\n          }\n        } finally {\n          if (!ignore) {\n            setLoading(false);\n          }\n        }\n      };\n\n      const timeoutId = setTimeout(fetchTopSounds, 100);\n\n      return () => {\n        clearTimeout(timeoutId);\n        ignore = true;\n      };\n    }\n\n    if (scrollAreaRef.current && scrollPosition > 0) {\n      const timeoutId = setTimeout(() => {\n        scrollAreaRef.current?.scrollTo({ top: scrollPosition });\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [\n    hasLoaded,\n    setTopSoundEffects,\n    setLoading,\n    setError,\n    setHasLoaded,\n    setCurrentPage,\n    setHasNextPage,\n    setTotalCount,\n  ]);\n\n  const handleScrollWithPosition = (event: React.UIEvent<HTMLDivElement>) => {\n    const { scrollTop } = event.currentTarget;\n    setScrollPosition(scrollTop);\n    handleScroll(event);\n  };\n\n  const displayedSounds = useMemo(() => {\n    const sounds = searchQuery ? searchResults : topSoundEffects;\n    return sounds;\n  }, [searchQuery, searchResults, topSoundEffects]);\n\n  const playSound = (sound: SoundEffect) => {\n    if (playingId === sound.id) {\n      audioElement?.pause();\n      setPlayingId(null);\n      return;\n    }\n\n    // Stop previous sound\n    audioElement?.pause();\n\n    if (sound.previewUrl) {\n      const audio = new Audio(sound.previewUrl);\n      audio.addEventListener(\"ended\", () => {\n        setPlayingId(null);\n      });\n      audio.addEventListener(\"error\", (e) => {\n        setPlayingId(null);\n      });\n      audio.play().catch((error) => {\n        setPlayingId(null);\n      });\n\n      setAudioElement(audio);\n      setPlayingId(sound.id);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col gap-5 mt-1 h-full\">\n      <div className=\"flex items-center gap-3\">\n        <Input\n          placeholder=\"Search sound effects\"\n          className=\"bg-panel-accent w-full\"\n          containerClassName=\"w-full\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          showClearIcon\n          onClear={() => setSearchQuery(\"\")}\n        />\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"text\"\n              size=\"icon\"\n              className={cn(showCommercialOnly && \"text-primary\")}\n            >\n              <ListFilter className=\"w-4 h-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            <DropdownMenuCheckboxItem\n              checked={showCommercialOnly}\n              onCheckedChange={toggleCommercialFilter}\n            >\n              Show only commercially licensed\n            </DropdownMenuCheckboxItem>\n            <div className=\"px-2 py-1.5 text-xs text-muted-foreground\">\n              {showCommercialOnly\n                ? \"Only showing sounds licensed for commercial use\"\n                : \"Showing all sounds regardless of license\"}\n            </div>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      <div className=\"relative h-full overflow-hidden\">\n        <ScrollArea\n          className=\"flex-1 h-full\"\n          ref={scrollAreaRef}\n          onScrollCapture={handleScrollWithPosition}\n        >\n          <div className=\"flex flex-col gap-4\">\n            {isLoading && !searchQuery && (\n              <div className=\"text-muted-foreground text-sm\">\n                Loading sounds...\n              </div>\n            )}\n            {isSearching && searchQuery && (\n              <div className=\"text-muted-foreground text-sm\">Searching...</div>\n            )}\n            {displayedSounds.map((sound) => (\n              <AudioItem\n                key={sound.id}\n                sound={sound}\n                isPlaying={playingId === sound.id}\n                onPlay={() => playSound(sound)}\n                isSaved={isSoundSaved(sound.id)}\n                onToggleSaved={() => toggleSavedSound(sound)}\n              />\n            ))}\n            {!isLoading && !isSearching && displayedSounds.length === 0 && (\n              <div className=\"text-muted-foreground text-sm\">\n                {searchQuery ? \"No sounds found\" : \"No sounds available\"}\n              </div>\n            )}\n            {isLoadingMore && (\n              <div className=\"text-muted-foreground text-sm text-center py-4\">\n                Loading more sounds...\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </div>\n    </div>\n  );\n}\n\nfunction SavedSoundsView() {\n  const {\n    savedSounds,\n    isLoadingSavedSounds,\n    savedSoundsError,\n    loadSavedSounds,\n    isSoundSaved,\n    toggleSavedSound,\n    clearSavedSounds,\n  } = useSoundsStore();\n\n  // Audio playback state\n  const [playingId, setPlayingId] = useState<number | null>(null);\n  const [audioElement, setAudioElement] = useState<HTMLAudioElement | null>(\n    null\n  );\n\n  // Clear confirmation dialog state\n  const [showClearDialog, setShowClearDialog] = useState(false);\n\n  // Load saved sounds when tab becomes active\n  useEffect(() => {\n    loadSavedSounds();\n  }, [loadSavedSounds]);\n\n  const playSound = (sound: SavedSound) => {\n    if (playingId === sound.id) {\n      audioElement?.pause();\n      setPlayingId(null);\n      return;\n    }\n\n    // Stop previous sound\n    audioElement?.pause();\n\n    if (sound.previewUrl) {\n      const audio = new Audio(sound.previewUrl);\n      audio.addEventListener(\"ended\", () => {\n        setPlayingId(null);\n      });\n      audio.addEventListener(\"error\", (e) => {\n        setPlayingId(null);\n      });\n      audio.play().catch((error) => {\n        setPlayingId(null);\n      });\n\n      setAudioElement(audio);\n      setPlayingId(sound.id);\n    }\n  };\n\n  // Convert SavedSound to SoundEffect for compatibility with AudioItem\n  const convertToSoundEffect = (savedSound: SavedSound): SoundEffect => ({\n    id: savedSound.id,\n    name: savedSound.name,\n    description: \"\",\n    url: \"\",\n    previewUrl: savedSound.previewUrl,\n    downloadUrl: savedSound.downloadUrl,\n    duration: savedSound.duration,\n    filesize: 0,\n    type: \"audio\",\n    channels: 0,\n    bitrate: 0,\n    bitdepth: 0,\n    samplerate: 0,\n    username: savedSound.username,\n    tags: savedSound.tags,\n    license: savedSound.license,\n    created: savedSound.savedAt,\n    downloads: 0,\n    rating: 0,\n    ratingCount: 0,\n  });\n\n  if (isLoadingSavedSounds) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-muted-foreground text-sm\">\n          Loading saved sounds...\n        </div>\n      </div>\n    );\n  }\n\n  if (savedSoundsError) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-destructive text-sm\">\n          Error: {savedSoundsError}\n        </div>\n      </div>\n    );\n  }\n\n  if (savedSounds.length === 0) {\n    return (\n      <div className=\"bg-panel h-full p-4 flex flex-col items-center justify-center gap-3\">\n        <HeartIcon\n          className=\"w-10 h-10 text-muted-foreground\"\n          strokeWidth={1.5}\n        />\n        <div className=\"flex flex-col gap-2 text-center\">\n          <p className=\"text-lg font-medium\">No saved sounds</p>\n          <p className=\"text-sm text-muted-foreground text-balance\">\n            Click the heart icon on any sound to save it here\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col gap-5 mt-1 h-full\">\n      <div className=\"flex items-center justify-between\">\n        <p className=\"text-sm text-muted-foreground\">\n          {savedSounds.length} saved{\" \"}\n          {savedSounds.length === 1 ? \"sound\" : \"sounds\"}\n        </p>\n        <Dialog open={showClearDialog} onOpenChange={setShowClearDialog}>\n          <DialogTrigger asChild>\n            <Button\n              variant=\"text\"\n              size=\"sm\"\n              className=\"h-auto text-muted-foreground hover:text-destructive !opacity-100\"\n            >\n              Clear all\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Clear all saved sounds?</DialogTitle>\n              <DialogDescription>\n                This will permanently remove all {savedSounds.length} saved\n                sounds from your collection. This action cannot be undone.\n              </DialogDescription>\n            </DialogHeader>\n            <DialogFooter>\n              <Button variant=\"text\" onClick={() => setShowClearDialog(false)}>\n                Cancel\n              </Button>\n              <Button\n                variant=\"destructive\"\n                onClick={async () => {\n                  await clearSavedSounds();\n                  setShowClearDialog(false);\n                }}\n              >\n                Clear all sounds\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"relative h-full overflow-hidden\">\n        <ScrollArea className=\"flex-1 h-full\">\n          <div className=\"flex flex-col gap-4\">\n            {savedSounds.map((sound) => (\n              <AudioItem\n                key={sound.id}\n                sound={convertToSoundEffect(sound)}\n                isPlaying={playingId === sound.id}\n                onPlay={() => playSound(sound)}\n                isSaved={isSoundSaved(sound.id)}\n                onToggleSaved={() =>\n                  toggleSavedSound(convertToSoundEffect(sound))\n                }\n              />\n            ))}\n          </div>\n        </ScrollArea>\n      </div>\n    </div>\n  );\n}\n\nfunction SongsView() {\n  return <div>Songs</div>;\n}\n\ninterface AudioItemProps {\n  sound: SoundEffect;\n  isPlaying: boolean;\n  onPlay: () => void;\n  isSaved: boolean;\n  onToggleSaved: () => void;\n}\n\nfunction AudioItem({\n  sound,\n  isPlaying,\n  onPlay,\n  isSaved,\n  onToggleSaved,\n}: AudioItemProps) {\n  const { addSoundToTimeline } = useSoundsStore();\n\n  const handleClick = () => {\n    onPlay();\n  };\n\n  const handleSaveClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    onToggleSaved();\n  };\n\n  const handleAddToTimeline = async (e: React.MouseEvent) => {\n    e.stopPropagation();\n    await addSoundToTimeline(sound);\n  };\n\n  return (\n    <div\n      className=\"group flex items-center gap-3 opacity-100 hover:opacity-75 transition-opacity cursor-pointer\"\n      onClick={handleClick}\n    >\n      <div className=\"relative w-12 h-12 bg-accent rounded-md flex items-center justify-center overflow-hidden shrink-0\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/20 to-transparent\" />\n        {isPlaying ? (\n          <PauseIcon className=\"w-5 h-5\" />\n        ) : (\n          <PlayIcon className=\"w-5 h-5\" />\n        )}\n      </div>\n\n      <div className=\"flex-1 min-w-0 overflow-hidden\">\n        <p className=\"font-medium truncate text-sm\">{sound.name}</p>\n        <span className=\"text-xs text-muted-foreground truncate block\">\n          {sound.username}\n        </span>\n      </div>\n\n      <div className=\"flex items-center gap-3 pr-2\">\n        <Button\n          variant=\"text\"\n          size=\"icon\"\n          className=\"text-muted-foreground hover:text-foreground !opacity-100 w-auto\"\n          onClick={handleAddToTimeline}\n          title=\"Add to timeline\"\n        >\n          <PlusIcon className=\"w-4 h-4\" />\n        </Button>\n        <Button\n          variant=\"text\"\n          size=\"icon\"\n          className={`hover:text-foreground !opacity-100 w-auto ${\n            isSaved\n              ? \"text-red-500 hover:text-red-600\"\n              : \"text-muted-foreground\"\n          }`}\n          onClick={handleSaveClick}\n          title={isSaved ? \"Remove from saved\" : \"Save sound\"}\n        >\n          <HeartIcon className={`w-4 h-4 ${isSaved ? \"fill-current\" : \"\"}`} />\n        </Button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2020, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/views/stickers.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useMemo } from \"react\";\nimport { useStickersStore } from \"@/stores/stickers-store\";\nimport { useMediaStore } from \"@/stores/media-store\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { usePlaybackStore } from \"@/stores/playback-store\";\nimport {\n  Loader2,\n  Grid3X3,\n  Hash,\n  Smile,\n  Clock,\n  X,\n  Sparkles,\n  ArrowRight,\n  StickerIcon,\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { PanelBaseView as BaseView } from \"@/components/editor/panel-base-view\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\nimport {\n  getIconSvgUrl,\n  buildIconSvgUrl,\n  ICONIFY_HOSTS,\n  POPULAR_COLLECTIONS,\n} from \"@/lib/iconify-api\";\nimport { cn } from \"@/lib/utils\";\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\nimport Image from \"next/image\";\nimport type { MediaFile } from \"@/types/media\";\nimport { DraggableMediaItem } from \"@/components/ui/draggable-item\";\nimport { InputWithBack } from \"@/components/ui/input-with-back\";\nimport { StickerCategory } from \"@/stores/stickers-store\";\nimport { useInfiniteScroll } from \"@/hooks/use-infinite-scroll\";\n\nexport function StickersView() {\n  const { selectedCategory, setSelectedCategory } = useStickersStore();\n\n  return (\n    <BaseView\n      value={selectedCategory}\n      onValueChange={(v) => {\n        if ([\"all\", \"general\", \"brands\", \"emoji\"].includes(v)) {\n          setSelectedCategory(v as StickerCategory);\n        }\n      }}\n      tabs={[\n        {\n          value: \"all\",\n          label: \"All\",\n          icon: <Grid3X3 className=\"h-3 w-3\" />,\n          content: <StickersContentView category=\"all\" />,\n        },\n        {\n          value: \"general\",\n          label: \"Icons\",\n          icon: <Sparkles className=\"h-3 w-3\" />,\n          content: <StickersContentView category=\"general\" />,\n        },\n        {\n          value: \"brands\",\n          label: \"Brands\",\n          icon: <Hash className=\"h-3 w-3\" />,\n          content: <StickersContentView category=\"brands\" />,\n        },\n        {\n          value: \"emoji\",\n          label: \"Emoji\",\n          icon: <Smile className=\"h-3 w-3\" />,\n          content: <StickersContentView category=\"emoji\" />,\n        },\n      ]}\n      className=\"flex flex-col h-full p-0 overflow-hidden\"\n    />\n  );\n}\n\nfunction StickerGrid({\n  icons,\n  onAdd,\n  addingSticker,\n  capSize = false,\n}: {\n  icons: string[];\n  onAdd: (iconName: string) => void;\n  addingSticker: string | null;\n  capSize?: boolean;\n}) {\n  return (\n    <div\n      className=\"grid gap-2\"\n      style={{\n        gridTemplateColumns: capSize\n          ? \"repeat(auto-fill, minmax(var(--sticker-min, 96px), var(--sticker-max, 160px)))\"\n          : \"repeat(auto-fit, minmax(var(--sticker-min, 96px), 1fr))\",\n        [\"--sticker-min\" as any]: \"96px\",\n        ...(capSize ? ({ [\"--sticker-max\"]: \"160px\" } as any) : {}),\n      }}\n    >\n      {icons.map((iconName) => (\n        <StickerItem\n          key={iconName}\n          iconName={iconName}\n          onAdd={onAdd}\n          isAdding={addingSticker === iconName}\n          capSize={capSize}\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction CollectionGrid({\n  collections,\n  onSelectCollection,\n}: {\n  collections: Array<{\n    prefix: string;\n    name: string;\n    total: number;\n    category?: string;\n  }>;\n  onSelectCollection: (prefix: string) => void;\n}) {\n  return (\n    <div className=\"grid grid-cols-1 gap-2\">\n      {collections.map((collection) => (\n        <CollectionItem\n          key={collection.prefix}\n          title={collection.name}\n          subtitle={`${collection.total.toLocaleString()} icons${collection.category ? ` • ${collection.category}` : \"\"}`}\n          onClick={() => onSelectCollection(collection.prefix)}\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction EmptyView({ message }: { message: string }) {\n  return (\n    <div className=\"bg-panel h-full p-4 flex flex-col items-center justify-center gap-3\">\n      <StickerIcon\n        className=\"w-10 h-10 text-muted-foreground\"\n        strokeWidth={1.5}\n      />\n      <div className=\"flex flex-col gap-2 text-center\">\n        <p className=\"text-lg font-medium\">No stickers found</p>\n        <p className=\"text-sm text-muted-foreground text-balance\">{message}</p>\n      </div>\n    </div>\n  );\n}\n\nfunction StickersContentView({ category }: { category: StickerCategory }) {\n  const { activeProject } = useProjectStore();\n  const { addElementAtTime } = useTimelineStore();\n  const { currentTime } = usePlaybackStore();\n  const { addMediaFile } = useMediaStore();\n  const {\n    searchQuery,\n    selectedCollection,\n    viewMode,\n    collections,\n    currentCollection,\n    searchResults,\n    recentStickers,\n    isLoadingCollections,\n    isLoadingCollection,\n    isSearching,\n    setSearchQuery,\n    setSelectedCollection,\n    loadCollections,\n    searchStickers,\n    addStickerToTimeline,\n    clearRecentStickers,\n    setSelectedCategory,\n    addingSticker,\n  } = useStickersStore();\n\n  const [localSearchQuery, setLocalSearchQuery] = useState(searchQuery);\n  const [collectionsToShow, setCollectionsToShow] = useState(20);\n  const [showCollectionItems, setShowCollectionItems] = useState(false);\n\n  const filteredCollections = useMemo(() => {\n    if (category === \"all\") {\n      return Object.entries(collections).map(([prefix, collection]) => ({\n        prefix,\n        name: collection.name,\n        total: collection.total,\n        category: collection.category,\n      }));\n    }\n\n    const collectionList =\n      POPULAR_COLLECTIONS[category as keyof typeof POPULAR_COLLECTIONS];\n    if (!collectionList) return [];\n\n    return collectionList\n      .map((c) => {\n        const collection = collections[c.prefix];\n        return collection\n          ? {\n              prefix: c.prefix,\n              name: c.name,\n              total: collection.total,\n            }\n          : null;\n      })\n      .filter(Boolean) as Array<{\n      prefix: string;\n      name: string;\n      total: number;\n    }>;\n  }, [collections, category]);\n\n  const { scrollAreaRef, handleScroll } = useInfiniteScroll({\n    onLoadMore: () => setCollectionsToShow((prev) => prev + 20),\n    hasMore: filteredCollections.length > collectionsToShow,\n    isLoading: isLoadingCollections,\n    enabled: viewMode === \"browse\" && !selectedCollection && category === \"all\",\n  });\n\n  useEffect(() => {\n    if (Object.keys(collections).length === 0) {\n      loadCollections();\n    }\n  }, []);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      if (localSearchQuery !== searchQuery) {\n        setSearchQuery(localSearchQuery);\n        if (localSearchQuery.trim()) {\n          searchStickers(localSearchQuery);\n        }\n      }\n    }, 500);\n\n    return () => clearTimeout(timer);\n  }, [localSearchQuery]);\n\n  const handleAddSticker = async (iconName: string) => {\n    try {\n      await addStickerToTimeline(iconName);\n    } catch (error) {\n      console.error(\"Failed to add sticker:\", error);\n      toast.error(\"Failed to add sticker to timeline\");\n    }\n  };\n\n  const iconsToDisplay = useMemo(() => {\n    if (viewMode === \"search\" && searchResults) {\n      return searchResults.icons;\n    }\n\n    if (viewMode === \"collection\" && currentCollection) {\n      const icons: string[] = [];\n\n      if (currentCollection.uncategorized) {\n        icons.push(\n          ...currentCollection.uncategorized.map(\n            (name) => `${currentCollection.prefix}:${name}`\n          )\n        );\n      }\n\n      if (currentCollection.categories) {\n        Object.values(currentCollection.categories).forEach((categoryIcons) => {\n          icons.push(\n            ...categoryIcons.map(\n              (name) => `${currentCollection.prefix}:${name}`\n            )\n          );\n        });\n      }\n\n      return icons.slice(0, 100);\n    }\n\n    return [];\n  }, [viewMode, searchResults, currentCollection]);\n\n  const isInCollection = viewMode === \"collection\" && !!selectedCollection;\n\n  useEffect(() => {\n    if (isInCollection) {\n      setShowCollectionItems(false);\n      const timer = setTimeout(() => setShowCollectionItems(true), 350);\n      return () => clearTimeout(timer);\n    } else {\n      setShowCollectionItems(false);\n    }\n  }, [isInCollection]);\n\n  return (\n    <div className=\"flex flex-col gap-5 mt-1 h-full p-4\">\n      <div className=\"space-y-3\">\n        <InputWithBack\n          isExpanded={isInCollection}\n          setIsExpanded={(expanded) => {\n            if (!expanded && isInCollection) {\n              setSelectedCollection(null);\n            }\n          }}\n          placeholder={\n            category === \"all\"\n              ? \"Search all stickers\"\n              : category === \"general\"\n                ? \"Search icons\"\n                : category === \"brands\"\n                  ? \"Search brands\"\n                  : \"Search Emojis\"\n          }\n          value={localSearchQuery}\n          onChange={setLocalSearchQuery}\n          disableAnimation={true}\n        />\n      </div>\n\n      <div className=\"relative h-full overflow-hidden\">\n        <ScrollArea\n          className=\"flex-1 h-full\"\n          ref={scrollAreaRef}\n          onScrollCapture={handleScroll}\n        >\n          <div className=\"flex flex-col gap-4 h-full\">\n            {recentStickers.length > 0 && viewMode === \"browse\" && (\n              <div className=\"h-full\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                  <span className=\"text-sm font-medium\">Recent</span>\n                  <TooltipProvider>\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <button\n                          onClick={clearRecentStickers}\n                          className=\"ml-auto h-5 w-5 p-0 rounded hover:bg-accent flex items-center justify-center\"\n                        >\n                          <X className=\"h-3 w-3 text-muted-foreground\" />\n                        </button>\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        <p>Clear recent stickers</p>\n                      </TooltipContent>\n                    </Tooltip>\n                  </TooltipProvider>\n                </div>\n                <StickerGrid\n                  icons={recentStickers.slice(0, 12)}\n                  onAdd={handleAddSticker}\n                  addingSticker={addingSticker}\n                  capSize\n                />\n              </div>\n            )}\n\n            {viewMode === \"collection\" && selectedCollection && (\n              <div className=\"h-full\">\n                {isLoadingCollection ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : showCollectionItems ? (\n                  <StickerGrid\n                    icons={iconsToDisplay}\n                    onAdd={handleAddSticker}\n                    addingSticker={addingSticker}\n                  />\n                ) : (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                  </div>\n                )}\n              </div>\n            )}\n\n            {viewMode === \"search\" && (\n              <div className=\"h-full\">\n                {isSearching ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : searchResults?.icons.length ? (\n                  <>\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <span className=\"text-sm text-muted-foreground\">\n                        {searchResults.total} results\n                      </span>\n                    </div>\n                    <StickerGrid\n                      icons={iconsToDisplay}\n                      onAdd={handleAddSticker}\n                      addingSticker={addingSticker}\n                      capSize\n                    />\n                  </>\n                ) : searchQuery ? (\n                  <div className=\"flex flex-col items-center justify-center py-8 gap-3\">\n                    <EmptyView\n                      message={`No stickers found for \"${searchQuery}\"`}\n                    />\n                    {category !== \"all\" && (\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => {\n                          const q = localSearchQuery || searchQuery;\n                          if (q) {\n                            setSearchQuery(q);\n                          }\n                          setSelectedCategory(\"all\");\n                          if (q) {\n                            searchStickers(q);\n                          }\n                        }}\n                      >\n                        Search in all icons\n                      </Button>\n                    )}\n                  </div>\n                ) : null}\n              </div>\n            )}\n\n            {viewMode === \"browse\" && !selectedCollection && (\n              <div className=\"space-y-4 h-full\">\n                {isLoadingCollections ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : (\n                  <>\n                    {category !== \"all\" && (\n                      <div className=\"h-full\">\n                        <h3 className=\"text-sm font-medium mb-2\">\n                          Popular{\" \"}\n                          {category === \"general\"\n                            ? \"Icon Sets\"\n                            : category === \"brands\"\n                              ? \"Brand Icons\"\n                              : \"Emoji Sets\"}\n                        </h3>\n                        <CollectionGrid\n                          collections={filteredCollections}\n                          onSelectCollection={setSelectedCollection}\n                        />\n                      </div>\n                    )}\n\n                    {category === \"all\" && filteredCollections.length > 0 && (\n                      <div className=\"h-full\">\n                        <CollectionGrid\n                          collections={filteredCollections.slice(\n                            0,\n                            collectionsToShow\n                          )}\n                          onSelectCollection={setSelectedCollection}\n                        />\n                      </div>\n                    )}\n                  </>\n                )}\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </div>\n    </div>\n  );\n}\n\ninterface CollectionItemProps {\n  title: string;\n  subtitle: string;\n  onClick: () => void;\n}\n\nfunction CollectionItem({ title, subtitle, onClick }: CollectionItemProps) {\n  return (\n    <Button\n      variant=\"outline\"\n      className=\"justify-between h-auto py-2 \"\n      onClick={onClick}\n    >\n      <div className=\"text-left\">\n        <p className=\"font-medium\">{title}</p>\n        <p className=\"text-xs text-muted-foreground\">{subtitle}</p>\n      </div>\n      <ArrowRight className=\"h-4 w-4\" />\n    </Button>\n  );\n}\n\ninterface StickerItemProps {\n  iconName: string;\n  onAdd: (iconName: string) => void;\n  isAdding?: boolean;\n  capSize?: boolean;\n}\n\nfunction StickerItem({\n  iconName,\n  onAdd,\n  isAdding,\n  capSize = false,\n}: StickerItemProps) {\n  const [imageError, setImageError] = useState(false);\n  const [hostIndex, setHostIndex] = useState(0);\n\n  useEffect(() => {\n    setImageError(false);\n    setHostIndex(0);\n  }, [iconName]);\n\n  const displayName = iconName.split(\":\")[1] || iconName;\n  const collectionPrefix = iconName.split(\":\")[0];\n\n  const preview = imageError ? (\n    <div className=\"w-full h-full flex items-center justify-center p-2\">\n      <span className=\"text-xs text-muted-foreground text-center break-all\">\n        {displayName}\n      </span>\n    </div>\n  ) : (\n    <div className=\"w-full h-full p-4 flex items-center justify-center\">\n      <Image\n        src={\n          hostIndex === 0\n            ? getIconSvgUrl(iconName, { width: 64, height: 64 })\n            : buildIconSvgUrl(\n                ICONIFY_HOSTS[Math.min(hostIndex, ICONIFY_HOSTS.length - 1)],\n                iconName,\n                { width: 64, height: 64 }\n              )\n        }\n        alt={displayName}\n        width={64}\n        height={64}\n        className=\"w-full h-full object-contain\"\n        style={\n          capSize\n            ? {\n                maxWidth: \"var(--sticker-max, 160px)\",\n                maxHeight: \"var(--sticker-max, 160px)\",\n              }\n            : undefined\n        }\n        onError={() => {\n          const next = hostIndex + 1;\n          if (next < ICONIFY_HOSTS.length) {\n            setHostIndex(next);\n          } else {\n            setImageError(true);\n          }\n        }}\n        loading=\"lazy\"\n        unoptimized\n      />\n    </div>\n  );\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <div\n          className={cn(\n            \"relative\",\n            isAdding && \"opacity-50 pointer-events-none\"\n          )}\n        >\n          <DraggableMediaItem\n            name={displayName}\n            preview={preview}\n            dragData={{\n              id: \"sticker-placeholder\",\n              type: \"image\",\n              name: displayName,\n            }}\n            onAddToTimeline={() => onAdd(iconName)}\n            aspectRatio={1}\n            showLabel={false}\n            rounded={true}\n            variant=\"card\"\n            className=\"\"\n            containerClassName=\"w-full\"\n            isDraggable={false}\n          />\n          {isAdding && (\n            <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center rounded-md z-10\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-white\" />\n            </div>\n          )}\n        </div>\n      </TooltipTrigger>\n      <TooltipContent>\n        <div className=\"space-y-1\">\n          <p className=\"font-medium\">{displayName}</p>\n          <p className=\"text-xs text-muted-foreground\">{collectionPrefix}</p>\n        </div>\n      </TooltipContent>\n    </Tooltip>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2899, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/properties-panel/property-item.tsx"],"sourcesContent":["import { cn } from \"@/lib/utils\";\nimport { ChevronDown } from \"lucide-react\";\nimport { useState } from \"react\";\n\ninterface PropertyItemProps {\n  direction?: \"row\" | \"column\";\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport function PropertyItem({\n  direction = \"row\",\n  children,\n  className,\n}: PropertyItemProps) {\n  return (\n    <div\n      className={cn(\n        \"flex gap-2\",\n        direction === \"row\"\n          ? \"items-center justify-between gap-6\"\n          : \"flex-col gap-1.5\",\n        className\n      )}\n    >\n      {children}\n    </div>\n  );\n}\n\nexport function PropertyItemLabel({\n  children,\n  className,\n}: {\n  children: React.ReactNode;\n  className?: string;\n}) {\n  return (\n    <label className={cn(\"text-xs text-muted-foreground\", className)}>\n      {children}\n    </label>\n  );\n}\n\nexport function PropertyItemValue({\n  children,\n  className,\n}: {\n  children: React.ReactNode;\n  className?: string;\n}) {\n  return <div className={cn(\"flex-1 text-sm\", className)}>{children}</div>;\n}\n\ninterface PropertyGroupProps {\n  title: string;\n  children: React.ReactNode;\n  defaultExpanded?: boolean;\n  className?: string;\n  titleClassName?: string;\n}\n\nexport function PropertyGroup({\n  title,\n  children,\n  defaultExpanded = true,\n  className,\n  titleClassName,\n}: PropertyGroupProps) {\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\n\n  return (\n    <PropertyItem direction=\"column\" className={cn(\"gap-3\", className)}>\n      <div\n        className=\"flex items-center gap-1.5 cursor-pointer\"\n        onClick={() => setIsExpanded(!isExpanded)}\n      >\n        <PropertyItemLabel className={cn(\"cursor-pointer\", titleClassName)}>\n          {title}\n        </PropertyItemLabel>\n        <ChevronDown className={cn(\"size-3\", !isExpanded && \"-rotate-90\")} />\n      </div>\n      {isExpanded && <PropertyItemValue>{children}</PropertyItemValue>}\n    </PropertyItem>\n  );\n}\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;;;;;AAQO,SAAS,aAAa,EAC3B,YAAY,KAAK,EACjB,QAAQ,EACR,SAAS,EACS;IAClB,qBACE,mTAAC;QACC,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EACV,cACA,cAAc,QACV,uCACA,oBACJ;kBAGD;;;;;;AAGP;AAEO,SAAS,kBAAkB,EAChC,QAAQ,EACR,SAAS,EAIV;IACC,qBACE,mTAAC;QAAM,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;kBACnD;;;;;;AAGP;AAEO,SAAS,kBAAkB,EAChC,QAAQ,EACR,SAAS,EAIV;IACC,qBAAO,mTAAC;QAAI,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EAAE,kBAAkB;kBAAa;;;;;;AAC3D;AAUO,SAAS,cAAc,EAC5B,KAAK,EACL,QAAQ,EACR,kBAAkB,IAAI,EACtB,SAAS,EACT,cAAc,EACK;IACnB,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,0QAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,qBACE,mTAAC;QAAa,WAAU;QAAS,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EAAE,SAAS;;0BACtD,mTAAC;gBACC,WAAU;gBACV,SAAS,IAAM,cAAc,CAAC;;kCAE9B,mTAAC;wBAAkB,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EAAE,kBAAkB;kCAChD;;;;;;kCAEH,mTAAC,qSAAA,CAAA,cAAW;wBAAC,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EAAE,UAAU,CAAC,cAAc;;;;;;;;;;;;YAErD,4BAAc,mTAAC;0BAAmB;;;;;;;;;;;;AAGzC","debugId":null}},
    {"offset": {"line": 2992, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/views/settings.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { PanelBaseView as BaseView } from \"@/components/editor/panel-base-view\";\nimport {\n  PropertyItem,\n  PropertyItemLabel,\n  PropertyItemValue,\n  PropertyGroup,\n} from \"../../properties-panel/property-item\";\nimport { FPS_PRESETS } from \"@/constants/timeline-constants\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport type { BlurIntensity } from \"@/types/project\";\nimport { useEditorStore } from \"@/stores/editor-store\";\nimport { useAspectRatio } from \"@/hooks/use-aspect-ratio\";\nimport Image from \"next/image\";\nimport { cn } from \"@/lib/utils\";\nimport { colors } from \"@/data/colors/solid\";\nimport { patternCraftGradients } from \"@/data/colors/pattern-craft\";\nimport { PipetteIcon, PlusIcon } from \"lucide-react\";\nimport { useMemo, memo, useCallback } from \"react\";\nimport { syntaxUIGradients } from \"@/data/colors/syntax-ui\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\n\nexport function SettingsView() {\n  return <ProjectSettingsTabs />;\n}\n\nfunction ProjectSettingsTabs() {\n  return (\n    <BaseView\n      defaultTab=\"project-info\"\n      tabs={[\n        {\n          value: \"project-info\",\n          label: \"Project info\",\n          content: (\n            <div className=\"p-5\">\n              <ProjectInfoView />\n            </div>\n          ),\n        },\n        {\n          value: \"background\",\n          label: \"Background\",\n          content: (\n            <div className=\"flex flex-col justify-between h-full\">\n              <div className=\"flex-1 p-5\">\n                <BackgroundView />\n              </div>\n              <div className=\"flex flex-col sticky -bottom-0 bg-panel/85 backdrop-blur-lg\">\n                <Separator />\n                <Button className=\"w-fit h-auto p-5 py-4 !bg-transparent shadow-none text-muted-foreground hover:text-foreground/85 text-xs\">\n                  Custom background\n                  <PlusIcon />\n                </Button>\n              </div>\n\n              {/* Another UI, looks so beautiful i don't wanna remove it */}\n              {/* <div className=\"flex flex-col justify-center items-center pb-5 sticky bottom-0\">\n                <Button className=\"w-fit h-auto gap-1.5 px-3.5 py-1.5 bg-foreground hover:bg-foreground/85 text-background rounded-full\">\n                  <span className=\"text-sm\">Custom</span>\n                  <PlusIcon className=\"\" />\n                </Button>\n              </div> */}\n            </div>\n          ),\n        },\n      ]}\n      className=\"flex flex-col justify-between h-full p-0\"\n    />\n  );\n}\n\nfunction ProjectInfoView() {\n  const { activeProject, updateProjectFps, updateCanvasSize } =\n    useProjectStore();\n  const { canvasPresets } = useEditorStore();\n  const { getDisplayName } = useAspectRatio();\n\n  const handleAspectRatioChange = (value: string) => {\n    const preset = canvasPresets.find((p) => p.name === value);\n    if (preset) {\n      updateCanvasSize(\n        { width: preset.width, height: preset.height },\n        \"preset\"\n      );\n    }\n  };\n\n  const handleFpsChange = (value: string) => {\n    const fps = parseFloat(value);\n    updateProjectFps(fps);\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      <PropertyItem direction=\"column\">\n        <PropertyItemLabel>Name</PropertyItemLabel>\n        <PropertyItemValue>\n          {activeProject?.name || \"Untitled project\"}\n        </PropertyItemValue>\n      </PropertyItem>\n\n      <PropertyItem direction=\"column\">\n        <PropertyItemLabel>Aspect ratio</PropertyItemLabel>\n        <PropertyItemValue>\n          <Select\n            value={getDisplayName()}\n            onValueChange={handleAspectRatioChange}\n          >\n            <SelectTrigger className=\"bg-panel-accent\">\n              <SelectValue placeholder=\"Select an aspect ratio\" />\n            </SelectTrigger>\n            <SelectContent>\n              {canvasPresets.map((preset) => (\n                <SelectItem key={preset.name} value={preset.name}>\n                  {preset.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </PropertyItemValue>\n      </PropertyItem>\n\n      <PropertyItem direction=\"column\">\n        <PropertyItemLabel>Frame rate</PropertyItemLabel>\n        <PropertyItemValue>\n          <Select\n            value={(activeProject?.fps || 30).toString()}\n            onValueChange={handleFpsChange}\n          >\n            <SelectTrigger className=\"bg-panel-accent\">\n              <SelectValue placeholder=\"Select a frame rate\" />\n            </SelectTrigger>\n            <SelectContent>\n              {FPS_PRESETS.map((preset) => (\n                <SelectItem key={preset.value} value={preset.value}>\n                  {preset.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </PropertyItemValue>\n      </PropertyItem>\n    </div>\n  );\n}\n\nconst BlurPreview = memo(\n  ({\n    blur,\n    isSelected,\n    onSelect,\n  }: {\n    blur: { label: string; value: number };\n    isSelected: boolean;\n    onSelect: () => void;\n  }) => (\n    <div\n      className={cn(\n        \"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary relative overflow-hidden\",\n        isSelected && \"border-2 border-primary\"\n      )}\n      onClick={onSelect}\n    >\n      <Image\n        src=\"https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\"\n        alt={`Blur preview ${blur.label}`}\n        fill\n        className=\"object-cover\"\n        style={{ filter: `blur(${blur.value}px)` }}\n        loading=\"eager\"\n      />\n      <div className=\"absolute bottom-1 left-1 right-1 text-center\">\n        <span className=\"text-xs text-white bg-black/50 px-1 rounded\">\n          {blur.label}\n        </span>\n      </div>\n    </div>\n  )\n);\n\nBlurPreview.displayName = \"BlurPreview\";\n\nconst BackgroundPreviews = memo(\n  ({\n    backgrounds,\n    currentBackgroundColor,\n    isColorBackground,\n    handleColorSelect,\n    useBackgroundColor = false,\n  }: {\n    backgrounds: string[];\n    currentBackgroundColor: string;\n    isColorBackground: boolean;\n    handleColorSelect: (bg: string) => void;\n    useBackgroundColor?: boolean;\n  }) => {\n    return useMemo(\n      () =>\n        backgrounds.map((bg, index) => (\n          <div\n            key={`${index}-${bg}`}\n            className={cn(\n              \"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary\",\n              isColorBackground &&\n                bg === currentBackgroundColor &&\n                \"border-2 border-primary\"\n            )}\n            style={\n              useBackgroundColor\n                ? { backgroundColor: bg }\n                : {\n                    background: bg,\n                    backgroundSize: \"cover\",\n                    backgroundPosition: \"center\",\n                    backgroundRepeat: \"no-repeat\",\n                  }\n            }\n            onClick={() => handleColorSelect(bg)}\n          />\n        )),\n      [\n        backgrounds,\n        isColorBackground,\n        currentBackgroundColor,\n        handleColorSelect,\n        useBackgroundColor,\n      ]\n    );\n  }\n);\n\nBackgroundPreviews.displayName = \"BackgroundPreviews\";\n\nfunction BackgroundView() {\n  const { activeProject, updateBackgroundType } = useProjectStore();\n\n  const blurLevels = useMemo<Array<{ label: string; value: BlurIntensity }>>(\n    () => [\n      { label: \"Light\", value: 4 },\n      { label: \"Medium\", value: 8 },\n      { label: \"Heavy\", value: 18 },\n    ],\n    []\n  );\n\n  const handleBlurSelect = useCallback(\n    async (blurIntensity: BlurIntensity) => {\n      await updateBackgroundType(\"blur\", { blurIntensity });\n    },\n    [updateBackgroundType]\n  );\n\n  const handleColorSelect = useCallback(\n    async (color: string) => {\n      await updateBackgroundType(\"color\", { backgroundColor: color });\n    },\n    [updateBackgroundType]\n  );\n\n  const currentBlurIntensity = activeProject?.blurIntensity || 8;\n  const isBlurBackground = activeProject?.backgroundType === \"blur\";\n  const currentBackgroundColor = activeProject?.backgroundColor || \"#000000\";\n  const isColorBackground = activeProject?.backgroundType === \"color\";\n\n  const blurPreviews = useMemo(\n    () =>\n      blurLevels.map((blur) => (\n        <BlurPreview\n          key={blur.value}\n          blur={blur}\n          isSelected={isBlurBackground && currentBlurIntensity === blur.value}\n          onSelect={() => handleBlurSelect(blur.value)}\n        />\n      )),\n    [blurLevels, isBlurBackground, currentBlurIntensity, handleBlurSelect]\n  );\n\n  return (\n    <div className=\"flex flex-col gap-4 h-full\">\n      <PropertyGroup title=\"Blur\" defaultExpanded={false}>\n        <div className=\"grid grid-cols-4 gap-2 w-full\">{blurPreviews}</div>\n      </PropertyGroup>\n\n      <PropertyGroup title=\"Colors\" defaultExpanded={false}>\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\n          <div className=\"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary flex items-center justify-center\">\n            <PipetteIcon className=\"size-4\" />\n          </div>\n          <BackgroundPreviews\n            backgrounds={colors}\n            currentBackgroundColor={currentBackgroundColor}\n            isColorBackground={isColorBackground}\n            handleColorSelect={handleColorSelect}\n            useBackgroundColor={true}\n          />\n        </div>\n      </PropertyGroup>\n\n      <PropertyGroup title=\"Pattern craft\" defaultExpanded={false}>\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\n          <BackgroundPreviews\n            backgrounds={patternCraftGradients}\n            currentBackgroundColor={currentBackgroundColor}\n            isColorBackground={isColorBackground}\n            handleColorSelect={handleColorSelect}\n          />\n        </div>\n      </PropertyGroup>\n\n      <PropertyGroup title=\"Syntax UI\" defaultExpanded={false}>\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\n          <BackgroundPreviews\n            backgrounds={syntaxUIGradients}\n            currentBackgroundColor={currentBackgroundColor}\n            isColorBackground={isColorBackground}\n            handleColorSelect={handleColorSelect}\n          />\n        </div>\n      </PropertyGroup>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3525, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/views/captions.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\nimport { PropertyGroup } from \"../../properties-panel/property-item\";\nimport { PanelBaseView as BaseView } from \"@/components/editor/panel-base-view\";\nimport { Language, LanguageSelect } from \"@/components/language-select\";\nimport { useState, useRef, useEffect } from \"react\";\nimport { extractTimelineAudio } from \"@/lib/mediabunny-utils\";\nimport { encryptWithRandomKey, arrayBufferToBase64 } from \"@/lib/zk-encryption\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { DEFAULT_TEXT_ELEMENT } from \"@/constants/text-constants\";\nimport { Loader2, Shield, Trash2, Upload } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { TextElement } from \"@/types/timeline\";\n\nexport const languages: Language[] = [\n  { code: \"US\", name: \"English\" },\n  { code: \"ES\", name: \"Spanish\" },\n  { code: \"IT\", name: \"Italian\" },\n  { code: \"FR\", name: \"French\" },\n  { code: \"DE\", name: \"German\" },\n  { code: \"PT\", name: \"Portuguese\" },\n  { code: \"RU\", name: \"Russian\" },\n  { code: \"JP\", name: \"Japanese\" },\n  { code: \"CN\", name: \"Chinese\" },\n];\n\nconst PRIVACY_DIALOG_KEY = \"opencut-transcription-privacy-accepted\";\n\nexport function Captions() {\n  const [selectedCountry, setSelectedCountry] = useState(\"auto\");\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [processingStep, setProcessingStep] = useState<string>(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [showPrivacyDialog, setShowPrivacyDialog] = useState(false);\n  const [hasAcceptedPrivacy, setHasAcceptedPrivacy] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { insertTrackAt, addElementToTrack } = useTimelineStore();\n\n  // Check if user has already accepted privacy on mount\n  useEffect(() => {\n    const hasAccepted = localStorage.getItem(PRIVACY_DIALOG_KEY) === \"true\";\n    setHasAcceptedPrivacy(hasAccepted);\n  }, []);\n\n  const handleGenerateTranscript = async () => {\n    try {\n      setIsProcessing(true);\n      setError(null);\n      setProcessingStep(\"Extracting audio...\");\n\n      const audioBlob = await extractTimelineAudio();\n\n      setProcessingStep(\"Encrypting audio...\");\n\n      // Encrypt the audio with a random key (zero-knowledge)\n      const audioBuffer = await audioBlob.arrayBuffer();\n      const encryptionResult = await encryptWithRandomKey(audioBuffer);\n\n      // Convert encrypted data to blob for upload\n      const encryptedBlob = new Blob([encryptionResult.encryptedData]);\n\n      setProcessingStep(\"Uploading...\");\n      const uploadResponse = await fetch(\"/api/get-upload-url\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ fileExtension: \"wav\" }),\n      });\n\n      if (!uploadResponse.ok) {\n        const error = await uploadResponse.json();\n        throw new Error(error.message || \"Failed to get upload URL\");\n      }\n\n      const { uploadUrl, fileName } = await uploadResponse.json();\n\n      // Upload to R2\n      await fetch(uploadUrl, {\n        method: \"PUT\",\n        body: encryptedBlob,\n      });\n\n      setProcessingStep(\"Transcribing...\");\n\n      // Call Modal transcription API with encryption parameters\n      const transcriptionResponse = await fetch(\"/api/transcribe\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          filename: fileName,\n          language:\n            selectedCountry === \"auto\" ? \"auto\" : selectedCountry.toLowerCase(),\n          // Send the raw encryption key and IV (zero-knowledge)\n          decryptionKey: arrayBufferToBase64(encryptionResult.key),\n          iv: arrayBufferToBase64(encryptionResult.iv),\n        }),\n      });\n\n      if (!transcriptionResponse.ok) {\n        const error = await transcriptionResponse.json();\n        throw new Error(error.message || \"Transcription failed\");\n      }\n\n      const { text, segments } = await transcriptionResponse.json();\n\n      console.log(\"Transcription completed:\", { text, segments });\n\n      const shortCaptions: Array<{\n        text: string;\n        startTime: number;\n        duration: number;\n      }> = [];\n\n      let globalEndTime = 0; // Track the end time of the last caption globally\n\n      segments.forEach((segment: any) => {\n        const words = segment.text.trim().split(/\\s+/);\n        const segmentDuration = segment.end - segment.start;\n        const wordsPerSecond = words.length / segmentDuration;\n\n        // Split into chunks of 2-4 words\n        const chunks: string[] = [];\n        for (let i = 0; i < words.length; i += 3) {\n          chunks.push(words.slice(i, i + 3).join(\" \"));\n        }\n\n        // Calculate timing for each chunk to place them sequentially\n        let chunkStartTime = segment.start;\n        chunks.forEach((chunk) => {\n          const chunkWords = chunk.split(/\\s+/).length;\n          const chunkDuration = Math.max(0.8, chunkWords / wordsPerSecond); // Minimum 0.8s per chunk\n\n          let adjustedStartTime = chunkStartTime;\n\n          // Prevent overlapping: if this caption would start before the last one ends,\n          // start it right after the last one ends\n          if (adjustedStartTime < globalEndTime) {\n            adjustedStartTime = globalEndTime;\n          }\n\n          shortCaptions.push({\n            text: chunk,\n            startTime: adjustedStartTime,\n            duration: chunkDuration,\n          });\n\n          // Update global end time\n          globalEndTime = adjustedStartTime + chunkDuration;\n\n          // Next chunk starts when this one ends (for within-segment timing)\n          chunkStartTime += chunkDuration;\n        });\n      });\n\n      // Create a single track for all captions\n      const captionTrackId = insertTrackAt(\"text\", 0);\n\n      // Add all caption elements to the same track\n      shortCaptions.forEach((caption, index) => {\n        addElementToTrack(captionTrackId, {\n          ...DEFAULT_TEXT_ELEMENT,\n          name: `Caption ${index + 1}`,\n          content: caption.text,\n          duration: caption.duration,\n          startTime: caption.startTime,\n          fontSize: 65, // Larger for captions\n          fontWeight: \"bold\", // Bold for captions\n        } as TextElement);\n      });\n\n      console.log(\n        `✅ ${shortCaptions.length} short-form caption chunks added to timeline!`\n      );\n    } catch (error) {\n      console.error(\"Transcription failed:\", error);\n      setError(\n        error instanceof Error ? error.message : \"An unexpected error occurred\"\n      );\n    } finally {\n      setIsProcessing(false);\n      setProcessingStep(\"\");\n    }\n  };\n\n  return (\n    <BaseView ref={containerRef} className=\"flex flex-col justify-between h-full\">\n      <PropertyGroup title=\"Language\">\n        <LanguageSelect\n          selectedCountry={selectedCountry}\n          onSelect={setSelectedCountry}\n          containerRef={containerRef}\n          languages={languages}\n        />\n      </PropertyGroup>\n\n      <div className=\"flex flex-col gap-4\">\n        {error && (\n          <div className=\"p-3 bg-destructive/10 border border-destructive/20 rounded-md\">\n            <p className=\"text-sm text-destructive\">{error}</p>\n          </div>\n        )}\n\n        <Button\n          className=\"w-full\"\n          onClick={() => {\n            if (hasAcceptedPrivacy) {\n              handleGenerateTranscript();\n            } else {\n              setShowPrivacyDialog(true);\n            }\n          }}\n          disabled={isProcessing}\n        >\n          {isProcessing && <Loader2 className=\"mr-1 h-4 w-4 animate-spin\" />}\n          {isProcessing ? processingStep : \"Generate transcript\"}\n        </Button>\n\n        <Dialog open={showPrivacyDialog} onOpenChange={setShowPrivacyDialog}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5\" />\n                Audio Processing Notice\n              </DialogTitle>\n              <DialogDescription className=\"space-y-3\">\n                <p>\n                  To generate captions, we need to process your timeline audio\n                  using speech-to-text technology.\n                </p>\n\n                <div className=\"space-y-2 pt-2\">\n                  <div className=\"flex items-start gap-2\">\n                    <Shield className=\"h-4 w-4 flex-shrink-0\" />\n                    <span className=\"text-sm\">\n                      Zero-knowledge encryption - we cannot decrypt your files\n                      even if we wanted to\n                    </span>\n                  </div>\n\n                  <div className=\"flex items-start gap-2\">\n                    <Shield className=\"h-4 w-4 flex-shrink-0\" />\n                    <span className=\"text-sm\">\n                      Encryption keys generated randomly in your browser, never\n                      stored anywhere\n                    </span>\n                  </div>\n\n                  <div className=\"flex items-start gap-2\">\n                    <Upload className=\"h-4 w-4 flex-shrink-0\" />\n                    <span className=\"text-sm\">\n                      Audio encrypted before upload - raw audio never leaves\n                      your device\n                    </span>\n                  </div>\n\n                  <div className=\"flex items-start gap-2\">\n                    <Trash2 className=\"h-4 w-4 flex-shrink-0\" />\n                    <span className=\"text-sm\">\n                      Everything permanently deleted within seconds after\n                      transcription\n                    </span>\n                  </div>\n                </div>\n\n                <p className=\"text-xs text-muted-foreground\">\n                  <strong>True zero-knowledge privacy:</strong> Encryption keys\n                  are generated randomly in your browser and never stored\n                  anywhere. It's cryptographically impossible for us, our cloud\n                  providers, or anyone else to decrypt your audio files.\n                </p>\n              </DialogDescription>\n            </DialogHeader>\n            <DialogFooter className=\"gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowPrivacyDialog(false)}\n                disabled={isProcessing}\n              >\n                Cancel\n              </Button>\n              <Button\n                onClick={() => {\n                  localStorage.setItem(PRIVACY_DIALOG_KEY, \"true\");\n                  setHasAcceptedPrivacy(true);\n                  setShowPrivacyDialog(false);\n                  handleGenerateTranscript();\n                }}\n                disabled={isProcessing}\n              >\n                Continue & Generate Captions\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </BaseView>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4017, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/media-panel/index.tsx"],"sourcesContent":["\"use client\";\n\nimport { TabBar } from \"./tabbar\";\nimport { MediaView } from \"./views/media\";\nimport { useMediaPanelStore, Tab } from \"./store\";\nimport { TextView } from \"./views/text\";\nimport { SoundsView } from \"./views/sounds\";\nimport { StickersView } from \"./views/stickers\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { SettingsView } from \"./views/settings\";\nimport { Captions } from \"./views/captions\";\n\nexport function MediaPanel() {\n  const { activeTab } = useMediaPanelStore();\n\n  const viewMap: Record<Tab, React.ReactNode> = {\n    media: <MediaView />,\n    sounds: <SoundsView />,\n    text: <TextView />,\n    stickers: <StickersView />,\n    effects: (\n      <div className=\"p-4 text-muted-foreground\">\n        Effects view coming soon...\n      </div>\n    ),\n    transitions: (\n      <div className=\"p-4 text-muted-foreground\">\n        Transitions view coming soon...\n      </div>\n    ),\n    captions: <Captions />,\n    filters: (\n      <div className=\"p-4 text-muted-foreground\">\n        Filters view coming soon...\n      </div>\n    ),\n    adjustment: (\n      <div className=\"p-4 text-muted-foreground\">\n        Adjustment view coming soon...\n      </div>\n    ),\n    settings: <SettingsView />,\n  };\n\n  return (\n    <div className=\"h-full flex bg-panel\">\n      <TabBar />\n      <Separator orientation=\"vertical\" />\n      <div className=\"flex-1 overflow-hidden\">{viewMap[activeTab]}</div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;;;;;;;;;;;AAYO,SAAS;IACd,MAAM,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,qKAAA,CAAA,qBAAkB,AAAD;IAEvC,MAAM,UAAwC;QAC5C,qBAAO,mTAAC,+KAAA,CAAA,YAAS;;;;;QACjB,sBAAQ,mTAAC,gLAAA,CAAA,aAAU;;;;;QACnB,oBAAM,mTAAC,8KAAA,CAAA,WAAQ;;;;;QACf,wBAAU,mTAAC,kLAAA,CAAA,eAAY;;;;;QACvB,uBACE,mTAAC;YAAI,WAAU;sBAA4B;;;;;;QAI7C,2BACE,mTAAC;YAAI,WAAU;sBAA4B;;;;;;QAI7C,wBAAU,mTAAC,kLAAA,CAAA,WAAQ;;;;;QACnB,uBACE,mTAAC;YAAI,WAAU;sBAA4B;;;;;;QAI7C,0BACE,mTAAC;YAAI,WAAU;sBAA4B;;;;;;QAI7C,wBAAU,mTAAC,kLAAA,CAAA,eAAY;;;;;IACzB;IAEA,qBACE,mTAAC;QAAI,WAAU;;0BACb,mTAAC,uKAAA,CAAA,SAAM;;;;;0BACP,mTAAC,oJAAA,CAAA,YAAS;gBAAC,aAAY;;;;;;0BACvB,mTAAC;gBAAI,WAAU;0BAA0B,OAAO,CAAC,UAAU;;;;;;;;;;;;AAGjE","debugId":null}},
    {"offset": {"line": 4141, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/properties-panel/audio-properties.tsx"],"sourcesContent":["import { MediaElement } from \"@/types/timeline\";\n\nexport function AudioProperties({ element }: { element: MediaElement }) {\n  return <div className=\"space-y-4 p-5\">Audio properties</div>;\n}\n"],"names":[],"mappings":";;;;;AAEO,SAAS,gBAAgB,EAAE,OAAO,EAA6B;IACpE,qBAAO,mTAAC;QAAI,WAAU;kBAAgB;;;;;;AACxC","debugId":null}},
    {"offset": {"line": 4160, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/properties-panel/media-properties.tsx"],"sourcesContent":["import { MediaElement } from \"@/types/timeline\";\n\nexport function MediaProperties({ element }: { element: MediaElement }) {\n  return <div className=\"space-y-4 p-5\">Media properties</div>;\n}\n"],"names":[],"mappings":";;;;;AAEO,SAAS,gBAAgB,EAAE,OAAO,EAA6B;IACpE,qBAAO,mTAAC;QAAI,WAAU;kBAAgB;;;;;;AACxC","debugId":null}},
    {"offset": {"line": 4179, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/properties-panel/text-properties.tsx"],"sourcesContent":["import { Textarea } from \"@/components/ui/textarea\";\nimport { FontPicker } from \"@/components/ui/font-picker\";\nimport { FontFamily } from \"@/constants/font-constants\";\nimport { TextElement } from \"@/types/timeline\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState, useRef } from \"react\";\nimport { PanelBaseView } from \"@/components/editor/panel-base-view\";\nimport {\n  TEXT_PROPERTIES_TABS,\n  isTextPropertiesTab,\n  useTextPropertiesStore,\n} from \"@/stores/text-properties-store\";\nimport {\n  PropertyItem,\n  PropertyItemLabel,\n  PropertyItemValue,\n} from \"./property-item\";\nimport { ColorPicker } from \"@/components/ui/color-picker\";\nimport { cn, uppercase } from \"@/lib/utils\";\nimport { Grid2x2 } from \"lucide-react\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\nexport function TextProperties({\n  element,\n  trackId,\n}: {\n  element: TextElement;\n  trackId: string;\n}) {\n  const { updateTextElement } = useTimelineStore();\n  const { activeTab, setActiveTab } = useTextPropertiesStore();\n  const containerRef = useRef<HTMLDivElement>(null);\n  // Local state for input values to allow temporary empty/invalid states\n  const [fontSizeInput, setFontSizeInput] = useState(\n    element.fontSize.toString()\n  );\n  const [opacityInput, setOpacityInput] = useState(\n    Math.round(element.opacity * 100).toString()\n  );\n\n  // Track the last selected color for toggling\n  const lastSelectedColor = useRef(\"#000000\");\n\n  const parseAndValidateNumber = (\n    value: string,\n    min: number,\n    max: number,\n    fallback: number\n  ): number => {\n    const parsed = parseInt(value, 10);\n    if (isNaN(parsed)) return fallback;\n    return Math.max(min, Math.min(max, parsed));\n  };\n\n  const handleFontSizeChange = (value: string) => {\n    setFontSizeInput(value);\n\n    if (value.trim() !== \"\") {\n      const fontSize = parseAndValidateNumber(value, 8, 300, element.fontSize);\n      updateTextElement(trackId, element.id, { fontSize });\n    }\n  };\n\n  const handleFontSizeBlur = () => {\n    const fontSize = parseAndValidateNumber(\n      fontSizeInput,\n      8,\n      300,\n      element.fontSize\n    );\n    setFontSizeInput(fontSize.toString());\n    updateTextElement(trackId, element.id, { fontSize });\n  };\n\n  const handleOpacityChange = (value: string) => {\n    setOpacityInput(value);\n\n    if (value.trim() !== \"\") {\n      const opacityPercent = parseAndValidateNumber(\n        value,\n        0,\n        100,\n        Math.round(element.opacity * 100)\n      );\n      updateTextElement(trackId, element.id, { opacity: opacityPercent / 100 });\n    }\n  };\n\n  const handleOpacityBlur = () => {\n    const opacityPercent = parseAndValidateNumber(\n      opacityInput,\n      0,\n      100,\n      Math.round(element.opacity * 100)\n    );\n    setOpacityInput(opacityPercent.toString());\n    updateTextElement(trackId, element.id, { opacity: opacityPercent / 100 });\n  };\n\n  // Update last selected color when a new color is picked\n  const handleColorChange = (color: string) => {\n    if (color !== \"transparent\") {\n      lastSelectedColor.current = color;\n    }\n    updateTextElement(trackId, element.id, { backgroundColor: color });\n  };\n\n  // Toggle between transparent and last selected color\n  const handleTransparentToggle = (isTransparent: boolean) => {\n    const newColor = isTransparent ? \"transparent\" : lastSelectedColor.current;\n    updateTextElement(trackId, element.id, { backgroundColor: newColor });\n  };\n\n  return (\n    <PanelBaseView\n      defaultTab=\"transform\"\n      value={activeTab}\n      onValueChange={(v) => {\n        if (isTextPropertiesTab(v)) setActiveTab(v);\n      }}\n      ref={containerRef}\n      tabs={TEXT_PROPERTIES_TABS.map((t) => ({\n        value: t.value,\n        label: t.label,\n        content:\n          t.value === \"transform\" ? (\n            <div className=\"space-y-6\"></div>\n          ) : (\n            <div className=\"space-y-6\">\n              <Textarea\n                placeholder=\"Name\"\n                defaultValue={element.content}\n                className=\"min-h-18 resize-none bg-panel-accent\"\n                onChange={(e) =>\n                  updateTextElement(trackId, element.id, {\n                    content: e.target.value,\n                  })\n                }\n              />\n              <PropertyItem direction=\"column\">\n                <PropertyItemLabel>Font</PropertyItemLabel>\n                <PropertyItemValue>\n                  <FontPicker\n                    defaultValue={element.fontFamily}\n                    onValueChange={(value: FontFamily) =>\n                      updateTextElement(trackId, element.id, {\n                        fontFamily: value,\n                      })\n                    }\n                  />\n                </PropertyItemValue>\n              </PropertyItem>\n              <PropertyItem direction=\"column\">\n                <PropertyItemLabel>Style</PropertyItemLabel>\n                <PropertyItemValue>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant={\n                        element.fontWeight === \"bold\" ? \"default\" : \"outline\"\n                      }\n                      size=\"sm\"\n                      onClick={() =>\n                        updateTextElement(trackId, element.id, {\n                          fontWeight:\n                            element.fontWeight === \"bold\" ? \"normal\" : \"bold\",\n                        })\n                      }\n                      className=\"h-8 px-3 font-bold\"\n                    >\n                      B\n                    </Button>\n                    <Button\n                      variant={\n                        element.fontStyle === \"italic\" ? \"default\" : \"outline\"\n                      }\n                      size=\"sm\"\n                      onClick={() =>\n                        updateTextElement(trackId, element.id, {\n                          fontStyle:\n                            element.fontStyle === \"italic\"\n                              ? \"normal\"\n                              : \"italic\",\n                        })\n                      }\n                      className=\"h-8 px-3 italic\"\n                    >\n                      I\n                    </Button>\n                    <Button\n                      variant={\n                        element.textDecoration === \"underline\"\n                          ? \"default\"\n                          : \"outline\"\n                      }\n                      size=\"sm\"\n                      onClick={() =>\n                        updateTextElement(trackId, element.id, {\n                          textDecoration:\n                            element.textDecoration === \"underline\"\n                              ? \"none\"\n                              : \"underline\",\n                        })\n                      }\n                      className=\"h-8 px-3 underline\"\n                    >\n                      U\n                    </Button>\n                    <Button\n                      variant={\n                        element.textDecoration === \"line-through\"\n                          ? \"default\"\n                          : \"outline\"\n                      }\n                      size=\"sm\"\n                      onClick={() =>\n                        updateTextElement(trackId, element.id, {\n                          textDecoration:\n                            element.textDecoration === \"line-through\"\n                              ? \"none\"\n                              : \"line-through\",\n                        })\n                      }\n                      className=\"h-8 px-3 line-through\"\n                    >\n                      S\n                    </Button>\n                  </div>\n                </PropertyItemValue>\n              </PropertyItem>\n              <PropertyItem direction=\"column\">\n                <PropertyItemLabel>Font size</PropertyItemLabel>\n                <PropertyItemValue>\n                  <div className=\"flex items-center gap-2\">\n                    <Slider\n                      value={[element.fontSize]}\n                      min={8}\n                      max={300}\n                      step={1}\n                      onValueChange={([value]) => {\n                        updateTextElement(trackId, element.id, {\n                          fontSize: value,\n                        });\n                        setFontSizeInput(value.toString());\n                      }}\n                      className=\"w-full\"\n                    />\n                    <Input\n                      type=\"number\"\n                      value={fontSizeInput}\n                      min={8}\n                      max={300}\n                      onChange={(e) => handleFontSizeChange(e.target.value)}\n                      onBlur={handleFontSizeBlur}\n                      className=\"w-12 px-2 !text-xs h-7 rounded-sm text-center bg-panel-accent\n               [appearance:textfield]\n               [&::-webkit-outer-spin-button]:appearance-none\n               [&::-webkit-inner-spin-button]:appearance-none\"\n                    />\n                  </div>\n                </PropertyItemValue>\n              </PropertyItem>\n              <PropertyItem direction=\"column\">\n                <PropertyItemLabel>Color</PropertyItemLabel>\n                <PropertyItemValue>\n                  <ColorPicker\n                    value={uppercase(\n                      (element.color || \"FFFFFF\").replace(\"#\", \"\")\n                    )}\n                    onChange={(color) => {\n                      updateTextElement(trackId, element.id, {\n                        color: `#${color}`,\n                      });\n                    }}\n                    containerRef={containerRef}\n                  />\n                </PropertyItemValue>\n              </PropertyItem>\n              <PropertyItem direction=\"column\">\n                <PropertyItemLabel>Opacity</PropertyItemLabel>\n                <PropertyItemValue>\n                  <div className=\"flex items-center gap-2\">\n                    <Slider\n                      value={[element.opacity * 100]}\n                      min={0}\n                      max={100}\n                      step={1}\n                      onValueChange={([value]) => {\n                        updateTextElement(trackId, element.id, {\n                          opacity: value / 100,\n                        });\n                        setOpacityInput(value.toString());\n                      }}\n                      className=\"w-full\"\n                    />\n                    <Input\n                      type=\"number\"\n                      value={opacityInput}\n                      min={0}\n                      max={100}\n                      onChange={(e) => handleOpacityChange(e.target.value)}\n                      onBlur={handleOpacityBlur}\n                      className=\"w-12 !text-xs h-7 rounded-sm text-center bg-panel-accent\n               [appearance:textfield]\n               [&::-webkit-outer-spin-button]:appearance-none\n               [&::-webkit-inner-spin-button]:appearance-none\"\n                    />\n                  </div>\n                </PropertyItemValue>\n              </PropertyItem>\n              <PropertyItem direction=\"column\">\n                <PropertyItemLabel>Background</PropertyItemLabel>\n                <PropertyItemValue>\n                  <div className=\"flex items-center gap-2\">\n                    <ColorPicker\n                      value={uppercase(\n                        element.backgroundColor === \"transparent\"\n                          ? lastSelectedColor.current.replace(\"#\", \"\")\n                          : (element.backgroundColor || \"#000000\").replace(\n                              \"#\",\n                              \"\"\n                            )\n                      )}\n                      onChange={(color) => handleColorChange(`#${color}`)}\n                      containerRef={containerRef}\n                      className={\n                        element.backgroundColor === \"transparent\"\n                          ? \"opacity-50 pointer-events-none\"\n                          : \"\"\n                      }\n                    />\n\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          size=\"icon\"\n                          onClick={() =>\n                            handleTransparentToggle(\n                              element.backgroundColor !== \"transparent\"\n                            )\n                          }\n                          className=\"size-9 rounded-full bg-panel-accent p-0 overflow-hidden\"\n                        >\n                          <Grid2x2\n                            className={cn(\n                              \"text-foreground\",\n                              element.backgroundColor === \"transparent\" &&\n                                \"text-primary\"\n                            )}\n                          />\n                        </Button>\n                      </TooltipTrigger>\n                      <TooltipContent>Transparent background</TooltipContent>\n                    </Tooltip>\n                  </div>\n                </PropertyItemValue>\n              </PropertyItem>\n            </div>\n          ),\n      }))}\n    />\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4678, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/properties-panel/index.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMediaStore } from \"@/stores/media-store\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { ScrollArea } from \"../../ui/scroll-area\";\nimport { AudioProperties } from \"./audio-properties\";\nimport { MediaProperties } from \"./media-properties\";\nimport { TextProperties } from \"./text-properties\";\nimport { SquareSlashIcon } from \"lucide-react\";\n\nexport function PropertiesPanel() {\n  const { selectedElements, tracks } = useTimelineStore();\n  const { mediaFiles } = useMediaStore();\n\n  return (\n    <>\n      {selectedElements.length > 0 ? (\n        <ScrollArea className=\"h-full bg-panel rounded-sm\">\n          {selectedElements.map(({ trackId, elementId }) => {\n            const track = tracks.find((t) => t.id === trackId);\n            const element = track?.elements.find((e) => e.id === elementId);\n\n            if (element?.type === \"text\") {\n              return (\n                <div key={elementId}>\n                  <TextProperties element={element} trackId={trackId} />\n                </div>\n              );\n            }\n            if (element?.type === \"media\") {\n              const mediaFile = mediaFiles.find(\n                (file) => file.id === element.mediaId\n              );\n\n              if (mediaFile?.type === \"audio\") {\n                return <AudioProperties key={elementId} element={element} />;\n              }\n\n              return (\n                <div key={elementId}>\n                  <MediaProperties element={element} />\n                </div>\n              );\n            }\n            return null;\n          })}\n        </ScrollArea>\n      ) : (\n        <EmptyView />\n      )}\n    </>\n  );\n}\n\nfunction EmptyView() {\n  return (\n    <div className=\"bg-panel h-full p-4 flex flex-col items-center justify-center gap-3\">\n      <SquareSlashIcon\n        className=\"w-10 h-10 text-muted-foreground\"\n        strokeWidth={1.5}\n      />\n      <div className=\"flex flex-col gap-2 text-center\">\n        <p className=\"text-lg font-medium\">It’s empty here</p>\n        <p className=\"text-sm text-muted-foreground text-balance\">\n          Click an element on the timeline to edit its properties\n        </p>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;;;;;;;;AAUO,SAAS;IACd,MAAM,EAAE,gBAAgB,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,iJAAA,CAAA,mBAAgB,AAAD;IACpD,MAAM,EAAE,UAAU,EAAE,GAAG,CAAA,GAAA,8IAAA,CAAA,gBAAa,AAAD;IAEnC,qBACE;kBACG,iBAAiB,MAAM,GAAG,kBACzB,mTAAC,yJAAA,CAAA,aAAU;YAAC,WAAU;sBACnB,iBAAiB,GAAG,CAAC,CAAC,EAAE,OAAO,EAAE,SAAS,EAAE;gBAC3C,MAAM,QAAQ,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBAC1C,MAAM,UAAU,OAAO,SAAS,KAAK,CAAC,IAAM,EAAE,EAAE,KAAK;gBAErD,IAAI,SAAS,SAAS,QAAQ;oBAC5B,qBACE,mTAAC;kCACC,cAAA,mTAAC,wLAAA,CAAA,iBAAc;4BAAC,SAAS;4BAAS,SAAS;;;;;;uBADnC;;;;;gBAId;gBACA,IAAI,SAAS,SAAS,SAAS;oBAC7B,MAAM,YAAY,WAAW,IAAI,CAC/B,CAAC,OAAS,KAAK,EAAE,KAAK,QAAQ,OAAO;oBAGvC,IAAI,WAAW,SAAS,SAAS;wBAC/B,qBAAO,mTAAC,yLAAA,CAAA,kBAAe;4BAAiB,SAAS;2BAApB;;;;;oBAC/B;oBAEA,qBACE,mTAAC;kCACC,cAAA,mTAAC,yLAAA,CAAA,kBAAe;4BAAC,SAAS;;;;;;uBADlB;;;;;gBAId;gBACA,OAAO;YACT;;;;;iCAGF,mTAAC;;;;;;AAIT;AAEA,SAAS;IACP,qBACE,mTAAC;QAAI,WAAU;;0BACb,mTAAC,ySAAA,CAAA,kBAAe;gBACd,WAAU;gBACV,aAAa;;;;;;0BAEf,mTAAC;gBAAI,WAAU;;kCACb,mTAAC;wBAAE,WAAU;kCAAsB;;;;;;kCACnC,mTAAC;wBAAE,WAAU;kCAA6C;;;;;;;;;;;;;;;;;;AAMlE","debugId":null}},
    {"offset": {"line": 4809, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/audio-waveform.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport WaveSurfer from \"wavesurfer.js\";\n\ninterface AudioWaveformProps {\n  audioUrl: string;\n  height?: number;\n  className?: string;\n}\n\nconst AudioWaveform: React.FC<AudioWaveformProps> = ({\n  audioUrl,\n  height = 32,\n  className = \"\",\n}) => {\n  const waveformRef = useRef<HTMLDivElement>(null);\n  const wavesurfer = useRef<WaveSurfer | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(false);\n\n  useEffect(() => {\n    let mounted = true;\n    let ws = wavesurfer.current;\n\n    const initWaveSurfer = async () => {\n      if (!waveformRef.current || !audioUrl) return;\n\n      try {\n        // Clear any existing instance safely\n        if (ws) {\n          // Instead of immediately destroying, just set to null\n          // We'll destroy it outside this function\n          wavesurfer.current = null;\n        }\n\n        // Create a fresh instance\n        const newWaveSurfer = WaveSurfer.create({\n          container: waveformRef.current,\n          waveColor: \"rgba(255, 255, 255, 0.6)\",\n          progressColor: \"rgba(255, 255, 255, 0.9)\",\n          cursorColor: \"transparent\",\n          barWidth: 2,\n          barGap: 1,\n          height,\n          normalize: true,\n          interact: false,\n        });\n\n        // Assign to ref only if component is still mounted\n        if (mounted) {\n          wavesurfer.current = newWaveSurfer;\n        } else {\n          // Component unmounted during initialization, clean up\n          try {\n            newWaveSurfer.destroy();\n          } catch (e) {\n            // Ignore destroy errors\n          }\n          return;\n        }\n\n        // Event listeners\n        newWaveSurfer.on(\"ready\", () => {\n          if (mounted) {\n            setIsLoading(false);\n            setError(false);\n          }\n        });\n\n        newWaveSurfer.on(\"error\", (err) => {\n          if (mounted) {\n            console.error(\"WaveSurfer error:\", err);\n            setError(true);\n            setIsLoading(false);\n          }\n        });\n\n        await newWaveSurfer.load(audioUrl);\n      } catch (err) {\n        if (mounted) {\n          console.error(\"Failed to initialize WaveSurfer:\", err);\n          setError(true);\n          setIsLoading(false);\n        }\n      }\n    };\n\n    // First safely destroy previous instance if it exists\n    if (ws) {\n      // Use this pattern to safely destroy the previous instance\n      const wsToDestroy = ws;\n      // Detach from ref immediately\n      wavesurfer.current = null;\n\n      // Wait a tick to destroy so any pending operations can complete\n      requestAnimationFrame(() => {\n        try {\n          wsToDestroy.destroy();\n        } catch (e) {\n          // Ignore errors during destroy\n        }\n        // Only initialize new instance after destroying the old one\n        if (mounted) {\n          initWaveSurfer();\n        }\n      });\n    } else {\n      // No previous instance to clean up, initialize directly\n      initWaveSurfer();\n    }\n\n    return () => {\n      // Mark component as unmounted\n      mounted = false;\n\n      // Store reference to current wavesurfer instance\n      const wsToDestroy = wavesurfer.current;\n\n      // Immediately clear the ref to prevent accessing it after unmount\n      wavesurfer.current = null;\n\n      // If we have an instance to clean up, do it safely\n      if (wsToDestroy) {\n        // Delay destruction to avoid race conditions\n        requestAnimationFrame(() => {\n          try {\n            wsToDestroy.destroy();\n          } catch (e) {\n            // Ignore destroy errors - they're expected\n          }\n        });\n      }\n    };\n  }, [audioUrl, height]);\n\n  if (error) {\n    return (\n      <div\n        className={`flex items-center justify-center ${className}`}\n        style={{ height }}\n      >\n        <span className=\"text-xs text-foreground/60\">Audio unavailable</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative ${className}`}>\n      {isLoading && (\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <span className=\"text-xs text-foreground/60\">Loading...</span>\n        </div>\n      )}\n      <div\n        ref={waveformRef}\n        className={`w-full transition-opacity duration-200 ${isLoading ? \"opacity-0\" : \"opacity-100\"}`}\n        style={{ height }}\n      />\n    </div>\n  );\n};\n\nexport default AudioWaveform;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4988, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/timeline/timeline-element.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  Scissors,\n  Trash2,\n  Copy,\n  Search,\n  RefreshCw,\n  EyeOff,\n  Eye,\n  Volume2,\n  VolumeX,\n} from \"lucide-react\";\nimport { useMediaStore } from \"@/stores/media-store\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { usePlaybackStore } from \"@/stores/playback-store\";\nimport AudioWaveform from \"../audio-waveform\";\nimport { toast } from \"sonner\";\nimport { TimelineElementProps, MediaElement } from \"@/types/timeline\";\nimport { useTimelineElementResize } from \"@/hooks/use-timeline-element-resize\";\nimport {\n  getTrackElementClasses,\n  TIMELINE_CONSTANTS,\n  getTrackHeight,\n} from \"@/constants/timeline-constants\";\nimport {\n  ContextMenu,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuSeparator,\n  ContextMenuTrigger,\n} from \"../../ui/context-menu\";\nimport { useMediaPanelStore } from \"../media-panel/store\";\n\nexport function TimelineElement({\n  element,\n  track,\n  zoomLevel,\n  isSelected,\n  onElementMouseDown,\n  onElementClick,\n}: TimelineElementProps) {\n  const { mediaFiles } = useMediaStore();\n  const {\n    dragState,\n    copySelected,\n    selectedElements,\n    deleteSelected,\n    splitSelected,\n    toggleSelectedHidden,\n    toggleSelectedMuted,\n    duplicateElement,\n    revealElementInMedia,\n    replaceElementWithFile,\n    getContextMenuState,\n  } = useTimelineStore();\n  const { currentTime } = usePlaybackStore();\n\n  const mediaItem =\n    element.type === \"media\"\n      ? mediaFiles.find((file) => file.id === element.mediaId)\n      : null;\n  const hasAudio = mediaItem?.type === \"audio\" || mediaItem?.type === \"video\";\n\n  const { resizing, handleResizeStart, handleResizeMove, handleResizeEnd } =\n    useTimelineElementResize({\n      element,\n      track,\n      zoomLevel,\n    });\n\n  const {\n    isMultipleSelected,\n    isCurrentElementSelected,\n    hasAudioElements,\n    canSplitSelected,\n  } = getContextMenuState(track.id, element.id);\n\n  const effectiveDuration =\n    element.duration - element.trimStart - element.trimEnd;\n  const elementWidth = Math.max(\n    TIMELINE_CONSTANTS.ELEMENT_MIN_WIDTH,\n    effectiveDuration * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel\n  );\n\n  const isBeingDragged = dragState.elementId === element.id;\n  const elementStartTime =\n    isBeingDragged && dragState.isDragging\n      ? dragState.currentTime\n      : element.startTime;\n\n  const elementLeft = elementStartTime * 50 * zoomLevel;\n\n  const handleElementSplitContext = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    splitSelected(\n      currentTime,\n      isMultipleSelected && isCurrentElementSelected ? undefined : track.id,\n      isMultipleSelected && isCurrentElementSelected ? undefined : element.id\n    );\n  };\n\n  const handleElementDuplicateContext = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    duplicateElement(track.id, element.id);\n  };\n\n  const handleElementCopyContext = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    copySelected();\n  };\n\n  const handleElementDeleteContext = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    deleteSelected(\n      isMultipleSelected && isCurrentElementSelected ? undefined : track.id,\n      isMultipleSelected && isCurrentElementSelected ? undefined : element.id\n    );\n  };\n\n  const handleToggleElementContext = (e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    if (hasAudio && element.type === \"media\") {\n      toggleSelectedMuted(\n        isMultipleSelected && isCurrentElementSelected ? undefined : track.id,\n        isMultipleSelected && isCurrentElementSelected ? undefined : element.id\n      );\n    } else {\n      toggleSelectedHidden(\n        isMultipleSelected && isCurrentElementSelected ? undefined : track.id,\n        isMultipleSelected && isCurrentElementSelected ? undefined : element.id\n      );\n    }\n  };\n\n  const handleReplaceClip = (e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.accept = \"video/*,audio/*,image/*\";\n    input.onchange = async (e) => {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (file) {\n        await replaceElementWithFile(track.id, element.id, file);\n      }\n    };\n    input.click();\n  };\n\n  const handleRevealInMedia = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    revealElementInMedia(element.id);\n  };\n\n  const renderElementContent = () => {\n    if (element.type === \"text\") {\n      return (\n        <div className=\"w-full h-full flex items-center justify-start pl-2\">\n          <span className=\"text-xs text-white truncate\">{element.content}</span>\n        </div>\n      );\n    }\n\n    const mediaItem = mediaFiles.find((file) => file.id === element.mediaId);\n    if (!mediaItem) {\n      return (\n        <span className=\"text-xs text-foreground/80 truncate\">\n          {element.name}\n        </span>\n      );\n    }\n\n    if (\n      mediaItem.type === \"image\" ||\n      (mediaItem.type === \"video\" && mediaItem.thumbnailUrl)\n    ) {\n      const trackHeight = getTrackHeight(track.type);\n      const tileWidth = trackHeight * (16 / 9);\n\n      const imageUrl =\n        mediaItem.type === \"image\" ? mediaItem.url : mediaItem.thumbnailUrl;\n\n      return (\n        <div className=\"w-full h-full flex items-center justify-center\">\n          <div\n            className={`w-full h-full relative ${\n              isSelected ? \"bg-primary\" : \"bg-transparent\"\n            }`}\n          >\n            <div\n              className={`absolute top-[0.25rem] bottom-[0.25rem] left-0 right-0`}\n              style={{\n                backgroundImage: imageUrl ? `url(${imageUrl})` : \"none\",\n                backgroundRepeat: \"repeat-x\",\n                backgroundSize: `${tileWidth}px ${trackHeight}px`,\n                backgroundPosition: \"left center\",\n                pointerEvents: \"none\",\n              }}\n              aria-label={`Tiled ${mediaItem.type === \"image\" ? \"background\" : \"thumbnail\"} of ${mediaItem.name}`}\n            />\n          </div>\n        </div>\n      );\n    }\n\n    if (mediaItem.type === \"audio\") {\n      return (\n        <div className=\"w-full h-full flex items-center gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <AudioWaveform\n              audioUrl={mediaItem.url || \"\"}\n              height={24}\n              className=\"w-full\"\n            />\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <span className=\"text-xs text-foreground/80 truncate\">\n        {element.name}\n      </span>\n    );\n  };\n\n  const handleElementMouseDown = (e: React.MouseEvent) => {\n    if (onElementMouseDown) {\n      onElementMouseDown(e, element);\n    }\n  };\n\n  const isMuted = element.type === \"media\" && element.muted;\n\n  return (\n    <ContextMenu>\n      <ContextMenuTrigger asChild>\n        <div\n          className={`absolute top-0 h-full select-none timeline-element ${\n            isBeingDragged ? \"z-50\" : \"z-10\"\n          }`}\n          style={{\n            left: `${elementLeft}px`,\n            width: `${elementWidth}px`,\n          }}\n          data-element-id={element.id}\n          data-track-id={track.id}\n          onMouseMove={resizing ? handleResizeMove : undefined}\n          onMouseUp={resizing ? handleResizeEnd : undefined}\n          onMouseLeave={resizing ? handleResizeEnd : undefined}\n        >\n          <div\n            className={`relative h-full rounded-[0.5rem] cursor-pointer overflow-hidden ${getTrackElementClasses(\n              track.type\n            )} ${isSelected ? \"\" : \"\"} ${\n              isBeingDragged ? \"z-50\" : \"z-10\"\n            } ${element.hidden ? \"opacity-50\" : \"\"}`}\n            onClick={(e) => onElementClick && onElementClick(e, element)}\n            onMouseDown={handleElementMouseDown}\n            onContextMenu={(e) =>\n              onElementMouseDown && onElementMouseDown(e, element)\n            }\n          >\n            <div className=\"absolute inset-0 flex items-center h-full\">\n              {renderElementContent()}\n            </div>\n\n            {(hasAudio ? isMuted : element.hidden) && (\n              <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center pointer-events-none\">\n                {hasAudio ? (\n                  <VolumeX className=\"h-6 w-6 text-white\" />\n                ) : (\n                  <EyeOff className=\"h-6 w-6 text-white\" />\n                )}\n              </div>\n            )}\n\n            {isSelected && (\n              <>\n                <div\n                  className=\"absolute left-0 top-0 bottom-0 w-[0.6rem] cursor-w-resize bg-primary z-50 flex items-center justify-center\"\n                  onMouseDown={(e) => handleResizeStart(e, element.id, \"left\")}\n                >\n                  <div className=\"w-[0.2rem] h-[1.5rem] bg-foreground/75 rounded-full\" />\n                </div>\n                <div\n                  className=\"absolute right-0 top-0 bottom-0 w-[0.6rem] cursor-e-resize bg-primary z-50 flex items-center justify-center\"\n                  onMouseDown={(e) => handleResizeStart(e, element.id, \"right\")}\n                >\n                  <div className=\"w-[0.2rem] h-[1.5rem] bg-foreground/75 rounded-full\" />\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      </ContextMenuTrigger>\n      <ContextMenuContent className=\"z-200\">\n        {(!isMultipleSelected ||\n          (isMultipleSelected &&\n            isCurrentElementSelected &&\n            canSplitSelected)) && (\n          <ContextMenuItem onClick={handleElementSplitContext}>\n            <Scissors className=\"h-4 w-4 mr-2\" />\n            {isMultipleSelected && isCurrentElementSelected\n              ? `Split ${selectedElements.length} elements at playhead`\n              : \"Split at playhead\"}\n          </ContextMenuItem>\n        )}\n\n        <ContextMenuItem onClick={handleElementCopyContext}>\n          <Copy className=\"h-4 w-4 mr-2\" />\n          {isMultipleSelected && isCurrentElementSelected\n            ? `Copy ${selectedElements.length} elements`\n            : \"Copy element\"}\n        </ContextMenuItem>\n\n        <ContextMenuItem onClick={handleToggleElementContext}>\n          {isMultipleSelected && isCurrentElementSelected ? (\n            hasAudioElements ? (\n              <VolumeX className=\"h-4 w-4 mr-2\" />\n            ) : (\n              <EyeOff className=\"h-4 w-4 mr-2\" />\n            )\n          ) : hasAudio ? (\n            isMuted ? (\n              <Volume2 className=\"h-4 w-4 mr-2\" />\n            ) : (\n              <VolumeX className=\"h-4 w-4 mr-2\" />\n            )\n          ) : element.hidden ? (\n            <Eye className=\"h-4 w-4 mr-2\" />\n          ) : (\n            <EyeOff className=\"h-4 w-4 mr-2\" />\n          )}\n          <span>\n            {isMultipleSelected && isCurrentElementSelected\n              ? hasAudioElements\n                ? `Toggle mute ${selectedElements.length} elements`\n                : `Toggle visibility ${selectedElements.length} elements`\n              : hasAudio\n                ? isMuted\n                  ? \"Unmute\"\n                  : \"Mute\"\n                : element.hidden\n                  ? \"Show\"\n                  : \"Hide\"}{\" \"}\n            {!isMultipleSelected && (element.type === \"text\" ? \"text\" : \"clip\")}\n          </span>\n        </ContextMenuItem>\n\n        {!isMultipleSelected && (\n          <ContextMenuItem onClick={handleElementDuplicateContext}>\n            <Copy className=\"h-4 w-4 mr-2\" />\n            Duplicate {element.type === \"text\" ? \"text\" : \"clip\"}\n          </ContextMenuItem>\n        )}\n\n        {!isMultipleSelected && element.type === \"media\" && (\n          <>\n            <ContextMenuItem onClick={handleRevealInMedia}>\n              <Search className=\"h-4 w-4 mr-2\" />\n              Reveal in media\n            </ContextMenuItem>\n            <ContextMenuItem onClick={handleReplaceClip}>\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Replace clip\n            </ContextMenuItem>\n          </>\n        )}\n\n        <ContextMenuSeparator />\n\n        <ContextMenuItem\n          onClick={handleElementDeleteContext}\n          className=\"text-destructive focus:text-destructive\"\n        >\n          <Trash2 className=\"h-4 w-4 mr-2\" />\n          {isMultipleSelected && isCurrentElementSelected\n            ? `Delete ${selectedElements.length} elements`\n            : `Delete ${element.type === \"text\" ? \"text\" : \"clip\"}`}\n        </ContextMenuItem>\n      </ContextMenuContent>\n    </ContextMenu>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5468, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/timeline/timeline-track.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useState, useEffect } from \"react\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { useMediaStore } from \"@/stores/media-store\";\nimport { toast } from \"sonner\";\nimport { processMediaFiles } from \"@/lib/media-processing\";\nimport { TimelineElement } from \"./timeline-element\";\nimport {\n  TimelineTrack,\n  getMainTrack,\n  canElementGoOnTrack,\n} from \"@/types/timeline\";\nimport { usePlaybackStore } from \"@/stores/playback-store\";\nimport { DEFAULT_TEXT_ELEMENT } from \"@/constants/text-constants\";\nimport type {\n  TimelineElement as TimelineElementType,\n  DragData,\n  TrackType,\n} from \"@/types/timeline\";\nimport {\n  snapTimeToFrame,\n  TIMELINE_CONSTANTS,\n} from \"@/constants/timeline-constants\";\nimport { DEFAULT_FPS, useProjectStore } from \"@/stores/project-store\";\nimport { useTimelineSnapping, SnapPoint } from \"@/hooks/use-timeline-snapping\";\nimport { useEdgeAutoScroll } from \"@/hooks/use-edge-auto-scroll\";\n\nexport function TimelineTrackContent({\n  track,\n  zoomLevel,\n  onSnapPointChange,\n  rulerScrollRef,\n  tracksScrollRef,\n}: {\n  track: TimelineTrack;\n  zoomLevel: number;\n  onSnapPointChange?: (snapPoint: SnapPoint | null) => void;\n  rulerScrollRef: React.RefObject<HTMLDivElement>;\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\n}) {\n  const { mediaFiles } = useMediaStore();\n  const {\n    tracks,\n    addTrack,\n    moveElementToTrack,\n    updateElementStartTime,\n    updateElementStartTimeWithRipple,\n    addElementToTrack,\n    selectedElements,\n    selectElement,\n    dragState,\n    startDrag: startDragAction,\n    updateDragTime,\n    endDrag: endDragAction,\n    clearSelectedElements,\n    insertTrackAt,\n    snappingEnabled,\n    rippleEditingEnabled,\n  } = useTimelineStore();\n\n  const { currentTime, duration } = usePlaybackStore();\n\n  // Initialize snapping hook\n  const { snapElementPosition, snapElementEdge } = useTimelineSnapping({\n    snapThreshold: 10,\n    enableElementSnapping: snappingEnabled,\n    enablePlayheadSnapping: snappingEnabled,\n  });\n\n  // Helper function for drop snapping that tries both edges\n  const getDropSnappedTime = (\n    dropTime: number,\n    elementDuration: number,\n    excludeElementId?: string\n  ) => {\n    // Always apply frame snapping first\n    const projectStore = useProjectStore.getState();\n    const projectFps = projectStore.activeProject?.fps || DEFAULT_FPS;\n    let finalTime = snapTimeToFrame(dropTime, projectFps);\n\n    // Additionally apply element snapping if enabled\n    if (snappingEnabled) {\n      // Try snapping both start and end edges for drops\n      const startSnapResult = snapElementEdge(\n        dropTime,\n        elementDuration,\n        tracks,\n        currentTime,\n        zoomLevel,\n        excludeElementId,\n        true // snap to start edge\n      );\n\n      const endSnapResult = snapElementEdge(\n        dropTime,\n        elementDuration,\n        tracks,\n        currentTime,\n        zoomLevel,\n        excludeElementId,\n        false // snap to end edge\n      );\n\n      // Choose the snap result with the smaller distance (closer snap)\n      let bestSnapResult = startSnapResult;\n      if (\n        endSnapResult.snapPoint &&\n        (!startSnapResult.snapPoint ||\n          endSnapResult.snapDistance < startSnapResult.snapDistance)\n      ) {\n        bestSnapResult = endSnapResult;\n      }\n\n      // Only use element snapping if it found a snap point, otherwise keep frame-snapped time\n      if (bestSnapResult.snapPoint) {\n        finalTime = bestSnapResult.snappedTime;\n      }\n    }\n\n    return finalTime;\n  };\n\n  const timelineRef = useRef<HTMLDivElement>(null);\n  const [isDropping, setIsDropping] = useState(false);\n  const [dropPosition, setDropPosition] = useState<number | null>(null);\n  const [wouldOverlap, setWouldOverlap] = useState(false);\n  const dragCounterRef = useRef(0);\n  const [mouseDownLocation, setMouseDownLocation] = useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n\n  const lastMouseXRef = useRef(0);\n\n  // Set up mouse event listeners for drag\n  useEffect(() => {\n    if (!dragState.isDragging) return;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!timelineRef.current) return;\n      lastMouseXRef.current = e.clientX;\n\n      // On first mouse move during drag, ensure the element is selected\n      if (dragState.elementId && dragState.trackId) {\n        const isSelected = selectedElements.some(\n          (c) =>\n            c.trackId === dragState.trackId &&\n            c.elementId === dragState.elementId\n        );\n\n        if (!isSelected) {\n          // Select this element (replacing other selections) since we're dragging it\n          selectElement(dragState.trackId, dragState.elementId, false);\n        }\n      }\n\n      const timelineRect = timelineRef.current.getBoundingClientRect();\n      const mouseX = e.clientX - timelineRect.left;\n      const mouseTime = Math.max(\n        0,\n        mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel)\n      );\n      const adjustedTime = Math.max(0, mouseTime - dragState.clickOffsetTime);\n\n      // Always apply frame snapping first\n      const projectStore = useProjectStore.getState();\n      const projectFps = projectStore.activeProject?.fps || DEFAULT_FPS;\n      let finalTime = snapTimeToFrame(adjustedTime, projectFps);\n      let snapPoint = null;\n\n      // Additionally apply element snapping if enabled\n      if (snappingEnabled) {\n        // Find the element being dragged to get its duration\n        let elementDuration = 5; // fallback duration\n        if (dragState.elementId && dragState.trackId) {\n          const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\n          const element = sourceTrack?.elements.find(\n            (e) => e.id === dragState.elementId\n          );\n          if (element) {\n            elementDuration =\n              element.duration - element.trimStart - element.trimEnd;\n          }\n        }\n\n        // Try snapping both start and end edges\n        const startSnapResult = snapElementEdge(\n          adjustedTime,\n          elementDuration,\n          tracks,\n          currentTime,\n          zoomLevel,\n          dragState.elementId || undefined,\n          true // snap to start edge\n        );\n\n        const endSnapResult = snapElementEdge(\n          adjustedTime,\n          elementDuration,\n          tracks,\n          currentTime,\n          zoomLevel,\n          dragState.elementId || undefined,\n          false // snap to end edge\n        );\n\n        // Choose the snap result with the smaller distance (closer snap)\n        let bestSnapResult = startSnapResult;\n        if (\n          endSnapResult.snapPoint &&\n          (!startSnapResult.snapPoint ||\n            endSnapResult.snapDistance < startSnapResult.snapDistance)\n        ) {\n          bestSnapResult = endSnapResult;\n        }\n\n        // Only use element snapping if it found a snap point, otherwise keep frame-snapped time\n        if (bestSnapResult.snapPoint) {\n          finalTime = bestSnapResult.snappedTime;\n          snapPoint = bestSnapResult.snapPoint;\n        }\n\n        // Notify parent component about snap point change\n        onSnapPointChange?.(snapPoint);\n      } else {\n        // Clear snap point when element snapping is disabled\n        onSnapPointChange?.(null);\n      }\n\n      updateDragTime(finalTime);\n    };\n\n    const handleMouseUp = (e: MouseEvent) => {\n      if (!dragState.elementId || !dragState.trackId) return;\n\n      // If this track initiated the drag, we should handle the mouse up regardless of where it occurs\n      const isTrackThatStartedDrag = dragState.trackId === track.id;\n\n      const timelineRect = timelineRef.current?.getBoundingClientRect();\n      if (!timelineRect) {\n        if (isTrackThatStartedDrag) {\n          if (rippleEditingEnabled) {\n            updateElementStartTimeWithRipple(\n              track.id,\n              dragState.elementId,\n              dragState.currentTime\n            );\n          } else {\n            updateElementStartTime(\n              track.id,\n              dragState.elementId,\n              dragState.currentTime\n            );\n          }\n          endDragAction();\n          // Clear snap point when drag ends\n          onSnapPointChange?.(null);\n        }\n        return;\n      }\n\n      const isMouseOverThisTrack =\n        e.clientY >= timelineRect.top && e.clientY <= timelineRect.bottom;\n\n      if (!isMouseOverThisTrack && !isTrackThatStartedDrag) return;\n\n      const finalTime = dragState.currentTime;\n\n      if (isMouseOverThisTrack) {\n        const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\n        const movingElement = sourceTrack?.elements.find(\n          (c) => c.id === dragState.elementId\n        );\n\n        if (movingElement) {\n          const movingElementDuration =\n            movingElement.duration -\n            movingElement.trimStart -\n            movingElement.trimEnd;\n          const movingElementEnd = finalTime + movingElementDuration;\n\n          const targetTrack = tracks.find((t) => t.id === track.id);\n          const hasOverlap = targetTrack?.elements.some((existingElement) => {\n            if (\n              dragState.trackId === track.id &&\n              existingElement.id === dragState.elementId\n            ) {\n              return false;\n            }\n            const existingStart = existingElement.startTime;\n            const existingEnd =\n              existingElement.startTime +\n              (existingElement.duration -\n                existingElement.trimStart -\n                existingElement.trimEnd);\n            return finalTime < existingEnd && movingElementEnd > existingStart;\n          });\n\n          if (!hasOverlap) {\n            if (dragState.trackId === track.id) {\n              if (rippleEditingEnabled) {\n                updateElementStartTimeWithRipple(\n                  track.id,\n                  dragState.elementId,\n                  finalTime\n                );\n              } else {\n                updateElementStartTime(\n                  track.id,\n                  dragState.elementId,\n                  finalTime\n                );\n              }\n            } else {\n              moveElementToTrack(\n                dragState.trackId,\n                track.id,\n                dragState.elementId\n              );\n              requestAnimationFrame(() => {\n                if (rippleEditingEnabled) {\n                  updateElementStartTimeWithRipple(\n                    track.id,\n                    dragState.elementId!,\n                    finalTime\n                  );\n                } else {\n                  updateElementStartTime(\n                    track.id,\n                    dragState.elementId!,\n                    finalTime\n                  );\n                }\n              });\n            }\n          }\n        }\n      } else if (isTrackThatStartedDrag) {\n        // Mouse is not over this track, but this track started the drag\n        // This means user released over ruler/outside - update position within same track\n        const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\n        const movingElement = sourceTrack?.elements.find(\n          (c) => c.id === dragState.elementId\n        );\n\n        if (movingElement) {\n          const movingElementDuration =\n            movingElement.duration -\n            movingElement.trimStart -\n            movingElement.trimEnd;\n          const movingElementEnd = finalTime + movingElementDuration;\n\n          const hasOverlap = track.elements.some((existingElement) => {\n            if (existingElement.id === dragState.elementId) {\n              return false;\n            }\n            const existingStart = existingElement.startTime;\n            const existingEnd =\n              existingElement.startTime +\n              (existingElement.duration -\n                existingElement.trimStart -\n                existingElement.trimEnd);\n            return finalTime < existingEnd && movingElementEnd > existingStart;\n          });\n\n          if (!hasOverlap) {\n            if (rippleEditingEnabled) {\n              updateElementStartTimeWithRipple(\n                track.id,\n                dragState.elementId,\n                finalTime\n              );\n            } else {\n              updateElementStartTime(track.id, dragState.elementId, finalTime);\n            }\n          }\n        }\n      }\n\n      if (isTrackThatStartedDrag) {\n        endDragAction();\n        // Clear snap point when drag ends\n        onSnapPointChange?.(null);\n      }\n    };\n\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    document.addEventListener(\"mouseup\", handleMouseUp);\n\n    return () => {\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n    };\n  }, [\n    dragState.isDragging,\n    dragState.clickOffsetTime,\n    dragState.elementId,\n    dragState.trackId,\n    dragState.currentTime,\n    zoomLevel,\n    tracks,\n    track.id,\n    updateDragTime,\n    updateElementStartTime,\n    moveElementToTrack,\n    endDragAction,\n    selectedElements,\n    selectElement,\n    onSnapPointChange,\n  ]);\n\n  useEdgeAutoScroll({\n    isActive: dragState.isDragging,\n    getMouseClientX: () => lastMouseXRef.current,\n    rulerScrollRef,\n    tracksScrollRef,\n    contentWidth: duration * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel,\n  });\n\n  const handleElementMouseDown = (\n    e: React.MouseEvent,\n    element: TimelineElementType\n  ) => {\n    setMouseDownLocation({ x: e.clientX, y: e.clientY });\n\n    // Detect right-click (button 2) and handle selection without starting drag\n    const isRightClick = e.button === 2;\n    const isMultiSelect = e.metaKey || e.ctrlKey || e.shiftKey;\n\n    if (isRightClick) {\n      // Handle right-click selection\n      const isSelected = selectedElements.some(\n        (c) => c.trackId === track.id && c.elementId === element.id\n      );\n\n      // If element is not selected, select it (keep other selections if multi-select)\n      if (!isSelected) {\n        selectElement(track.id, element.id, isMultiSelect);\n      }\n      // If element is already selected, keep it selected\n\n      // Don't start drag action for right-clicks\n      return;\n    }\n\n    // Handle multi-selection for left-click with modifiers\n    if (isMultiSelect) {\n      selectElement(track.id, element.id, true);\n    }\n\n    // Calculate the offset from the left edge of the element to where the user clicked\n    const elementElement = e.currentTarget as HTMLElement;\n    const elementRect = elementElement.getBoundingClientRect();\n    const clickOffsetX = e.clientX - elementRect.left;\n    const clickOffsetTime =\n      clickOffsetX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\n\n    startDragAction(\n      element.id,\n      track.id,\n      e.clientX,\n      element.startTime,\n      clickOffsetTime\n    );\n  };\n\n  const handleElementClick = (\n    e: React.MouseEvent,\n    element: TimelineElementType\n  ) => {\n    e.stopPropagation();\n\n    // Check if mouse moved significantly\n    if (mouseDownLocation) {\n      const deltaX = Math.abs(e.clientX - mouseDownLocation.x);\n      const deltaY = Math.abs(e.clientY - mouseDownLocation.y);\n      // If it moved more than a few pixels, consider it a drag and not a click.\n      if (deltaX > 5 || deltaY > 5) {\n        setMouseDownLocation(null); // Reset for next interaction\n        return;\n      }\n    }\n\n    // Skip selection logic for multi-selection (handled in mousedown)\n    if (e.metaKey || e.ctrlKey || e.shiftKey) {\n      return;\n    }\n\n    // Handle single selection\n    const isSelected = selectedElements.some(\n      (c) => c.trackId === track.id && c.elementId === element.id\n    );\n\n    if (!isSelected) {\n      // If element is not selected, select it (replacing other selections)\n      selectElement(track.id, element.id, false);\n    }\n    // If element is already selected, keep it selected (do nothing)\n  };\n\n  const handleTrackDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n\n    // Handle both timeline elements and media items\n    const hasTimelineElement = e.dataTransfer.types.includes(\n      \"application/x-timeline-element\"\n    );\n    const hasMediaItem = e.dataTransfer.types.includes(\n      \"application/x-media-item\"\n    );\n\n    if (!hasTimelineElement && !hasMediaItem) return;\n\n    // Calculate drop position for overlap checking\n    const trackContainer = e.currentTarget.querySelector(\n      \".track-elements-container\"\n    ) as HTMLElement;\n    let dropTime = 0;\n    if (trackContainer) {\n      const rect = trackContainer.getBoundingClientRect();\n      const mouseX = Math.max(0, e.clientX - rect.left);\n      dropTime = mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\n    }\n\n    // Check for potential overlaps and show appropriate feedback\n    let wouldOverlap = false;\n\n    if (hasMediaItem) {\n      try {\n        const mediaItemData = e.dataTransfer.getData(\n          \"application/x-media-item\"\n        );\n        if (mediaItemData) {\n          const dragData: DragData = JSON.parse(mediaItemData);\n\n          if (dragData.type === \"text\") {\n            // Text elements have default duration of 5 seconds\n            const newElementDuration = 5;\n            const snappedTime = getDropSnappedTime(\n              dropTime,\n              newElementDuration\n            );\n            const newElementEnd = snappedTime + newElementDuration;\n\n            wouldOverlap = track.elements.some((existingElement) => {\n              const existingStart = existingElement.startTime;\n              const existingEnd =\n                existingElement.startTime +\n                (existingElement.duration -\n                  existingElement.trimStart -\n                  existingElement.trimEnd);\n              return snappedTime < existingEnd && newElementEnd > existingStart;\n            });\n          } else {\n            // Media elements\n            const mediaItem = mediaFiles.find(\n              (item) => item.id === dragData.id\n            );\n            if (mediaItem) {\n              const newElementDuration = mediaItem.duration || 5;\n              const snappedTime = getDropSnappedTime(\n                dropTime,\n                newElementDuration\n              );\n              const newElementEnd = snappedTime + newElementDuration;\n\n              wouldOverlap = track.elements.some((existingElement) => {\n                const existingStart = existingElement.startTime;\n                const existingEnd =\n                  existingElement.startTime +\n                  (existingElement.duration -\n                    existingElement.trimStart -\n                    existingElement.trimEnd);\n                return (\n                  snappedTime < existingEnd && newElementEnd > existingStart\n                );\n              });\n            }\n          }\n        }\n      } catch (error) {\n        // Continue with default behavior\n      }\n    } else if (hasTimelineElement) {\n      try {\n        const timelineElementData = e.dataTransfer.getData(\n          \"application/x-timeline-element\"\n        );\n        if (timelineElementData) {\n          const { elementId, trackId: fromTrackId } =\n            JSON.parse(timelineElementData);\n          const sourceTrack = tracks.find(\n            (t: TimelineTrack) => t.id === fromTrackId\n          );\n          const movingElement = sourceTrack?.elements.find(\n            (c: any) => c.id === elementId\n          );\n\n          if (movingElement) {\n            const movingElementDuration =\n              movingElement.duration -\n              movingElement.trimStart -\n              movingElement.trimEnd;\n            const snappedTime = getDropSnappedTime(\n              dropTime,\n              movingElementDuration,\n              elementId\n            );\n            const movingElementEnd = snappedTime + movingElementDuration;\n\n            wouldOverlap = track.elements.some((existingElement) => {\n              if (fromTrackId === track.id && existingElement.id === elementId)\n                return false;\n\n              const existingStart = existingElement.startTime;\n              const existingEnd =\n                existingElement.startTime +\n                (existingElement.duration -\n                  existingElement.trimStart -\n                  existingElement.trimEnd);\n              return (\n                snappedTime < existingEnd && movingElementEnd > existingStart\n              );\n            });\n          }\n        }\n      } catch (error) {\n        // Continue with default behavior\n      }\n    }\n\n    if (wouldOverlap) {\n      e.dataTransfer.dropEffect = \"none\";\n      setWouldOverlap(true);\n      // Use default duration for position indicator\n      setDropPosition(getDropSnappedTime(dropTime, 5));\n      return;\n    }\n\n    e.dataTransfer.dropEffect = hasTimelineElement ? \"move\" : \"copy\";\n    setWouldOverlap(false);\n    // Use default duration for position indicator\n    setDropPosition(getDropSnappedTime(dropTime, 5));\n  };\n\n  const handleTrackDragEnter = (e: React.DragEvent) => {\n    e.preventDefault();\n\n    const hasTimelineElement = e.dataTransfer.types.includes(\n      \"application/x-timeline-element\"\n    );\n    const hasMediaItem = e.dataTransfer.types.includes(\n      \"application/x-media-item\"\n    );\n\n    if (!hasTimelineElement && !hasMediaItem) return;\n\n    dragCounterRef.current++;\n    setIsDropping(true);\n  };\n\n  const handleTrackDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n\n    const hasTimelineElement = e.dataTransfer.types.includes(\n      \"application/x-timeline-element\"\n    );\n    const hasMediaItem = e.dataTransfer.types.includes(\n      \"application/x-media-item\"\n    );\n\n    if (!hasTimelineElement && !hasMediaItem) return;\n\n    dragCounterRef.current--;\n\n    if (dragCounterRef.current === 0) {\n      setIsDropping(false);\n      setWouldOverlap(false);\n      setDropPosition(null);\n    }\n  };\n\n  const handleTrackDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    // Debug logging\n    console.log(\n      JSON.stringify({\n        message: \"Drop event started in timeline track\",\n        dataTransferTypes: Array.from(e.dataTransfer.types),\n        trackId: track.id,\n        trackType: track.type,\n      })\n    );\n\n    // Reset all drag states\n    dragCounterRef.current = 0;\n    setIsDropping(false);\n    setWouldOverlap(false);\n\n    const hasTimelineElement = e.dataTransfer.types.includes(\n      \"application/x-timeline-element\"\n    );\n    const hasMediaItem = e.dataTransfer.types.includes(\n      \"application/x-media-item\"\n    );\n    const hasFiles = e.dataTransfer.files?.length > 0;\n\n    if (!hasTimelineElement && !hasMediaItem && !hasFiles) return;\n\n    const trackContainer = e.currentTarget.querySelector(\n      \".track-elements-container\"\n    ) as HTMLElement;\n    if (!trackContainer) return;\n\n    const rect = trackContainer.getBoundingClientRect();\n    const mouseX = Math.max(0, e.clientX - rect.left);\n    const mouseY = e.clientY - rect.top; // Get Y position relative to this track\n    const newStartTime =\n      mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\n    const projectStore = useProjectStore.getState();\n    const projectFps = projectStore.activeProject?.fps || DEFAULT_FPS;\n    const snappedTime = snapTimeToFrame(newStartTime, projectFps);\n\n    // Calculate drop position relative to tracks\n    const currentTrackIndex = tracks.findIndex((t) => t.id === track.id);\n\n    // Determine drop zone within the track (top 20px, middle 20px, bottom 20px)\n    let dropPosition: \"above\" | \"on\" | \"below\";\n    if (mouseY < 20) {\n      dropPosition = \"above\";\n    } else if (mouseY > 40) {\n      dropPosition = \"below\";\n    } else {\n      dropPosition = \"on\";\n    }\n\n    try {\n      if (hasTimelineElement) {\n        // Handle timeline element movement\n        const timelineElementData = e.dataTransfer.getData(\n          \"application/x-timeline-element\"\n        );\n        if (!timelineElementData) return;\n\n        const {\n          elementId,\n          trackId: fromTrackId,\n          clickOffsetTime = 0,\n        } = JSON.parse(timelineElementData);\n\n        // Find the element being moved\n        const sourceTrack = tracks.find(\n          (t: TimelineTrack) => t.id === fromTrackId\n        );\n        const movingElement = sourceTrack?.elements.find(\n          (c: TimelineElementType) => c.id === elementId\n        );\n\n        if (!movingElement) {\n          toast.error(\"Element not found\");\n          return;\n        }\n\n        // Check for overlaps with existing elements (excluding the moving element itself)\n        const movingElementDuration =\n          movingElement.duration -\n          movingElement.trimStart -\n          movingElement.trimEnd;\n\n        // Adjust position based on where user clicked on the element\n        const adjustedStartTime = newStartTime - clickOffsetTime;\n        const snappedStartTime = getDropSnappedTime(\n          adjustedStartTime,\n          movingElementDuration,\n          elementId\n        );\n        const finalStartTime = Math.max(0, snappedStartTime);\n        const movingElementEnd = finalStartTime + movingElementDuration;\n\n        const hasOverlap = track.elements.some((existingElement) => {\n          // Skip the element being moved if it's on the same track\n          if (fromTrackId === track.id && existingElement.id === elementId)\n            return false;\n\n          const existingStart = existingElement.startTime;\n          const existingEnd =\n            existingElement.startTime +\n            (existingElement.duration -\n              existingElement.trimStart -\n              existingElement.trimEnd);\n\n          // Check if elements overlap\n          return (\n            finalStartTime < existingEnd && movingElementEnd > existingStart\n          );\n        });\n\n        if (hasOverlap) {\n          toast.error(\n            \"Cannot move element here - it would overlap with existing elements\"\n          );\n          return;\n        }\n\n        if (fromTrackId === track.id) {\n          // Moving within same track\n          if (rippleEditingEnabled) {\n            updateElementStartTimeWithRipple(\n              track.id,\n              elementId,\n              finalStartTime\n            );\n          } else {\n            updateElementStartTime(track.id, elementId, finalStartTime);\n          }\n        } else {\n          // Moving to different track\n          moveElementToTrack(fromTrackId, track.id, elementId);\n          requestAnimationFrame(() => {\n            if (rippleEditingEnabled) {\n              updateElementStartTimeWithRipple(\n                track.id,\n                elementId,\n                finalStartTime\n              );\n            } else {\n              updateElementStartTime(track.id, elementId, finalStartTime);\n            }\n          });\n        }\n      } else if (hasMediaItem) {\n        // Handle media item drop\n        const mediaItemData = e.dataTransfer.getData(\n          \"application/x-media-item\"\n        );\n        if (!mediaItemData) return;\n\n        const dragData: DragData = JSON.parse(mediaItemData);\n\n        if (dragData.type === \"text\") {\n          let targetTrackId = track.id;\n          let targetTrack = track;\n\n          // Handle position-aware track creation for text\n          if (track.type !== \"text\" || dropPosition !== \"on\") {\n            // Text tracks should go above the main track\n            const mainTrack = getMainTrack(tracks);\n            let insertIndex: number;\n\n            if (dropPosition === \"above\") {\n              insertIndex = currentTrackIndex;\n            } else if (dropPosition === \"below\") {\n              insertIndex = currentTrackIndex + 1;\n            } else {\n              // dropPosition === \"on\" but track is not text type\n              // Insert above main track if main track exists, otherwise at top\n              if (mainTrack) {\n                const mainTrackIndex = tracks.findIndex(\n                  (t) => t.id === mainTrack.id\n                );\n                insertIndex = mainTrackIndex;\n              } else {\n                insertIndex = 0; // Top of timeline\n              }\n            }\n\n            targetTrackId = insertTrackAt(\"text\", insertIndex);\n            // Get the updated tracks array after creating the new track\n            const updatedTracks = useTimelineStore.getState().tracks;\n            const newTargetTrack = updatedTracks.find(\n              (t) => t.id === targetTrackId\n            );\n            if (!newTargetTrack) return;\n            targetTrack = newTargetTrack;\n          }\n\n          // Check for overlaps with existing elements in target track\n          const newElementDuration = 5; // Default text duration\n          const textSnappedTime = getDropSnappedTime(\n            newStartTime,\n            newElementDuration\n          );\n          const newElementEnd = textSnappedTime + newElementDuration;\n\n          const hasOverlap = targetTrack.elements.some((existingElement) => {\n            const existingStart = existingElement.startTime;\n            const existingEnd =\n              existingElement.startTime +\n              (existingElement.duration -\n                existingElement.trimStart -\n                existingElement.trimEnd);\n\n            // Check if elements overlap\n            return (\n              textSnappedTime < existingEnd && newElementEnd > existingStart\n            );\n          });\n\n          if (hasOverlap) {\n            toast.error(\n              \"Cannot place element here - it would overlap with existing elements\"\n            );\n            return;\n          }\n\n          addElementToTrack(targetTrackId, {\n            ...DEFAULT_TEXT_ELEMENT,\n            name: dragData.name || DEFAULT_TEXT_ELEMENT.name,\n            content: dragData.content || DEFAULT_TEXT_ELEMENT.content,\n            startTime: textSnappedTime,\n          });\n        } else {\n          // Handle media items\n          const mediaItem = mediaFiles.find((item) => item.id === dragData.id);\n\n          if (!mediaItem) {\n            toast.error(\"Media item not found\");\n            return;\n          }\n\n          let targetTrackId = track.id;\n\n          // Check if track type is compatible\n          const isVideoOrImage =\n            dragData.type === \"video\" || dragData.type === \"image\";\n          const isAudio = dragData.type === \"audio\";\n          const isCompatible = isVideoOrImage\n            ? canElementGoOnTrack(\"media\", track.type)\n            : isAudio\n              ? canElementGoOnTrack(\"media\", track.type)\n              : false;\n\n          let targetTrack = tracks.find((t) => t.id === targetTrackId);\n\n          // Handle position-aware track creation for media elements\n          if (!isCompatible || dropPosition !== \"on\") {\n            if (isVideoOrImage) {\n              // For video/image, check if we need a main track or additional media track\n              const mainTrack = getMainTrack(tracks);\n\n              if (!mainTrack) {\n                // No main track exists, create it\n                targetTrackId = addTrack(\"media\");\n                const updatedTracks = useTimelineStore.getState().tracks;\n                const newTargetTrack = updatedTracks.find(\n                  (t) => t.id === targetTrackId\n                );\n                if (!newTargetTrack) return;\n                targetTrack = newTargetTrack;\n              } else if (\n                mainTrack.elements.length === 0 &&\n                dropPosition === \"on\"\n              ) {\n                // Main track exists and is empty, use it\n                targetTrackId = mainTrack.id;\n                targetTrack = mainTrack;\n              } else {\n                // Create new media track\n                let insertIndex: number;\n\n                if (dropPosition === \"above\") {\n                  insertIndex = currentTrackIndex;\n                } else if (dropPosition === \"below\") {\n                  insertIndex = currentTrackIndex + 1;\n                } else {\n                  // Insert above main track\n                  const mainTrackIndex = tracks.findIndex(\n                    (t) => t.id === mainTrack.id\n                  );\n                  insertIndex = mainTrackIndex;\n                }\n\n                targetTrackId = insertTrackAt(\"media\", insertIndex);\n                const updatedTracks = useTimelineStore.getState().tracks;\n                const newTargetTrack = updatedTracks.find(\n                  (t) => t.id === targetTrackId\n                );\n                if (!newTargetTrack) return;\n                targetTrack = newTargetTrack;\n              }\n            } else if (isAudio) {\n              // Audio tracks go at the bottom\n              const mainTrack = getMainTrack(tracks);\n              let insertIndex: number;\n\n              if (dropPosition === \"above\") {\n                insertIndex = currentTrackIndex;\n              } else if (dropPosition === \"below\") {\n                insertIndex = currentTrackIndex + 1;\n              } else {\n                // Insert after main track (bottom area)\n                if (mainTrack) {\n                  const mainTrackIndex = tracks.findIndex(\n                    (t) => t.id === mainTrack.id\n                  );\n                  insertIndex = mainTrackIndex + 1;\n                } else {\n                  insertIndex = tracks.length; // Bottom of timeline\n                }\n              }\n\n              targetTrackId = insertTrackAt(\"audio\", insertIndex);\n              const updatedTracks = useTimelineStore.getState().tracks;\n              const newTargetTrack = updatedTracks.find(\n                (t) => t.id === targetTrackId\n              );\n              if (!newTargetTrack) return;\n              targetTrack = newTargetTrack;\n            }\n          }\n\n          if (!targetTrack) return;\n\n          // Check for overlaps with existing elements in target track\n          const newElementDuration = mediaItem.duration || 5;\n          const mediaSnappedTime = getDropSnappedTime(\n            newStartTime,\n            newElementDuration\n          );\n          const newElementEnd = mediaSnappedTime + newElementDuration;\n\n          const hasOverlap = targetTrack.elements.some((existingElement) => {\n            const existingStart = existingElement.startTime;\n            const existingEnd =\n              existingElement.startTime +\n              (existingElement.duration -\n                existingElement.trimStart -\n                existingElement.trimEnd);\n\n            // Check if elements overlap\n            return (\n              mediaSnappedTime < existingEnd && newElementEnd > existingStart\n            );\n          });\n\n          if (hasOverlap) {\n            toast.error(\n              \"Cannot place element here - it would overlap with existing elements\"\n            );\n            return;\n          }\n\n          addElementToTrack(targetTrackId, {\n            type: \"media\",\n            mediaId: mediaItem.id,\n            name: mediaItem.name,\n            duration: mediaItem.duration || 5,\n            startTime: mediaSnappedTime,\n            trimStart: 0,\n            trimEnd: 0,\n          });\n        }\n      } else if (hasFiles) {\n        // External file drops\n        const { activeProject } = useProjectStore.getState();\n        const { addMediaFile } = useMediaStore.getState();\n        const { addElementToTrack } = useTimelineStore.getState();\n\n        if (!activeProject) {\n          toast.error(\"No active project\");\n          return;\n        }\n\n        // Process and add files to new timeline tracks at playhead position\n        processMediaFiles(e.dataTransfer.files)\n          .then(async (processedItems) => {\n            for (const processedItem of processedItems) {\n              await addMediaFile(activeProject.id, processedItem);\n              const currentMediaFiles = mediaFiles;\n              const addedItem = currentMediaFiles.find(\n                (item) =>\n                  item.name === processedItem.name &&\n                  item.url === processedItem.url\n              );\n\n              if (addedItem) {\n                const trackType: TrackType =\n                  addedItem.type === \"audio\" ? \"audio\" : \"media\";\n                const targetTrackId = insertTrackAt(trackType, 0);\n\n                addElementToTrack(targetTrackId, {\n                  type: \"media\",\n                  mediaId: addedItem.id,\n                  name: addedItem.name,\n                  duration: addedItem.duration || 5,\n                  startTime: currentTime,\n                  trimStart: 0,\n                  trimEnd: 0,\n                });\n              }\n            }\n          })\n          .catch((error) => {\n            console.error(\"Error processing external files:\", error);\n            toast.error(\"Failed to process dropped files\");\n          });\n      }\n    } catch (error) {\n      console.error(\"Error handling drop:\", error);\n      toast.error(\"Failed to add media to track\");\n    }\n  };\n\n  return (\n    <div\n      className=\"w-full h-full hover:bg-muted/20\"\n      onClick={(e) => {\n        // If clicking empty area (not on an element), deselect all elements\n        if (!(e.target as HTMLElement).closest(\".timeline-element\")) {\n          clearSelectedElements();\n        }\n      }}\n      onDragOver={handleTrackDragOver}\n      onDragEnter={handleTrackDragEnter}\n      onDragLeave={handleTrackDragLeave}\n      onDrop={handleTrackDrop}\n    >\n      <div\n        ref={timelineRef}\n        className=\"h-full relative track-elements-container min-w-full\"\n      >\n        {track.elements.length === 0 ? (\n          <div\n            className={`h-full w-full rounded-sm border-2 border-dashed flex items-center justify-center text-xs text-muted-foreground transition-colors ${\n              isDropping\n                ? wouldOverlap\n                  ? \"border-red-500 bg-red-500/10 text-red-600\"\n                  : \"border-blue-500 bg-blue-500/10 text-blue-600\"\n                : \"border-muted/30\"\n            }`}\n          >\n            {isDropping\n              ? wouldOverlap\n                ? \"Cannot drop - would overlap\"\n                : \"Drop element here\"\n              : \"\"}\n          </div>\n        ) : (\n          <>\n            {track.elements.map((element) => {\n              const isSelected = selectedElements.some(\n                (c) => c.trackId === track.id && c.elementId === element.id\n              );\n\n              const handleElementSplit = () => {\n                const { currentTime } = usePlaybackStore();\n                const { splitSelected } = useTimelineStore();\n                const splitTime = currentTime;\n                const effectiveStart = element.startTime;\n                const effectiveEnd =\n                  element.startTime +\n                  (element.duration - element.trimStart - element.trimEnd);\n\n                if (splitTime > effectiveStart && splitTime < effectiveEnd) {\n                  splitSelected(splitTime, track.id, element.id);\n                } else {\n                  toast.error(\"Playhead must be within element to split\");\n                }\n              };\n\n              const handleElementDuplicate = () => {\n                const { addElementToTrack } = useTimelineStore.getState();\n                const { id, ...elementWithoutId } = element;\n                addElementToTrack(track.id, {\n                  ...elementWithoutId,\n                  name: element.name + \" (copy)\",\n                  startTime:\n                    element.startTime +\n                    (element.duration - element.trimStart - element.trimEnd) +\n                    0.1,\n                });\n              };\n\n              const handleElementDelete = () => {\n                const { deleteSelected } = useTimelineStore.getState();\n                deleteSelected(track.id, element.id);\n              };\n\n              return (\n                <TimelineElement\n                  key={element.id}\n                  element={element}\n                  track={track}\n                  zoomLevel={zoomLevel}\n                  isSelected={isSelected}\n                  onElementMouseDown={handleElementMouseDown}\n                  onElementClick={handleElementClick}\n                />\n              );\n            })}\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6229, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/timeline/timeline-playhead.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useState, useEffect } from \"react\";\nimport { TimelineTrack } from \"@/types/timeline\";\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\nimport { useTimelinePlayhead } from \"@/hooks/use-timeline-playhead\";\n\ninterface TimelinePlayheadProps {\n  currentTime: number;\n  duration: number;\n  zoomLevel: number;\n  tracks: TimelineTrack[];\n  seek: (time: number) => void;\n  rulerRef: React.RefObject<HTMLDivElement>;\n  rulerScrollRef: React.RefObject<HTMLDivElement>;\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\n  trackLabelsRef?: React.RefObject<HTMLDivElement>;\n  timelineRef: React.RefObject<HTMLDivElement>;\n  playheadRef?: React.RefObject<HTMLDivElement>;\n  isSnappingToPlayhead?: boolean;\n}\n\nexport function TimelinePlayhead({\n  currentTime,\n  duration,\n  zoomLevel,\n  tracks,\n  seek,\n  rulerRef,\n  rulerScrollRef,\n  tracksScrollRef,\n  trackLabelsRef,\n  timelineRef,\n  playheadRef: externalPlayheadRef,\n  isSnappingToPlayhead = false,\n}: TimelinePlayheadProps) {\n  const internalPlayheadRef = useRef<HTMLDivElement>(null);\n  const playheadRef = externalPlayheadRef || internalPlayheadRef;\n  const [scrollLeft, setScrollLeft] = useState(0);\n\n  const { playheadPosition, handlePlayheadMouseDown } = useTimelinePlayhead({\n    currentTime,\n    duration,\n    zoomLevel,\n    seek,\n    rulerRef,\n    rulerScrollRef,\n    tracksScrollRef,\n    playheadRef,\n  });\n\n  // Track scroll position to lock playhead to frame\n  useEffect(() => {\n    const tracksViewport = tracksScrollRef.current;\n\n    if (!tracksViewport) return;\n\n    const handleScroll = () => {\n      setScrollLeft(tracksViewport.scrollLeft);\n    };\n\n    // Set initial scroll position\n    setScrollLeft(tracksViewport.scrollLeft);\n\n    tracksViewport.addEventListener(\"scroll\", handleScroll);\n    return () => tracksViewport.removeEventListener(\"scroll\", handleScroll);\n  }, [tracksScrollRef]);\n\n  // Use timeline container height minus a few pixels for breathing room\n  const timelineContainerHeight = timelineRef.current?.offsetHeight || 400;\n  const totalHeight = timelineContainerHeight - 4;\n\n  // Get dynamic track labels width, fallback to 0 if no tracks or no ref\n  const trackLabelsWidth =\n    tracks.length > 0 && trackLabelsRef?.current\n      ? trackLabelsRef.current.offsetWidth\n      : 0;\n\n  // Calculate position locked to timeline content (accounting for scroll)\n  const timelinePosition =\n    playheadPosition * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\n  const rawLeftPosition = trackLabelsWidth + timelinePosition - scrollLeft;\n\n  // Get the timeline content width and viewport width for right boundary\n  const timelineContentWidth =\n    duration * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\n  const tracksViewport = tracksScrollRef.current;\n  const viewportWidth = tracksViewport?.clientWidth || 1000;\n\n  // Constrain playhead to never appear outside the timeline area\n  const leftBoundary = trackLabelsWidth;\n  const rightBoundary = Math.min(\n    trackLabelsWidth + timelineContentWidth - scrollLeft, // Don't go beyond timeline content\n    trackLabelsWidth + viewportWidth // Don't go beyond viewport\n  );\n\n  const leftPosition = Math.max(\n    leftBoundary,\n    Math.min(rightBoundary, rawLeftPosition)\n  );\n\n  // Debug logging when playhead might go outside\n  if (rawLeftPosition < leftBoundary || rawLeftPosition > rightBoundary) {\n    console.log(\n      \"PLAYHEAD VISUAL DEBUG:\",\n      JSON.stringify({\n        playheadPosition,\n        timelinePosition,\n        trackLabelsWidth,\n        scrollLeft,\n        rawLeftPosition,\n        constrainedLeftPosition: leftPosition,\n        leftBoundary,\n        rightBoundary,\n        timelineContentWidth,\n        viewportWidth,\n        zoomLevel,\n      })\n    );\n  }\n\n  return (\n    <div\n      ref={playheadRef}\n      className=\"absolute pointer-events-auto z-40\"\n      style={{\n        left: `${leftPosition}px`,\n        top: 0,\n        height: `${totalHeight}px`,\n        width: \"2px\", // Slightly wider for better click target\n      }}\n      onMouseDown={handlePlayheadMouseDown}\n    >\n      {/* The playhead line spanning full height */}\n      <div\n        className={`absolute left-0 w-0.5 cursor-col-resize h-full ${isSnappingToPlayhead ? \"bg-foreground\" : \"bg-foreground\"}`}\n      />\n\n      {/* Playhead dot indicator at the top (in ruler area) */}\n      <div\n        className={`absolute top-1 left-1/2 transform -translate-x-1/2 w-3 h-3 rounded-full border-2 shadow-xs ${isSnappingToPlayhead ? \"bg-foreground border-foreground\" : \"bg-foreground border-foreground/50\"}`}\n      />\n    </div>\n  );\n}\n\n// Also export a hook for getting ruler handlers\nexport function useTimelinePlayheadRuler({\n  currentTime,\n  duration,\n  zoomLevel,\n  seek,\n  rulerRef,\n  rulerScrollRef,\n  tracksScrollRef,\n  playheadRef,\n}: Omit<TimelinePlayheadProps, \"tracks\" | \"trackLabelsRef\" | \"timelineRef\">) {\n  const { handleRulerMouseDown, isDraggingRuler } = useTimelinePlayhead({\n    currentTime,\n    duration,\n    zoomLevel,\n    seek,\n    rulerRef,\n    rulerScrollRef,\n    tracksScrollRef,\n    playheadRef,\n  });\n\n  return { handleRulerMouseDown, isDraggingRuler };\n}\n\nexport { TimelinePlayhead as default };\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6357, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/selection-box.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef } from \"react\";\n\ninterface SelectionBoxProps {\n  startPos: { x: number; y: number } | null;\n  currentPos: { x: number; y: number } | null;\n  containerRef: React.RefObject<HTMLElement>;\n  isActive: boolean;\n}\n\nexport function SelectionBox({\n  startPos,\n  currentPos,\n  containerRef,\n  isActive,\n}: SelectionBoxProps) {\n  const selectionBoxRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!isActive || !startPos || !currentPos || !containerRef.current) return;\n\n    const container = containerRef.current;\n    const containerRect = container.getBoundingClientRect();\n\n    // Calculate relative positions within the container\n    const startX = startPos.x - containerRect.left;\n    const startY = startPos.y - containerRect.top;\n    const currentX = currentPos.x - containerRect.left;\n    const currentY = currentPos.y - containerRect.top;\n\n    // Calculate the selection rectangle bounds\n    const left = Math.min(startX, currentX);\n    const top = Math.min(startY, currentY);\n    const width = Math.abs(currentX - startX);\n    const height = Math.abs(currentY - startY);\n\n    // Update the selection box position and size\n    if (selectionBoxRef.current) {\n      selectionBoxRef.current.style.left = `${left}px`;\n      selectionBoxRef.current.style.top = `${top}px`;\n      selectionBoxRef.current.style.width = `${width}px`;\n      selectionBoxRef.current.style.height = `${height}px`;\n    }\n  }, [startPos, currentPos, isActive, containerRef]);\n\n  if (!isActive || !startPos || !currentPos) return null;\n\n  return (\n    <div\n      ref={selectionBoxRef}\n      className=\"absolute pointer-events-none z-50 bg-foreground/10\"\n    />\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;;AAWO,SAAS,aAAa,EAC3B,QAAQ,EACR,UAAU,EACV,YAAY,EACZ,QAAQ,EACU;IAClB,MAAM,kBAAkB,CAAA,GAAA,0QAAA,CAAA,SAAM,AAAD,EAAkB;IAE/C,CAAA,GAAA,0QAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,cAAc,CAAC,aAAa,OAAO,EAAE;QAEpE,MAAM,YAAY,aAAa,OAAO;QACtC,MAAM,gBAAgB,UAAU,qBAAqB;QAErD,oDAAoD;QACpD,MAAM,SAAS,SAAS,CAAC,GAAG,cAAc,IAAI;QAC9C,MAAM,SAAS,SAAS,CAAC,GAAG,cAAc,GAAG;QAC7C,MAAM,WAAW,WAAW,CAAC,GAAG,cAAc,IAAI;QAClD,MAAM,WAAW,WAAW,CAAC,GAAG,cAAc,GAAG;QAEjD,2CAA2C;QAC3C,MAAM,OAAO,KAAK,GAAG,CAAC,QAAQ;QAC9B,MAAM,MAAM,KAAK,GAAG,CAAC,QAAQ;QAC7B,MAAM,QAAQ,KAAK,GAAG,CAAC,WAAW;QAClC,MAAM,SAAS,KAAK,GAAG,CAAC,WAAW;QAEnC,6CAA6C;QAC7C,IAAI,gBAAgB,OAAO,EAAE;YAC3B,gBAAgB,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,KAAK,EAAE,CAAC;YAChD,gBAAgB,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,IAAI,EAAE,CAAC;YAC9C,gBAAgB,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,GAAG,MAAM,EAAE,CAAC;YAClD,gBAAgB,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,OAAO,EAAE,CAAC;QACtD;IACF,GAAG;QAAC;QAAU;QAAY;QAAU;KAAa;IAEjD,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,YAAY,OAAO;IAElD,qBACE,mTAAC;QACC,KAAK;QACL,WAAU;;;;;;AAGhB","debugId":null}},
    {"offset": {"line": 6408, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/snap-indicator.tsx"],"sourcesContent":["\"use client\";\n\nimport { SnapPoint } from \"@/hooks/use-timeline-snapping\";\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\nimport type { TimelineTrack } from \"@/types/timeline\";\nimport { useState, useEffect } from \"react\";\n\ninterface SnapIndicatorProps {\n  snapPoint: SnapPoint | null;\n  zoomLevel: number;\n  isVisible: boolean;\n  tracks: TimelineTrack[];\n  timelineRef: React.RefObject<HTMLDivElement>;\n  trackLabelsRef?: React.RefObject<HTMLDivElement>;\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\n}\n\nexport function SnapIndicator({\n  snapPoint,\n  zoomLevel,\n  isVisible,\n  tracks,\n  timelineRef,\n  trackLabelsRef,\n  tracksScrollRef,\n}: SnapIndicatorProps) {\n  const [scrollLeft, setScrollLeft] = useState(0);\n\n  // Track scroll position to lock snap indicator to frame\n  useEffect(() => {\n    const tracksViewport = tracksScrollRef.current;\n\n    if (!tracksViewport) return;\n\n    const handleScroll = () => {\n      setScrollLeft(tracksViewport.scrollLeft);\n    };\n\n    // Set initial scroll position\n    setScrollLeft(tracksViewport.scrollLeft);\n\n    tracksViewport.addEventListener(\"scroll\", handleScroll);\n    return () => tracksViewport.removeEventListener(\"scroll\", handleScroll);\n  }, [tracksScrollRef]);\n\n  if (!isVisible || !snapPoint) {\n    return null;\n  }\n\n  const timelineContainerHeight = timelineRef.current?.offsetHeight || 400;\n  const totalHeight = timelineContainerHeight - 8; // 8px padding from edges\n\n  // Get dynamic track labels width, fallback to 0 if no tracks or no ref\n  const trackLabelsWidth =\n    tracks.length > 0 && trackLabelsRef?.current\n      ? trackLabelsRef.current.offsetWidth\n      : 0;\n\n  // Calculate position locked to timeline content (accounting for scroll)\n  const timelinePosition =\n    snapPoint.time * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\n  const leftPosition = trackLabelsWidth + timelinePosition - scrollLeft;\n\n  return (\n    <div\n      className=\"absolute pointer-events-none z-90\"\n      style={{\n        left: `${leftPosition}px`,\n        top: 0,\n        height: `${totalHeight}px`,\n        width: \"2px\",\n      }}\n    >\n      <div className={\"w-0.5 h-full bg-primary/40 opacity-80\"} />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AAEA;AALA;;;;AAiBO,SAAS,cAAc,EAC5B,SAAS,EACT,SAAS,EACT,SAAS,EACT,MAAM,EACN,WAAW,EACX,cAAc,EACd,eAAe,EACI;IACnB,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,0QAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,wDAAwD;IACxD,CAAA,GAAA,0QAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,iBAAiB,gBAAgB,OAAO;QAE9C,IAAI,CAAC,gBAAgB;QAErB,MAAM,eAAe;YACnB,cAAc,eAAe,UAAU;QACzC;QAEA,8BAA8B;QAC9B,cAAc,eAAe,UAAU;QAEvC,eAAe,gBAAgB,CAAC,UAAU;QAC1C,OAAO,IAAM,eAAe,mBAAmB,CAAC,UAAU;IAC5D,GAAG;QAAC;KAAgB;IAEpB,IAAI,CAAC,aAAa,CAAC,WAAW;QAC5B,OAAO;IACT;IAEA,MAAM,0BAA0B,YAAY,OAAO,EAAE,gBAAgB;IACrE,MAAM,cAAc,0BAA0B,GAAG,yBAAyB;IAE1E,uEAAuE;IACvE,MAAM,mBACJ,OAAO,MAAM,GAAG,KAAK,gBAAgB,UACjC,eAAe,OAAO,CAAC,WAAW,GAClC;IAEN,wEAAwE;IACxE,MAAM,mBACJ,UAAU,IAAI,GAAG,wJAAA,CAAA,qBAAkB,CAAC,iBAAiB,GAAG;IAC1D,MAAM,eAAe,mBAAmB,mBAAmB;IAE3D,qBACE,mTAAC;QACC,WAAU;QACV,OAAO;YACL,MAAM,GAAG,aAAa,EAAE,CAAC;YACzB,KAAK;YACL,QAAQ,GAAG,YAAY,EAAE,CAAC;YAC1B,OAAO;QACT;kBAEA,cAAA,mTAAC;YAAI,WAAW;;;;;;;;;;;AAGtB","debugId":null}},
    {"offset": {"line": 6469, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/timeline/timeline-cache-indicator.tsx"],"sourcesContent":["\"use client\";\n\nimport { cn } from \"@/lib/utils\";\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\nimport { TimelineTrack } from \"@/types/timeline\";\nimport { MediaFile } from \"@/types/media\";\nimport { TProject } from \"@/types/project\";\nimport { useSceneStore } from \"@/stores/scene-store\";\n\ninterface CacheSegment {\n  startTime: number;\n  endTime: number;\n  cached: boolean;\n}\n\ninterface TimelineCacheIndicatorProps {\n  duration: number;\n  zoomLevel: number;\n  tracks: TimelineTrack[];\n  mediaFiles: MediaFile[];\n  activeProject: TProject | null;\n  getRenderStatus: (\n    time: number,\n    tracks: TimelineTrack[],\n    mediaFiles: MediaFile[],\n    activeProject: TProject | null,\n    sceneId?: string\n  ) => \"cached\" | \"not-cached\";\n}\n\nexport function TimelineCacheIndicator({\n  duration,\n  zoomLevel,\n  tracks,\n  mediaFiles,\n  activeProject,\n  getRenderStatus,\n}: TimelineCacheIndicatorProps) {\n  const { currentScene } = useSceneStore();\n\n  // Calculate cache segments by sampling the timeline\n  const calculateCacheSegments = (): CacheSegment[] => {\n    const segments: CacheSegment[] = [];\n    const sampleRate = 10; // Sample every 0.1 seconds\n    const totalSamples = Math.ceil(duration * sampleRate);\n\n    if (totalSamples === 0) {\n      return [{ startTime: 0, endTime: duration, cached: false }];\n    }\n\n    let currentSegment: CacheSegment | null = null;\n\n    for (let i = 0; i <= totalSamples; i++) {\n      const time = i / sampleRate;\n      const cached =\n        getRenderStatus(\n          time,\n          tracks,\n          mediaFiles,\n          activeProject,\n          currentScene?.id\n        ) === \"cached\";\n\n      if (!currentSegment) {\n        // Start first segment\n        currentSegment = {\n          startTime: time,\n          endTime: time,\n          cached,\n        };\n      } else if (currentSegment.cached === cached) {\n        // Extend current segment\n        currentSegment.endTime = time;\n      } else {\n        // Finish current segment and start new one\n        segments.push(currentSegment);\n        currentSegment = {\n          startTime: time,\n          endTime: time,\n          cached,\n        };\n      }\n    }\n\n    // Add the last segment\n    if (currentSegment) {\n      currentSegment.endTime = duration;\n      segments.push(currentSegment);\n    }\n\n    return segments;\n  };\n\n  const cacheSegments = calculateCacheSegments();\n\n  return (\n    <div className=\"absolute top-0 left-0 right-0 h-px z-10 pointer-events-none\">\n      {cacheSegments.map((segment, index) => {\n        const startX =\n          segment.startTime * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\n        const endX =\n          segment.endTime * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\n        const width = endX - startX;\n\n        return (\n          <div\n            key={index}\n            className={cn(\n              \"absolute top-0 h-px\",\n              segment.cached ? \"bg-primary\" : \"bg-transparent\"\n            )}\n            style={{\n              left: `${startX}px`,\n              width: `${width}px`,\n            }}\n            title={\n              segment.cached\n                ? \"Cached (fast playback)\"\n                : \"Not cached (will render)\"\n            }\n          />\n        );\n      })}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAIA;AAPA;;;;;AA8BO,SAAS,uBAAuB,EACrC,QAAQ,EACR,SAAS,EACT,MAAM,EACN,UAAU,EACV,aAAa,EACb,eAAe,EACa;IAC5B,MAAM,EAAE,YAAY,EAAE,GAAG,CAAA,GAAA,8IAAA,CAAA,gBAAa,AAAD;IAErC,oDAAoD;IACpD,MAAM,yBAAyB;QAC7B,MAAM,WAA2B,EAAE;QACnC,MAAM,aAAa,IAAI,2BAA2B;QAClD,MAAM,eAAe,KAAK,IAAI,CAAC,WAAW;QAE1C,IAAI,iBAAiB,GAAG;YACtB,OAAO;gBAAC;oBAAE,WAAW;oBAAG,SAAS;oBAAU,QAAQ;gBAAM;aAAE;QAC7D;QAEA,IAAI,iBAAsC;QAE1C,IAAK,IAAI,IAAI,GAAG,KAAK,cAAc,IAAK;YACtC,MAAM,OAAO,IAAI;YACjB,MAAM,SACJ,gBACE,MACA,QACA,YACA,eACA,cAAc,QACV;YAER,IAAI,CAAC,gBAAgB;gBACnB,sBAAsB;gBACtB,iBAAiB;oBACf,WAAW;oBACX,SAAS;oBACT;gBACF;YACF,OAAO,IAAI,eAAe,MAAM,KAAK,QAAQ;gBAC3C,yBAAyB;gBACzB,eAAe,OAAO,GAAG;YAC3B,OAAO;gBACL,2CAA2C;gBAC3C,SAAS,IAAI,CAAC;gBACd,iBAAiB;oBACf,WAAW;oBACX,SAAS;oBACT;gBACF;YACF;QACF;QAEA,uBAAuB;QACvB,IAAI,gBAAgB;YAClB,eAAe,OAAO,GAAG;YACzB,SAAS,IAAI,CAAC;QAChB;QAEA,OAAO;IACT;IAEA,MAAM,gBAAgB;IAEtB,qBACE,mTAAC;QAAI,WAAU;kBACZ,cAAc,GAAG,CAAC,CAAC,SAAS;YAC3B,MAAM,SACJ,QAAQ,SAAS,GAAG,wJAAA,CAAA,qBAAkB,CAAC,iBAAiB,GAAG;YAC7D,MAAM,OACJ,QAAQ,OAAO,GAAG,wJAAA,CAAA,qBAAkB,CAAC,iBAAiB,GAAG;YAC3D,MAAM,QAAQ,OAAO;YAErB,qBACE,mTAAC;gBAEC,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EACV,uBACA,QAAQ,MAAM,GAAG,eAAe;gBAElC,OAAO;oBACL,MAAM,GAAG,OAAO,EAAE,CAAC;oBACnB,OAAO,GAAG,MAAM,EAAE,CAAC;gBACrB;gBACA,OACE,QAAQ,MAAM,GACV,2BACA;eAZD;;;;;QAgBX;;;;;;AAGN","debugId":null}},
    {"offset": {"line": 6558, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/timeline/timeline-marker.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\n\r\ninterface TimelineMarkerProps {\r\n  time: number;\r\n  zoomLevel: number;\r\n  interval: number;\r\n  isMainMarker: boolean;\r\n}\r\n\r\nexport function TimelineMarker({\r\n  time,\r\n  zoomLevel,\r\n  interval,\r\n  isMainMarker,\r\n}: TimelineMarkerProps) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"absolute top-0 h-4\",\r\n        isMainMarker\r\n          ? \"border-l border-muted-foreground/40\"\r\n          : \"border-l border-muted-foreground/20\"\r\n      )}\r\n      style={{\r\n        left: `${time * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel}px`,\r\n      }}\r\n    >\r\n      <span\r\n        className={cn(\r\n          \"absolute top-1 left-1 text-[0.6rem]\",\r\n          isMainMarker\r\n            ? \"text-muted-foreground font-medium\"\r\n            : \"text-muted-foreground/70\"\r\n        )}\r\n      >\r\n        {(() => {\r\n          const formatTime = (seconds: number) => {\r\n            const hours = Math.floor(seconds / 3600);\r\n            const minutes = Math.floor((seconds % 3600) / 60);\r\n            const secs = seconds % 60;\r\n\r\n            if (hours > 0) {\r\n              return `${hours}:${minutes\r\n                .toString()\r\n                .padStart(2, \"0\")}:${Math.floor(secs)\r\n                .toString()\r\n                .padStart(2, \"0\")}`;\r\n            }\r\n            if (minutes > 0) {\r\n              return `${minutes}:${Math.floor(secs)\r\n                .toString()\r\n                .padStart(2, \"0\")}`;\r\n            }\r\n            if (interval >= 1) {\r\n              return `${Math.floor(secs)}s`;\r\n            }\r\n            return `${secs.toFixed(1)}s`;\r\n          };\r\n          return formatTime(time);\r\n        })()}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;;AAYO,SAAS,eAAe,EAC7B,IAAI,EACJ,SAAS,EACT,QAAQ,EACR,YAAY,EACQ;IACpB,qBACE,mTAAC;QACC,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EACV,sBACA,eACI,wCACA;QAEN,OAAO;YACL,MAAM,GAAG,OAAO,wJAAA,CAAA,qBAAkB,CAAC,iBAAiB,GAAG,UAAU,EAAE,CAAC;QACtE;kBAEA,cAAA,mTAAC;YACC,WAAW,CAAA,GAAA,kIAAA,CAAA,KAAE,AAAD,EACV,uCACA,eACI,sCACA;sBAGL,CAAC;gBACA,MAAM,aAAa,CAAC;oBAClB,MAAM,QAAQ,KAAK,KAAK,CAAC,UAAU;oBACnC,MAAM,UAAU,KAAK,KAAK,CAAC,AAAC,UAAU,OAAQ;oBAC9C,MAAM,OAAO,UAAU;oBAEvB,IAAI,QAAQ,GAAG;wBACb,OAAO,GAAG,MAAM,CAAC,EAAE,QAChB,QAAQ,GACR,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAE,KAAK,KAAK,CAAC,MAC/B,QAAQ,GACR,QAAQ,CAAC,GAAG,MAAM;oBACvB;oBACA,IAAI,UAAU,GAAG;wBACf,OAAO,GAAG,QAAQ,CAAC,EAAE,KAAK,KAAK,CAAC,MAC7B,QAAQ,GACR,QAAQ,CAAC,GAAG,MAAM;oBACvB;oBACA,IAAI,YAAY,GAAG;wBACjB,OAAO,GAAG,KAAK,KAAK,CAAC,MAAM,CAAC,CAAC;oBAC/B;oBACA,OAAO,GAAG,KAAK,OAAO,CAAC,GAAG,CAAC,CAAC;gBAC9B;gBACA,OAAO,WAAW;YACpB,CAAC;;;;;;;;;;;AAIT","debugId":null}},
    {"offset": {"line": 6609, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/scenes-view.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { Button } from \"@/components/ui/button\";\nimport { useSceneStore } from \"@/stores/scene-store\";\nimport { Check, ListCheck, Trash2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\n\nexport function ScenesView({ children }: { children: React.ReactNode }) {\n  const { scenes, currentScene, switchToScene, deleteScene } = useSceneStore();\n  const [isSelectMode, setIsSelectMode] = useState(false);\n  const [selectedScenes, setSelectedScenes] = useState<Set<string>>(new Set());\n\n  const handleSceneSwitch = async (sceneId: string) => {\n    if (isSelectMode) {\n      toggleSceneSelection(sceneId);\n      return;\n    }\n\n    try {\n      await switchToScene({ sceneId });\n    } catch (error) {\n      console.error(\"Failed to switch scene:\", error);\n    }\n  };\n\n  const toggleSceneSelection = (sceneId: string) => {\n    setSelectedScenes((prev) => {\n      const newSet = new Set(prev);\n      if (newSet.has(sceneId)) {\n        newSet.delete(sceneId);\n      } else {\n        newSet.add(sceneId);\n      }\n      return newSet;\n    });\n  };\n\n  const handleSelectMode = () => {\n    setIsSelectMode(!isSelectMode);\n    setSelectedScenes(new Set());\n  };\n\n  const handleDeleteSelected = async () => {\n    for (const sceneId of selectedScenes) {\n      const scene = scenes.find((s) => s.id === sceneId);\n      if (scene && !scene.isMain) {\n        try {\n          await deleteScene({ sceneId });\n        } catch (error) {\n          console.error(\"Failed to delete scene:\", error);\n        }\n      }\n    }\n    setSelectedScenes(new Set());\n    setIsSelectMode(false);\n  };\n\n  return (\n    <Sheet>\n      <SheetTrigger asChild>{children}</SheetTrigger>\n      <SheetContent>\n        <SheetHeader>\n          <SheetTitle>\n            {isSelectMode ? `Select scenes (${selectedScenes.size})` : \"Scenes\"}\n          </SheetTitle>\n          <SheetDescription>\n            {isSelectMode\n              ? \"Select scenes to delete\"\n              : \"Switch between scenes in your project\"}\n          </SheetDescription>\n        </SheetHeader>\n        <div className=\"py-4 flex flex-col gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              className=\"rounded-md\"\n              variant={isSelectMode ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={handleSelectMode}\n            >\n              <ListCheck />\n              {isSelectMode ? \"Cancel\" : \"Select\"}\n            </Button>\n            {isSelectMode && (\n              <DeleteDialog\n                count={selectedScenes.size}\n                onDelete={handleDeleteSelected}\n                disabled={Array.from(selectedScenes).some(\n                  (id) => scenes.find((s) => s.id === id)?.isMain\n                )}\n              >\n                <Button className=\"rounded-md\" variant=\"destructive\" size=\"sm\">\n                  <Trash2 />\n                  Delete ({selectedScenes.size})\n                </Button>\n              </DeleteDialog>\n            )}\n          </div>\n          {scenes.length === 0 ? (\n            <div className=\"text-sm text-muted-foreground\">\n              No scenes available\n            </div>\n          ) : (\n            <div className=\"space-y-2\">\n              {scenes.map((scene) => (\n                <Button\n                  key={scene.id}\n                  variant=\"outline\"\n                  className={cn(\n                    \"w-full justify-between font-normal\",\n                    currentScene?.id === scene.id &&\n                      !isSelectMode &&\n                      \"border-primary !text-primary\",\n                    isSelectMode &&\n                      selectedScenes.has(scene.id) &&\n                      \"bg-accent border-foreground/30\"\n                  )}\n                  onClick={() => handleSceneSwitch(scene.id)}\n                >\n                  <span>{scene.name}</span>\n                  <div className=\"flex items-center gap-2\">\n                    {((isSelectMode && selectedScenes.has(scene.id)) ||\n                      (!isSelectMode && currentScene?.id === scene.id)) && (\n                      <Check className=\"h-4 w-4\" />\n                    )}\n                  </div>\n                </Button>\n              ))}\n            </div>\n          )}\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n\nfunction DeleteDialog({\n  count,\n  onDelete,\n  disabled,\n  children,\n}: {\n  count: number;\n  onDelete: () => void;\n  disabled?: boolean;\n  children: React.ReactNode;\n}) {\n  const [open, setOpen] = useState(false);\n\n  const handleDelete = () => {\n    onDelete();\n    setOpen(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>{children}</DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Delete Scenes</DialogTitle>\n          <DialogDescription>\n            Are you sure you want to delete {count} scene\n            {count === 1 ? \"\" : \"s\"}? This action cannot be undone.\n          </DialogDescription>\n        </DialogHeader>\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>\n            Cancel\n          </Button>\n          <Button\n            variant=\"destructive\"\n            onClick={handleDelete}\n            disabled={disabled}\n          >\n            Delete\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6928, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/timeline/timeline-toolbar.tsx"],"sourcesContent":["import { usePlaybackStore } from \"@/stores/playback-store\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { useSceneStore } from \"@/stores/scene-store\";\nimport { toast } from \"sonner\";\nimport {\n  TooltipProvider,\n  Tooltip,\n  TooltipTrigger,\n  TooltipContent,\n} from \"@/components/ui/tooltip\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Pause,\n  Play,\n  SkipBack,\n  Bookmark,\n  Magnet,\n  Link,\n  ZoomOut,\n  ZoomIn,\n  Copy,\n  Trash2,\n  Snowflake,\n  ArrowLeftToLine,\n  ArrowRightToLine,\n  SplitSquareHorizontal,\n  Scissors,\n  LayersIcon,\n} from \"lucide-react\";\nimport {\n  SplitButton,\n  SplitButtonLeft,\n  SplitButtonRight,\n  SplitButtonSeparator,\n} from \"@/components/ui/split-button\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { DEFAULT_FPS } from \"@/stores/project-store\";\nimport { formatTimeCode } from \"@/lib/time\";\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\nimport { EditableTimecode } from \"@/components/ui/editable-timecode\";\nimport { ScenesView } from \"../scenes-view\";\n\nexport function TimelineToolbar({\n  zoomLevel,\n  setZoomLevel,\n}: {\n  zoomLevel: number;\n  setZoomLevel: (zoom: number) => void;\n}) {\n  const {\n    tracks,\n    addTrack,\n    addElementToTrack,\n    selectedElements,\n    clearSelectedElements,\n    deleteSelected,\n    splitSelected,\n    splitAndKeepLeft,\n    splitAndKeepRight,\n    separateAudio,\n    snappingEnabled,\n    toggleSnapping,\n    rippleEditingEnabled,\n    toggleRippleEditing,\n  } = useTimelineStore();\n  const { currentTime, duration, isPlaying, toggle, seek } = usePlaybackStore();\n  const { toggleBookmark, isBookmarked, activeProject } = useProjectStore();\n  const { scenes, currentScene } = useSceneStore();\n\n  const handleSplitSelected = () => {\n    splitSelected(currentTime);\n  };\n\n  const handleDuplicateSelected = () => {\n    if (selectedElements.length === 0) return;\n    const canDuplicate = selectedElements.length === 1;\n    if (!canDuplicate) return;\n\n    selectedElements.forEach(({ trackId, elementId }) => {\n      const track = tracks.find((t) => t.id === trackId);\n      const element = track?.elements.find((el) => el.id === elementId);\n      if (element) {\n        const newStartTime =\n          element.startTime +\n          (element.duration - element.trimStart - element.trimEnd) +\n          0.1;\n        const { id, ...elementWithoutId } = element;\n        addElementToTrack(trackId, {\n          ...elementWithoutId,\n          startTime: newStartTime,\n        });\n      }\n    });\n    clearSelectedElements();\n  };\n\n  const handleFreezeSelected = () => {\n    toast.info(\"Freeze frame functionality coming soon!\");\n  };\n\n  const handleSplitAndKeepLeft = () => {\n    if (selectedElements.length !== 1) {\n      toast.error(\"Select exactly one element\");\n      return;\n    }\n    const { trackId, elementId } = selectedElements[0];\n    const track = tracks.find((t) => t.id === trackId);\n    const element = track?.elements.find((c) => c.id === elementId);\n    if (!element) return;\n    const effectiveStart = element.startTime;\n    const effectiveEnd =\n      element.startTime +\n      (element.duration - element.trimStart - element.trimEnd);\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\n      toast.error(\"Playhead must be within selected element\");\n      return;\n    }\n    splitAndKeepLeft(trackId, elementId, currentTime);\n  };\n\n  const handleSplitAndKeepRight = () => {\n    if (selectedElements.length !== 1) {\n      toast.error(\"Select exactly one element\");\n      return;\n    }\n    const { trackId, elementId } = selectedElements[0];\n    const track = tracks.find((t) => t.id === trackId);\n    const element = track?.elements.find((c) => c.id === elementId);\n    if (!element) return;\n    const effectiveStart = element.startTime;\n    const effectiveEnd =\n      element.startTime +\n      (element.duration - element.trimStart - element.trimEnd);\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\n      toast.error(\"Playhead must be within selected element\");\n      return;\n    }\n    splitAndKeepRight(trackId, elementId, currentTime);\n  };\n\n  const handleSeparateAudio = () => {\n    if (selectedElements.length !== 1) {\n      toast.error(\"Select exactly one media element to separate audio\");\n      return;\n    }\n    const { trackId, elementId } = selectedElements[0];\n    const track = tracks.find((t) => t.id === trackId);\n    if (!track || track.type !== \"media\") {\n      toast.error(\"Select a media element to separate audio\");\n      return;\n    }\n    separateAudio(trackId, elementId);\n  };\n\n  const handleDeleteSelected = () => {\n    deleteSelected();\n  };\n\n  const handleZoomIn = () => {\n    setZoomLevel(Math.min(4, zoomLevel + 0.25));\n  };\n\n  const handleZoomOut = () => {\n    setZoomLevel(Math.max(0.25, zoomLevel - 0.25));\n  };\n\n  const handleZoomSliderChange = (values: number[]) => {\n    setZoomLevel(values[0]);\n  };\n\n  const handleToggleBookmark = async () => {\n    await toggleBookmark(currentTime);\n  };\n\n  const currentBookmarked = isBookmarked(currentTime);\n  return (\n    <div className=\"flex items-center justify-between px-2 py-1 border-b h-10\">\n      <div className=\"flex items-center gap-1\">\n        <TooltipProvider delayDuration={500}>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={toggle}>\n                {isPlaying ? (\n                  <Pause className=\"h-4 w-4\" />\n                ) : (\n                  <Play className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              {isPlaying ? \"Pause (Space)\" : \"Play (Space)\"}\n            </TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={() => seek(0)}>\n                <SkipBack className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Return to Start (Home / Enter)</TooltipContent>\n          </Tooltip>\n          <div className=\"w-px h-6 bg-border mx-1\" />\n          {/* Time Display */}\n          <div className=\"flex flex-row items-center justify-center px-2\">\n            <EditableTimecode\n              time={currentTime}\n              duration={duration}\n              format=\"HH:MM:SS:FF\"\n              fps={activeProject?.fps ?? DEFAULT_FPS}\n              onTimeChange={seek}\n              className=\"text-center\"\n            />\n            <div className=\"text-xs text-muted-foreground font-mono px-2\">\n              /\n            </div>\n            <div className=\"text-xs text-muted-foreground font-mono text-center\">\n              {formatTimeCode(duration, \"HH:MM:SS:FF\")}\n            </div>\n          </div>\n          {tracks.length === 0 && (\n            <>\n              <div className=\"w-px h-6 bg-border mx-1\" />\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const trackId = addTrack(\"media\");\n                      addElementToTrack(trackId, {\n                        type: \"media\",\n                        mediaId: \"test\",\n                        name: \"Test Clip\",\n                        duration: TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,\n                        startTime: 0,\n                        trimStart: 0,\n                        trimEnd: 0,\n                      });\n                    }}\n                    className=\"text-xs\"\n                  >\n                    Add Test Clip\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>Add a test clip to try playback</TooltipContent>\n              </Tooltip>\n            </>\n          )}\n          <div className=\"w-px h-6 bg-border mx-1\" />\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={handleSplitSelected}>\n                <Scissors className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Split element (Ctrl+S)</TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"text\"\n                size=\"icon\"\n                onClick={handleSplitAndKeepLeft}\n              >\n                <ArrowLeftToLine className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Split and keep left (Ctrl+Q)</TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"text\"\n                size=\"icon\"\n                onClick={handleSplitAndKeepRight}\n              >\n                <ArrowRightToLine className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Split and keep right (Ctrl+W)</TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={handleSeparateAudio}>\n                <SplitSquareHorizontal className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Separate audio (Ctrl+D)</TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"text\"\n                size=\"icon\"\n                onClick={handleDuplicateSelected}\n              >\n                <Copy className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Duplicate element (Ctrl+D)</TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={handleFreezeSelected}>\n                <Snowflake className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Freeze frame (F)</TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={handleDeleteSelected}>\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Delete element (Delete)</TooltipContent>\n          </Tooltip>\n          <div className=\"w-px h-6 bg-border mx-1\" />\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={handleToggleBookmark}>\n                <Bookmark\n                  className={`h-4 w-4 ${currentBookmarked ? \"fill-primary text-primary\" : \"\"}`}\n                />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              {currentBookmarked ? \"Remove bookmark\" : \"Add bookmark\"}\n            </TooltipContent>\n          </Tooltip>\n        </TooltipProvider>\n      </div>\n      <div>\n        <SplitButton className=\"border border-foreground/10\">\n          <SplitButtonLeft>{currentScene?.name || \"No Scene\"}</SplitButtonLeft>\n          <SplitButtonSeparator />\n          <ScenesView>\n            <SplitButtonRight disabled={scenes.length === 1} onClick={() => {}}>\n              <LayersIcon />\n            </SplitButtonRight>\n          </ScenesView>\n        </SplitButton>\n      </div>\n      <div className=\"flex items-center gap-1\">\n        <TooltipProvider delayDuration={500}>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={toggleSnapping}>\n                {snappingEnabled ? (\n                  <Magnet className=\"h-4 w-4 text-primary\" />\n                ) : (\n                  <Magnet className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Auto snapping</TooltipContent>\n          </Tooltip>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant=\"text\" size=\"icon\" onClick={toggleRippleEditing}>\n                <Link\n                  className={`h-4 w-4 ${\n                    rippleEditingEnabled ? \"text-primary\" : \"\"\n                  }`}\n                />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              {rippleEditingEnabled\n                ? \"Disable Ripple Editing\"\n                : \"Enable Ripple Editing\"}\n            </TooltipContent>\n          </Tooltip>\n        </TooltipProvider>\n\n        <div className=\"h-6 w-px bg-border mx-1\" />\n        <div className=\"flex items-center gap-1\">\n          <Button variant=\"text\" size=\"icon\" onClick={handleZoomOut}>\n            <ZoomOut className=\"h-4 w-4\" />\n          </Button>\n          <Slider\n            className=\"w-24\"\n            value={[zoomLevel]}\n            onValueChange={handleZoomSliderChange}\n            min={0.25}\n            max={4}\n            step={0.25}\n          />\n          <Button variant=\"text\" size=\"icon\" onClick={handleZoomIn}>\n            <ZoomIn className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7806, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/timeline/index.tsx"],"sourcesContent":["\"use client\";\n\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Button } from \"../../ui/button\";\nimport {\n  Scissors,\n  ArrowLeftToLine,\n  ArrowRightToLine,\n  Trash2,\n  Snowflake,\n  Copy,\n  SplitSquareHorizontal,\n  Pause,\n  Play,\n  SkipBack,\n  Video,\n  Music,\n  TypeIcon,\n  Magnet,\n  Link,\n  ZoomIn,\n  ZoomOut,\n  Bookmark,\n  Eye,\n  VolumeOff,\n  Volume2,\n} from \"lucide-react\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n  TooltipProvider,\n} from \"../../ui/tooltip\";\nimport {\n  ContextMenu,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuTrigger,\n} from \"../../ui/context-menu\";\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { useMediaStore } from \"@/stores/media-store\";\nimport { usePlaybackStore } from \"@/stores/playback-store\";\nimport { DEFAULT_FPS, useProjectStore } from \"@/stores/project-store\";\n\nimport { useTimelineZoom } from \"@/hooks/use-timeline-zoom\";\nimport { processMediaFiles } from \"@/lib/media-processing\";\n\nimport { toast } from \"sonner\";\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { TimelineTrackContent } from \"./timeline-track\";\nimport {\n  TimelinePlayhead,\n  useTimelinePlayheadRuler,\n} from \"./timeline-playhead\";\nimport { SelectionBox } from \"../selection-box\";\nimport { useSelectionBox } from \"@/hooks/use-selection-box\";\nimport { SnapIndicator } from \"../snap-indicator\";\nimport { SnapPoint } from \"@/hooks/use-timeline-snapping\";\nimport type { DragData, TimelineTrack, TrackType } from \"@/types/timeline\";\nimport { TimelineCacheIndicator } from \"./timeline-cache-indicator\";\nimport { TimelineMarker } from \"./timeline-marker\";\nimport { useFrameCache } from \"@/hooks/use-frame-cache\";\nimport {\n  getTrackHeight,\n  getCumulativeHeightBefore,\n  getTotalTracksHeight,\n  TIMELINE_CONSTANTS,\n  snapTimeToFrame,\n} from \"@/constants/timeline-constants\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { formatTimeCode } from \"@/lib/time\";\nimport { EditableTimecode } from \"@/components/ui/editable-timecode\";\nimport { TimelineToolbar } from \"./timeline-toolbar\";\n\nexport function Timeline() {\n  // Timeline shows all tracks (video, audio, effects) and their elements.\n  // You can drag media here to add it to your project.\n  // elements can be trimmed, deleted, and moved.\n\n  const {\n    tracks,\n    getTotalDuration,\n    clearSelectedElements,\n    snappingEnabled,\n    setSelectedElements,\n    toggleTrackMute,\n    dragState,\n  } = useTimelineStore();\n  const { mediaFiles, addMediaFile } = useMediaStore();\n  const { activeProject } = useProjectStore();\n  const { currentTime, duration, seek, setDuration } = usePlaybackStore();\n  const { getRenderStatus } = useFrameCache();\n  const [isDragOver, setIsDragOver] = useState(false);\n  const { addElementToNewTrack } = useTimelineStore();\n  const dragCounterRef = useRef(0);\n  const timelineRef = useRef<HTMLDivElement>(null);\n  const rulerRef = useRef<HTMLDivElement>(null);\n  const [isInTimeline, setIsInTimeline] = useState(false);\n\n  // Track mouse down/up for distinguishing clicks from drag/resize ends\n  const mouseTrackingRef = useRef({\n    isMouseDown: false,\n    downX: 0,\n    downY: 0,\n    downTime: 0,\n  });\n\n  // Timeline zoom functionality\n  const { zoomLevel, setZoomLevel, handleWheel } = useTimelineZoom({\n    containerRef: timelineRef,\n    isInTimeline,\n  });\n\n  // Old marquee selection removed - using new SelectionBox component instead\n\n  // Dynamic timeline width calculation based on playhead position and duration\n  const dynamicTimelineWidth = Math.max(\n    (duration || 0) * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel, // Base width from duration\n    (currentTime + 30) * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel, // Width to show current time + 30 seconds buffer\n    timelineRef.current?.clientWidth || 1000 // Minimum width\n  );\n\n  // Scroll synchronization and auto-scroll to playhead\n  const rulerScrollRef = useRef<HTMLDivElement>(null);\n  const tracksScrollRef = useRef<HTMLDivElement>(null);\n  const trackLabelsRef = useRef<HTMLDivElement>(null);\n  const playheadRef = useRef<HTMLDivElement>(null);\n  const trackLabelsScrollRef = useRef<HTMLDivElement>(null);\n  const isUpdatingRef = useRef(false);\n  const lastRulerSync = useRef(0);\n  const lastTracksSync = useRef(0);\n  const lastVerticalSync = useRef(0);\n\n  // Timeline playhead ruler handlers\n  const { handleRulerMouseDown } = useTimelinePlayheadRuler({\n    currentTime,\n    duration,\n    zoomLevel,\n    seek,\n    rulerRef,\n    rulerScrollRef,\n    tracksScrollRef,\n    playheadRef,\n  });\n\n  // Selection box functionality\n  const tracksContainerRef = useRef<HTMLDivElement>(null);\n  const {\n    selectionBox,\n    handleMouseDown: handleSelectionMouseDown,\n    isSelecting,\n    justFinishedSelecting,\n  } = useSelectionBox({\n    containerRef: tracksContainerRef,\n    playheadRef,\n    onSelectionComplete: (elements) => {\n      console.log(JSON.stringify({ onSelectionComplete: elements.length }));\n      setSelectedElements(elements);\n    },\n  });\n\n  // Calculate snap indicator state\n  const [currentSnapPoint, setCurrentSnapPoint] = useState<SnapPoint | null>(\n    null\n  );\n  const showSnapIndicator =\n    dragState.isDragging && snappingEnabled && currentSnapPoint !== null;\n\n  // Callback to handle snap point changes from TimelineTrackContent\n  const handleSnapPointChange = useCallback((snapPoint: SnapPoint | null) => {\n    setCurrentSnapPoint(snapPoint);\n  }, []);\n\n  // Track mouse down to distinguish real clicks from drag/resize ends\n  const handleTimelineMouseDown = useCallback((e: React.MouseEvent) => {\n    // Only track mouse down on timeline background areas (not elements)\n    const target = e.target as HTMLElement;\n    console.log(\n      JSON.stringify({\n        debug_mousedown: \"START\",\n        target_class: target.className,\n        target_parent_class: target.parentElement?.className,\n        clientX: e.clientX,\n        clientY: e.clientY,\n        timeStamp: e.timeStamp,\n      })\n    );\n\n    const isTimelineBackground =\n      !target.closest(\".timeline-element\") &&\n      !playheadRef.current?.contains(target) &&\n      !target.closest(\"[data-track-labels]\");\n\n    console.log(\n      JSON.stringify({\n        debug_mousedown: \"CHECK\",\n        isTimelineBackground,\n        hasTimelineElement: !!target.closest(\".timeline-element\"),\n        hasPlayhead: !!playheadRef.current?.contains(target),\n        hasTrackLabels: !!target.closest(\"[data-track-labels]\"),\n      })\n    );\n\n    if (isTimelineBackground) {\n      mouseTrackingRef.current = {\n        isMouseDown: true,\n        downX: e.clientX,\n        downY: e.clientY,\n        downTime: e.timeStamp,\n      };\n      console.log(\n        JSON.stringify({\n          debug_mousedown: \"TRACKED\",\n          mouseTracking: mouseTrackingRef.current,\n        })\n      );\n    } else {\n      console.log(\n        JSON.stringify({\n          debug_mousedown: \"IGNORED - not timeline background\",\n        })\n      );\n    }\n  }, []);\n\n  // Timeline content click to seek handler\n  const handleTimelineContentClick = useCallback(\n    (e: React.MouseEvent) => {\n      console.log(\n        JSON.stringify({\n          debug_click: \"START\",\n          target: (e.target as HTMLElement).className,\n          target_parent: (e.target as HTMLElement).parentElement?.className,\n          mouseTracking: mouseTrackingRef.current,\n          isSelecting,\n          justFinishedSelecting,\n          clickX: e.clientX,\n          clickY: e.clientY,\n          timeStamp: e.timeStamp,\n        })\n      );\n\n      const { isMouseDown, downX, downY, downTime } = mouseTrackingRef.current;\n\n      // Reset mouse tracking\n      mouseTrackingRef.current = {\n        isMouseDown: false,\n        downX: 0,\n        downY: 0,\n        downTime: 0,\n      };\n\n      // Only process as click if we tracked a mouse down on timeline background\n      if (!isMouseDown) {\n        console.log(\n          JSON.stringify({\n            debug_click: \"REJECTED - no mousedown\",\n            mouseTracking: mouseTrackingRef.current,\n          })\n        );\n        return;\n      }\n\n      // Check if mouse moved significantly (indicates drag, not click)\n      const deltaX = Math.abs(e.clientX - downX);\n      const deltaY = Math.abs(e.clientY - downY);\n      const deltaTime = e.timeStamp - downTime;\n\n      if (deltaX > 5 || deltaY > 5 || deltaTime > 500) {\n        console.log(\n          JSON.stringify({\n            debug_click: \"REJECTED - movement too large\",\n            deltaX,\n            deltaY,\n            deltaTime,\n          })\n        );\n        return;\n      }\n\n      // Don't seek if this was a selection box operation\n      if (isSelecting || justFinishedSelecting) {\n        console.log(\n          JSON.stringify({\n            debug_click: \"REJECTED - selection operation\",\n            isSelecting,\n            justFinishedSelecting,\n          })\n        );\n        return;\n      }\n\n      // Don't seek if clicking on timeline elements, but still deselect\n      if ((e.target as HTMLElement).closest(\".timeline-element\")) {\n        console.log(\n          JSON.stringify({\n            debug_click: \"REJECTED - clicked timeline element\",\n          })\n        );\n        return;\n      }\n\n      // Don't seek if clicking on playhead\n      if (playheadRef.current?.contains(e.target as Node)) {\n        console.log(\n          JSON.stringify({\n            debug_click: \"REJECTED - clicked playhead\",\n          })\n        );\n        return;\n      }\n\n      // Don't seek if clicking on track labels\n      if ((e.target as HTMLElement).closest(\"[data-track-labels]\")) {\n        console.log(\n          JSON.stringify({\n            debug_click: \"REJECTED - clicked track labels\",\n          })\n        );\n        clearSelectedElements();\n        return;\n      }\n\n      // Clear selected elements when clicking empty timeline area\n      console.log(\n        JSON.stringify({\n          debug_click: \"PROCEEDING - clearing elements\",\n          clearingSelectedElements: true,\n        })\n      );\n      clearSelectedElements();\n\n      // Determine if we're clicking in ruler or tracks area\n      const isRulerClick = (e.target as HTMLElement).closest(\n        \"[data-ruler-area]\"\n      );\n\n      console.log(\n        JSON.stringify({\n          debug_click: \"CALCULATING POSITION\",\n          isRulerClick,\n          clientX: e.clientX,\n          clientY: e.clientY,\n          target_element: (e.target as HTMLElement).tagName,\n          target_class: (e.target as HTMLElement).className,\n        })\n      );\n\n      let mouseX: number;\n      let scrollLeft = 0;\n\n      if (isRulerClick) {\n        // Calculate based on ruler position\n        const rulerContent = rulerScrollRef.current;\n        if (!rulerContent) {\n          console.log(\n            JSON.stringify({\n              debug_click: \"ERROR - no ruler container found\",\n            })\n          );\n          return;\n        }\n        const rect = rulerContent.getBoundingClientRect();\n        mouseX = e.clientX - rect.left;\n        scrollLeft = rulerContent.scrollLeft;\n      } else {\n        const tracksContent = tracksScrollRef.current;\n        if (!tracksContent) {\n          return;\n        }\n        const rect = tracksContent.getBoundingClientRect();\n        mouseX = e.clientX - rect.left;\n        scrollLeft = tracksContent.scrollLeft;\n      }\n\n      const rawTime = Math.max(\n        0,\n        Math.min(\n          duration,\n          (mouseX + scrollLeft) /\n            (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel)\n        )\n      );\n\n      // Use frame snapping for timeline clicking\n      const projectFps = activeProject?.fps || 30;\n      const time = snapTimeToFrame(rawTime, projectFps);\n      seek(time);\n    },\n    [\n      duration,\n      zoomLevel,\n      seek,\n      rulerScrollRef,\n      tracksScrollRef,\n      clearSelectedElements,\n      isSelecting,\n      justFinishedSelecting,\n    ]\n  );\n\n  // Update timeline duration when tracks change\n  useEffect(() => {\n    const totalDuration = getTotalDuration();\n    setDuration(Math.max(totalDuration, 10)); // Minimum 10 seconds for empty timeline\n  }, [tracks, setDuration, getTotalDuration]);\n\n  // Old marquee system removed - using new SelectionBox component instead\n\n  const handleDragEnter = (e: React.DragEvent) => {\n    // When something is dragged over the timeline, show overlay\n    e.preventDefault();\n    // Don't show overlay for timeline elements - they're handled by tracks\n    if (e.dataTransfer.types.includes(\"application/x-timeline-element\")) {\n      return;\n    }\n    dragCounterRef.current += 1;\n    if (!isDragOver) {\n      setIsDragOver(true);\n    }\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n\n    // Don't update state for timeline elements - they're handled by tracks\n    if (e.dataTransfer.types.includes(\"application/x-timeline-element\")) {\n      return;\n    }\n\n    dragCounterRef.current -= 1;\n    if (dragCounterRef.current === 0) {\n      setIsDragOver(false);\n    }\n  };\n\n  const handleDrop = async (e: React.DragEvent) => {\n    // When media is dropped, add it as a new track/element\n    e.preventDefault();\n    setIsDragOver(false);\n    dragCounterRef.current = 0;\n\n    // Ignore timeline element drags - they're handled by track-specific handlers\n    const hasTimelineElement = e.dataTransfer.types.includes(\n      \"application/x-timeline-element\"\n    );\n    if (hasTimelineElement) {\n      return;\n    }\n\n    const itemData = e.dataTransfer.getData(\"application/x-media-item\");\n    if (itemData) {\n      try {\n        const dragData: DragData = JSON.parse(itemData);\n\n        if (dragData.type === \"text\") {\n          // Always create new text track to avoid overlaps\n          addElementToNewTrack(dragData);\n        } else {\n          // Handle media items\n          const mediaItem = mediaFiles.find(\n            (item: any) => item.id === dragData.id\n          );\n          if (!mediaItem) {\n            toast.error(\"Media item not found\");\n            return;\n          }\n\n          addElementToNewTrack(mediaItem);\n        }\n      } catch (error) {\n        console.error(\"Error parsing dropped item data:\", error);\n        toast.error(\"Failed to add item to timeline\");\n      }\n    } else if (e.dataTransfer.files?.length > 0) {\n      // Handle file drops by creating new tracks\n      if (!activeProject) {\n        toast.error(\"No active project\");\n        return;\n      }\n\n      try {\n        const processedItems = await processMediaFiles(e.dataTransfer.files);\n        for (const processedItem of processedItems) {\n          await addMediaFile(activeProject.id, processedItem);\n          const currentMediaFiles = mediaFiles;\n          const addedItem = currentMediaFiles.find(\n            (item) =>\n              item.name === processedItem.name && item.url === processedItem.url\n          );\n          if (addedItem) {\n            const trackType: TrackType =\n              addedItem.type === \"audio\" ? \"audio\" : \"media\";\n            const targetTrackId = useTimelineStore\n              .getState()\n              .insertTrackAt(trackType, 0);\n\n            useTimelineStore.getState().addElementToTrack(targetTrackId, {\n              type: \"media\",\n              mediaId: addedItem.id,\n              name: addedItem.name,\n              duration: addedItem.duration || 5,\n              startTime: currentTime,\n              trimStart: 0,\n              trimEnd: 0,\n            });\n          }\n        }\n      } catch (error) {\n        // Show error if file processing fails\n        console.error(\"Error processing external files:\", error);\n        toast.error(\"Failed to process dropped files\");\n      }\n    }\n  };\n\n  const dragProps = {\n    onDragEnter: handleDragEnter,\n    onDragOver: handleDragOver,\n    onDragLeave: handleDragLeave,\n    onDrop: handleDrop,\n  };\n\n  // --- Scroll synchronization effect ---\n  useEffect(() => {\n    const rulerViewport = rulerScrollRef.current;\n    const tracksViewport = tracksScrollRef.current;\n    const trackLabelsViewport = trackLabelsScrollRef.current;\n\n    if (!rulerViewport || !tracksViewport) return;\n\n    // Horizontal scroll synchronization between ruler and tracks\n    const handleRulerScroll = () => {\n      const now = Date.now();\n      if (isUpdatingRef.current || now - lastRulerSync.current < 16) return;\n      lastRulerSync.current = now;\n      isUpdatingRef.current = true;\n      tracksViewport.scrollLeft = rulerViewport.scrollLeft;\n      isUpdatingRef.current = false;\n    };\n    const handleTracksScroll = () => {\n      const now = Date.now();\n      if (isUpdatingRef.current || now - lastTracksSync.current < 16) return;\n      lastTracksSync.current = now;\n      isUpdatingRef.current = true;\n      rulerViewport.scrollLeft = tracksViewport.scrollLeft;\n      isUpdatingRef.current = false;\n    };\n\n    rulerViewport.addEventListener(\"scroll\", handleRulerScroll);\n    tracksViewport.addEventListener(\"scroll\", handleTracksScroll);\n\n    // Vertical scroll synchronization between track labels and tracks content\n    if (trackLabelsViewport) {\n      const handleTrackLabelsScroll = () => {\n        const now = Date.now();\n        if (isUpdatingRef.current || now - lastVerticalSync.current < 16)\n          return;\n        lastVerticalSync.current = now;\n        isUpdatingRef.current = true;\n        tracksViewport.scrollTop = trackLabelsViewport.scrollTop;\n        isUpdatingRef.current = false;\n      };\n      const handleTracksVerticalScroll = () => {\n        const now = Date.now();\n        if (isUpdatingRef.current || now - lastVerticalSync.current < 16)\n          return;\n        lastVerticalSync.current = now;\n        isUpdatingRef.current = true;\n        trackLabelsViewport.scrollTop = tracksViewport.scrollTop;\n        isUpdatingRef.current = false;\n      };\n\n      trackLabelsViewport.addEventListener(\"scroll\", handleTrackLabelsScroll);\n      tracksViewport.addEventListener(\"scroll\", handleTracksVerticalScroll);\n\n      return () => {\n        rulerViewport.removeEventListener(\"scroll\", handleRulerScroll);\n        tracksViewport.removeEventListener(\"scroll\", handleTracksScroll);\n        trackLabelsViewport.removeEventListener(\n          \"scroll\",\n          handleTrackLabelsScroll\n        );\n        tracksViewport.removeEventListener(\n          \"scroll\",\n          handleTracksVerticalScroll\n        );\n      };\n    }\n\n    return () => {\n      rulerViewport.removeEventListener(\"scroll\", handleRulerScroll);\n      tracksViewport.removeEventListener(\"scroll\", handleTracksScroll);\n    };\n  }, []);\n\n  return (\n    <div\n      className={\n        \"h-full flex flex-col transition-colors duration-200 relative bg-panel rounded-sm overflow-hidden\"\n      }\n      {...dragProps}\n      onMouseEnter={() => setIsInTimeline(true)}\n      onMouseLeave={() => setIsInTimeline(false)}\n    >\n      <TimelineToolbar zoomLevel={zoomLevel} setZoomLevel={setZoomLevel} />\n\n      {/* Timeline Container */}\n      <div\n        className=\"flex-1 flex flex-col overflow-hidden relative\"\n        ref={timelineRef}\n      >\n        <TimelinePlayhead\n          currentTime={currentTime}\n          duration={duration}\n          zoomLevel={zoomLevel}\n          tracks={tracks}\n          seek={seek}\n          rulerRef={rulerRef}\n          rulerScrollRef={rulerScrollRef}\n          tracksScrollRef={tracksScrollRef}\n          trackLabelsRef={trackLabelsRef}\n          timelineRef={timelineRef}\n          playheadRef={playheadRef}\n          isSnappingToPlayhead={\n            showSnapIndicator && currentSnapPoint?.type === \"playhead\"\n          }\n        />\n        <SnapIndicator\n          snapPoint={currentSnapPoint}\n          zoomLevel={zoomLevel}\n          tracks={tracks}\n          timelineRef={timelineRef}\n          trackLabelsRef={trackLabelsRef}\n          tracksScrollRef={tracksScrollRef}\n          isVisible={showSnapIndicator}\n        />\n        {/* Timeline Header with Ruler */}\n        <div className=\"flex bg-panel sticky top-0 z-10\">\n          {/* Track Labels Header */}\n          <div className=\"w-28 shrink-0 bg-panel border-r flex items-center justify-between px-3 py-2\">\n            {/* Empty space */}\n            <span className=\"text-sm font-medium text-muted-foreground opacity-0\">\n              .\n            </span>\n          </div>\n\n          {/* Timeline Ruler */}\n          <div\n            className=\"flex-1 relative overflow-hidden h-10\"\n            onWheel={(e) => {\n              // Check if this is horizontal scrolling - if so, don't handle it here\n              if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\n                return; // Let ScrollArea handle horizontal scrolling\n              }\n              handleWheel(e);\n            }}\n            onMouseDown={handleSelectionMouseDown}\n            onClick={handleTimelineContentClick}\n            data-ruler-area\n          >\n            <ScrollArea\n              className=\"w-full\"\n              ref={rulerScrollRef}\n              onScroll={(e) => {\n                if (isUpdatingRef.current) return;\n                isUpdatingRef.current = true;\n                const tracksViewport = tracksScrollRef.current;\n                if (tracksViewport) {\n                  tracksViewport.scrollLeft = (\n                    e.currentTarget as HTMLDivElement\n                  ).scrollLeft;\n                }\n                isUpdatingRef.current = false;\n              }}\n            >\n              <div\n                ref={rulerRef}\n                className=\"relative h-10 select-none cursor-default\"\n                style={{\n                  width: `${dynamicTimelineWidth}px`,\n                }}\n                onMouseDown={handleRulerMouseDown}\n              >\n                <TimelineCacheIndicator\n                  duration={duration}\n                  zoomLevel={zoomLevel}\n                  tracks={tracks}\n                  mediaFiles={mediaFiles}\n                  activeProject={activeProject}\n                  getRenderStatus={getRenderStatus}\n                />\n                {/* Time markers */}\n                {(() => {\n                  // Calculate appropriate time interval based on zoom level\n                  const getTimeInterval = (zoom: number) => {\n                    const pixelsPerSecond =\n                      TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoom;\n                    if (pixelsPerSecond >= 200) return 0.1; // Every 0.1s when very zoomed in\n                    if (pixelsPerSecond >= 100) return 0.5; // Every 0.5s when zoomed in\n                    if (pixelsPerSecond >= 50) return 1; // Every 1s at normal zoom\n                    if (pixelsPerSecond >= 25) return 2; // Every 2s when zoomed out\n                    if (pixelsPerSecond >= 12) return 5; // Every 5s when more zoomed out\n                    if (pixelsPerSecond >= 6) return 10; // Every 10s when very zoomed out\n                    return 30; // Every 30s when extremely zoomed out\n                  };\n\n                  const interval = getTimeInterval(zoomLevel);\n                  const markerCount = Math.ceil(duration / interval) + 1;\n\n                  return Array.from({ length: markerCount }, (_, i) => {\n                    const time = i * interval;\n                    if (time > duration) return null;\n\n                    const isMainMarker =\n                      time % (interval >= 1 ? Math.max(1, interval) : 1) === 0;\n\n                    return (\n                      <TimelineMarker\n                        key={i}\n                        time={time}\n                        zoomLevel={zoomLevel}\n                        interval={interval}\n                        isMainMarker={isMainMarker}\n                      />\n                    );\n                  }).filter(Boolean);\n                })()}\n\n                {/* Bookmark markers */}\n                {(() => {\n                  const { activeProject } = useProjectStore.getState();\n                  if (!activeProject?.bookmarks?.length) return null;\n\n                  return activeProject.bookmarks.map((bookmarkTime, i) => (\n                    <div\n                      key={`bookmark-${i}`}\n                      className=\"absolute top-0 h-10 w-0.5 !bg-primary cursor-pointer\"\n                      style={{\n                        left: `${bookmarkTime * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel}px`,\n                      }}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        usePlaybackStore.getState().seek(bookmarkTime);\n                      }}\n                    >\n                      <div className=\"absolute top-[-1px] left-[-5px] text-primary\">\n                        <Bookmark className=\"h-3 w-3 fill-primary\" />\n                      </div>\n                    </div>\n                  ));\n                })()}\n              </div>\n            </ScrollArea>\n          </div>\n        </div>\n\n        {/* Tracks Area */}\n        <div className=\"flex-1 flex overflow-hidden\">\n          {/* Track Labels */}\n          {tracks.length > 0 && (\n            <div\n              ref={trackLabelsRef}\n              className=\"w-28 shrink-0 border-r overflow-y-auto z-100 bg-panel\"\n              data-track-labels\n            >\n              <ScrollArea className=\"w-full h-full\" ref={trackLabelsScrollRef}>\n                <div className=\"flex flex-col gap-1\">\n                  {tracks.map((track) => (\n                    <div\n                      key={track.id}\n                      className=\"flex items-center px-3 group\"\n                      style={{ height: `${getTrackHeight(track.type)}px` }}\n                    >\n                      <div className=\"flex items-center justify-end flex-1 min-w-0 gap-2\">\n                        {track.muted ? (\n                          <VolumeOff\n                            className=\"h-4 w-4 text-destructive cursor-pointer\"\n                            onClick={() => toggleTrackMute(track.id)}\n                          />\n                        ) : (\n                          <Volume2\n                            className=\"h-4 w-4 text-muted-foreground cursor-pointer\"\n                            onClick={() => toggleTrackMute(track.id)}\n                          />\n                        )}\n                        <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                        <TrackIcon track={track} />\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </ScrollArea>\n            </div>\n          )}\n\n          {/* Timeline Tracks Content */}\n          <div\n            className=\"flex-1 relative overflow-hidden\"\n            onWheel={(e) => {\n              // Check if this is horizontal scrolling - if so, don't handle it here\n              if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\n                return; // Let ScrollArea handle horizontal scrolling\n              }\n              handleWheel(e);\n            }}\n            onMouseDown={(e) => {\n              handleTimelineMouseDown(e);\n              handleSelectionMouseDown(e);\n            }}\n            onClick={handleTimelineContentClick}\n            ref={tracksContainerRef}\n          >\n            <SelectionBox\n              startPos={selectionBox?.startPos || null}\n              currentPos={selectionBox?.currentPos || null}\n              containerRef={tracksContainerRef}\n              isActive={selectionBox?.isActive || false}\n            />\n            <ScrollArea\n              className=\"w-full h-full\"\n              ref={tracksScrollRef}\n              onScroll={(e) => {\n                if (isUpdatingRef.current) return;\n                isUpdatingRef.current = true;\n                const rulerViewport = rulerScrollRef.current;\n                if (rulerViewport) {\n                  rulerViewport.scrollLeft = (\n                    e.currentTarget as HTMLDivElement\n                  ).scrollLeft;\n                }\n                isUpdatingRef.current = false;\n              }}\n            >\n              <div\n                className=\"relative flex-1\"\n                style={{\n                  height: `${Math.max(\n                    200,\n                    Math.min(800, getTotalTracksHeight(tracks))\n                  )}px`,\n                  width: `${dynamicTimelineWidth}px`,\n                }}\n              >\n                {tracks.length === 0 ? (\n                  <div />\n                ) : (\n                  <>\n                    {tracks.map((track, index) => (\n                      <ContextMenu key={track.id}>\n                        <ContextMenuTrigger asChild>\n                          <div\n                            className=\"absolute left-0 right-0\"\n                            style={{\n                              top: `${getCumulativeHeightBefore(\n                                tracks,\n                                index\n                              )}px`,\n                              height: `${getTrackHeight(track.type)}px`,\n                            }}\n                            onClick={(e) => {\n                              // If clicking empty area (not on a element), deselect all elements\n                              if (\n                                !(e.target as HTMLElement).closest(\n                                  \".timeline-element\"\n                                )\n                              ) {\n                                clearSelectedElements();\n                              }\n                            }}\n                          >\n                            <TimelineTrackContent\n                              track={track}\n                              zoomLevel={zoomLevel}\n                              onSnapPointChange={handleSnapPointChange}\n                              rulerScrollRef={rulerScrollRef}\n                              tracksScrollRef={tracksScrollRef}\n                            />\n                          </div>\n                        </ContextMenuTrigger>\n                        <ContextMenuContent className=\"z-200\">\n                          <ContextMenuItem\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              toggleTrackMute(track.id);\n                            }}\n                          >\n                            {track.muted ? \"Unmute Track\" : \"Mute Track\"}\n                          </ContextMenuItem>\n                          <ContextMenuItem onClick={(e) => e.stopPropagation()}>\n                            Track settings (soon)\n                          </ContextMenuItem>\n                        </ContextMenuContent>\n                      </ContextMenu>\n                    ))}\n                  </>\n                )}\n              </div>\n            </ScrollArea>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction TrackIcon({ track }: { track: TimelineTrack }) {\n  return (\n    <>\n      {track.type === \"media\" && (\n        <Video className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\n      )}\n      {track.type === \"text\" && (\n        <TypeIcon className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\n      )}\n      {track.type === \"audio\" && (\n        <Music className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 8716, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/layout-guide-overlay.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport Image from \"next/image\";\r\n\r\nfunction TikTokGuide() {\r\n  return (\r\n    <div className=\"absolute inset-0 pointer-events-none\">\r\n      <Image\r\n        src=\"/platform-guides/tiktok-blueprint.png\"\r\n        alt=\"TikTok layout guide\"\r\n        className=\"absolute inset-0 w-full h-full object-contain\"\r\n        draggable={false}\r\n        fill\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function LayoutGuideOverlay() {\r\n  const { layoutGuide } = useEditorStore();\r\n\r\n  if (layoutGuide.platform === null) return null;\r\n  if (layoutGuide.platform === \"tiktok\") return <TikTokGuide />;\r\n\r\n  return null;\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;;AAKA,SAAS;IACP,qBACE,mTAAC;QAAI,WAAU;kBACb,cAAA,mTAAC,kMAAA,CAAA,UAAK;YACJ,KAAI;YACJ,KAAI;YACJ,WAAU;YACV,WAAW;YACX,IAAI;;;;;;;;;;;AAIZ;AAEO,SAAS;IACd,MAAM,EAAE,WAAW,EAAE,GAAG,CAAA,GAAA,+IAAA,CAAA,iBAAc,AAAD;IAErC,IAAI,YAAY,QAAQ,KAAK,MAAM,OAAO;IAC1C,IAAI,YAAY,QAAQ,KAAK,UAAU,qBAAO,mTAAC;;;;;IAE/C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 8760, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/preview-panel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useTimelineStore } from \"@/stores/timeline-store\";\nimport { TimelineElement, TimelineTrack } from \"@/types/timeline\";\nimport { useMediaStore } from \"@/stores/media-store\";\nimport { MediaFile } from \"@/types/media\";\nimport { usePlaybackStore } from \"@/stores/playback-store\";\nimport { useEditorStore } from \"@/stores/editor-store\";\nimport { Button } from \"@/components/ui/button\";\nimport { Play, Pause, Expand, SkipBack, SkipForward } from \"lucide-react\";\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { renderTimelineFrame } from \"@/lib/timeline-renderer\";\nimport { cn } from \"@/lib/utils\";\nimport { formatTimeCode } from \"@/lib/time\";\nimport { EditableTimecode } from \"@/components/ui/editable-timecode\";\nimport { useFrameCache } from \"@/hooks/use-frame-cache\";\nimport { useSceneStore } from \"@/stores/scene-store\";\nimport {\n  DEFAULT_CANVAS_SIZE,\n  DEFAULT_FPS,\n  useProjectStore,\n} from \"@/stores/project-store\";\nimport { TextElementDragState } from \"@/types/editor\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { LayoutGuideOverlay } from \"./layout-guide-overlay\";\nimport { Label } from \"../ui/label\";\nimport { SocialsIcon } from \"../icons\";\nimport { PLATFORM_LAYOUTS, type PlatformLayout } from \"@/stores/editor-store\";\n\ninterface ActiveElement {\n  element: TimelineElement;\n  track: TimelineTrack;\n  mediaItem: MediaFile | null;\n}\n\nexport function PreviewPanel() {\n  const { tracks, getTotalDuration, updateTextElement } = useTimelineStore();\n  const { mediaFiles } = useMediaStore();\n  const { currentTime, toggle, setCurrentTime } = usePlaybackStore();\n  const { isPlaying, volume, muted } = usePlaybackStore();\n  const { activeProject } = useProjectStore();\n  const { currentScene } = useSceneStore();\n  const previewRef = useRef<HTMLDivElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const { getCachedFrame, cacheFrame, invalidateCache, preRenderNearbyFrames } =\n    useFrameCache();\n  const lastFrameTimeRef = useRef(0);\n  const renderSeqRef = useRef(0);\n  const offscreenCanvasRef = useRef<OffscreenCanvas | HTMLCanvasElement | null>(\n    null\n  );\n\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const audioGainRef = useRef<GainNode | null>(null);\n  const audioBuffersRef = useRef<Map<string, AudioBuffer>>(new Map());\n  const playingSourcesRef = useRef<Set<AudioBufferSourceNode>>(new Set());\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [previewDimensions, setPreviewDimensions] = useState({\n    width: 0,\n    height: 0,\n  });\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const canvasSize = activeProject?.canvasSize || DEFAULT_CANVAS_SIZE;\n  const [dragState, setDragState] = useState<TextElementDragState>({\n    isDragging: false,\n    elementId: null,\n    trackId: null,\n    startX: 0,\n    startY: 0,\n    initialElementX: 0,\n    initialElementY: 0,\n    currentX: 0,\n    currentY: 0,\n    elementWidth: 0,\n    elementHeight: 0,\n  });\n\n  useEffect(() => {\n    const updatePreviewSize = () => {\n      if (!containerRef.current) return;\n\n      let availableWidth, availableHeight;\n\n      if (isExpanded) {\n        const controlsHeight = 80;\n        const marginSpace = 24;\n        availableWidth = window.innerWidth - marginSpace;\n        availableHeight = window.innerHeight - controlsHeight - marginSpace;\n      } else {\n        const container = containerRef.current.getBoundingClientRect();\n        const computedStyle = getComputedStyle(containerRef.current);\n        const paddingTop = parseFloat(computedStyle.paddingTop);\n        const paddingBottom = parseFloat(computedStyle.paddingBottom);\n        const paddingLeft = parseFloat(computedStyle.paddingLeft);\n        const paddingRight = parseFloat(computedStyle.paddingRight);\n        const gap = parseFloat(computedStyle.gap) || 16;\n        const toolbar = containerRef.current.querySelector(\"[data-toolbar]\");\n        const toolbarHeight = toolbar\n          ? toolbar.getBoundingClientRect().height\n          : 0;\n\n        availableWidth = container.width - paddingLeft - paddingRight;\n        availableHeight =\n          container.height -\n          paddingTop -\n          paddingBottom -\n          toolbarHeight -\n          (toolbarHeight > 0 ? gap : 0);\n      }\n\n      const targetRatio = canvasSize.width / canvasSize.height;\n      const containerRatio = availableWidth / availableHeight;\n      let width, height;\n\n      if (containerRatio > targetRatio) {\n        height = availableHeight * (isExpanded ? 0.95 : 1);\n        width = height * targetRatio;\n      } else {\n        width = availableWidth * (isExpanded ? 0.95 : 1);\n        height = width / targetRatio;\n      }\n\n      setPreviewDimensions({ width, height });\n    };\n\n    updatePreviewSize();\n    const resizeObserver = new ResizeObserver(updatePreviewSize);\n    if (containerRef.current) {\n      resizeObserver.observe(containerRef.current);\n    }\n    if (isExpanded) {\n      window.addEventListener(\"resize\", updatePreviewSize);\n    }\n\n    return () => {\n      resizeObserver.disconnect();\n      if (isExpanded) {\n        window.removeEventListener(\"resize\", updatePreviewSize);\n      }\n    };\n  }, [canvasSize.width, canvasSize.height, isExpanded]);\n\n  useEffect(() => {\n    const handleEscapeKey = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\" && isExpanded) {\n        setIsExpanded(false);\n      }\n    };\n\n    if (isExpanded) {\n      document.addEventListener(\"keydown\", handleEscapeKey);\n      document.body.style.overflow = \"hidden\";\n    } else {\n      document.body.style.overflow = \"\";\n    }\n\n    return () => {\n      document.removeEventListener(\"keydown\", handleEscapeKey);\n      document.body.style.overflow = \"\";\n    };\n  }, [isExpanded]);\n\n  useEffect(() => {\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!dragState.isDragging) return;\n\n      const deltaX = e.clientX - dragState.startX;\n      const deltaY = e.clientY - dragState.startY;\n\n      const scaleRatio = previewDimensions.width / canvasSize.width;\n      const newX = dragState.initialElementX + deltaX / scaleRatio;\n      const newY = dragState.initialElementY + deltaY / scaleRatio;\n\n      const halfWidth = dragState.elementWidth / scaleRatio / 2;\n      const halfHeight = dragState.elementHeight / scaleRatio / 2;\n\n      const constrainedX = Math.max(\n        -canvasSize.width / 2 + halfWidth,\n        Math.min(canvasSize.width / 2 - halfWidth, newX)\n      );\n      const constrainedY = Math.max(\n        -canvasSize.height / 2 + halfHeight,\n        Math.min(canvasSize.height / 2 - halfHeight, newY)\n      );\n\n      setDragState((prev) => ({\n        ...prev,\n        currentX: constrainedX,\n        currentY: constrainedY,\n      }));\n    };\n\n    const handleMouseUp = () => {\n      if (dragState.isDragging && dragState.trackId && dragState.elementId) {\n        updateTextElement(dragState.trackId, dragState.elementId, {\n          x: dragState.currentX,\n          y: dragState.currentY,\n        });\n      }\n      setDragState((prev) => ({ ...prev, isDragging: false }));\n    };\n\n    if (dragState.isDragging) {\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n      document.body.style.cursor = \"grabbing\";\n      document.body.style.userSelect = \"none\";\n    }\n\n    return () => {\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n      document.body.style.cursor = \"\";\n      document.body.style.userSelect = \"\";\n    };\n  }, [dragState, previewDimensions, canvasSize, updateTextElement]);\n\n  // Clear the frame cache when background settings change since they affect rendering\n  useEffect(() => {\n    invalidateCache();\n  }, [\n    mediaFiles,\n    activeProject?.backgroundColor,\n    activeProject?.backgroundType,\n    invalidateCache,\n  ]);\n\n  const handleTextMouseDown = (\n    e: React.MouseEvent<HTMLDivElement>,\n    element: any,\n    trackId: string\n  ) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const rect = e.currentTarget.getBoundingClientRect();\n\n    setDragState({\n      isDragging: true,\n      elementId: element.id,\n      trackId,\n      startX: e.clientX,\n      startY: e.clientY,\n      initialElementX: element.x,\n      initialElementY: element.y,\n      currentX: element.x,\n      currentY: element.y,\n      elementWidth: rect.width,\n      elementHeight: rect.height,\n    });\n  };\n\n  const toggleExpanded = useCallback(() => {\n    setIsExpanded((prev) => !prev);\n  }, []);\n\n  const hasAnyElements = tracks.some((track) => track.elements.length > 0);\n  const shouldRenderPreview = hasAnyElements || activeProject?.backgroundType;\n  const getActiveElements = (): ActiveElement[] => {\n    const activeElements: ActiveElement[] = [];\n\n    // Iterate tracks from bottom to top so topmost track renders last (on top)\n    [...tracks].reverse().forEach((track) => {\n      track.elements.forEach((element) => {\n        if (element.hidden) return;\n        const elementStart = element.startTime;\n        const elementEnd =\n          element.startTime +\n          (element.duration - element.trimStart - element.trimEnd);\n\n        if (currentTime >= elementStart && currentTime < elementEnd) {\n          let mediaItem = null;\n          if (element.type === \"media\") {\n            mediaItem =\n              element.mediaId === \"test\"\n                ? null\n                : mediaFiles.find((item) => item.id === element.mediaId) ||\n                  null;\n          }\n          activeElements.push({ element, track, mediaItem });\n        }\n      });\n    });\n\n    return activeElements;\n  };\n\n  const activeElements = getActiveElements();\n\n  // Ensure first frame after mount/seek renders immediately\n  useEffect(() => {\n    const onSeek = () => {\n      lastFrameTimeRef.current = -Infinity;\n      renderSeqRef.current++;\n    };\n    window.addEventListener(\"playback-seek\", onSeek as EventListener);\n    lastFrameTimeRef.current = -Infinity;\n    return () => {\n      window.removeEventListener(\"playback-seek\", onSeek as EventListener);\n    };\n  }, []);\n\n  // Web Audio: schedule only on play/pause/seek/volume/mute changes\n  useEffect(() => {\n    const stopAll = () => {\n      for (const src of playingSourcesRef.current) {\n        try {\n          src.stop();\n        } catch {}\n      }\n      playingSourcesRef.current.clear();\n    };\n\n    type WebAudioWindow = Window & {\n      AudioContext?: typeof AudioContext;\n      webkitAudioContext?: typeof AudioContext;\n    };\n    const ensureAudioGraph = async () => {\n      if (!audioContextRef.current) {\n        const win = window as WebAudioWindow;\n        const Ctx = win.AudioContext ?? win.webkitAudioContext;\n        if (!Ctx) return;\n        audioContextRef.current = new Ctx();\n      }\n      if (!audioGainRef.current) {\n        audioGainRef.current = audioContextRef.current!.createGain();\n        audioGainRef.current.connect(audioContextRef.current!.destination);\n      }\n      if (audioContextRef.current!.state === \"suspended\") {\n        try {\n          await audioContextRef.current!.resume();\n        } catch {}\n      }\n      const gainValue = muted ? 0 : Math.max(0, Math.min(1, volume));\n      audioGainRef.current!.gain.setValueAtTime(\n        gainValue,\n        audioContextRef.current!.currentTime\n      );\n    };\n\n    const scheduleNow = async () => {\n      await ensureAudioGraph();\n      const audioCtx = audioContextRef.current!;\n      const gain = audioGainRef.current!;\n\n      const tracksSnapshot = useTimelineStore.getState().tracks;\n      const mediaList = mediaFiles;\n      const idToMedia = new Map(mediaList.map((m) => [m.id, m] as const));\n      const playbackNow = usePlaybackStore.getState().currentTime;\n\n      const audible: Array<{\n        id: string;\n        elementStart: number;\n        trimStart: number;\n        trimEnd: number;\n        duration: number;\n        muted: boolean;\n        trackMuted: boolean;\n      }> = [];\n      const uniqueIds = new Set<string>();\n      for (const track of tracksSnapshot) {\n        for (const element of track.elements) {\n          if (element.type !== \"media\") continue;\n          const media = idToMedia.get(element.mediaId);\n          if (!media || media.type !== \"audio\") continue;\n          const visibleDuration =\n            element.duration - element.trimStart - element.trimEnd;\n          if (visibleDuration <= 0) continue;\n          const localTime = playbackNow - element.startTime + element.trimStart;\n          if (localTime < 0 || localTime >= visibleDuration) continue;\n          audible.push({\n            id: media.id,\n            elementStart: element.startTime,\n            trimStart: element.trimStart,\n            trimEnd: element.trimEnd,\n            duration: element.duration,\n            muted: !!element.muted,\n            trackMuted: !!track.muted,\n          });\n          uniqueIds.add(media.id);\n        }\n      }\n\n      if (audible.length === 0) return;\n\n      // Decode buffers as needed\n      const decodePromises: Array<Promise<void>> = [];\n      for (const id of uniqueIds) {\n        if (!audioBuffersRef.current.has(id)) {\n          const mediaItem = idToMedia.get(id);\n          if (!mediaItem) continue;\n          const p = (async () => {\n            const arr = await mediaItem.file.arrayBuffer();\n            const buf = await audioCtx.decodeAudioData(arr.slice(0));\n            audioBuffersRef.current.set(id, buf);\n          })();\n          decodePromises.push(p);\n        }\n      }\n      await Promise.all(decodePromises);\n\n      const startAt = audioCtx.currentTime + 0.02;\n      for (const entry of audible) {\n        if (entry.muted || entry.trackMuted) continue;\n        const buffer = audioBuffersRef.current.get(entry.id);\n        if (!buffer) continue;\n        const visibleDuration =\n          entry.duration - entry.trimStart - entry.trimEnd;\n        const localTime = Math.max(\n          0,\n          playbackNow - entry.elementStart + entry.trimStart\n        );\n        const playDuration = Math.max(0, visibleDuration - localTime);\n        if (playDuration <= 0) continue;\n        const src = audioCtx.createBufferSource();\n        src.buffer = buffer;\n        src.connect(gain);\n        try {\n          src.start(startAt, localTime, playDuration);\n          playingSourcesRef.current.add(src);\n        } catch {}\n      }\n    };\n\n    const onSeek = () => {\n      if (!isPlaying) return;\n      for (const src of playingSourcesRef.current) {\n        try {\n          src.stop();\n        } catch {}\n      }\n      playingSourcesRef.current.clear();\n      void scheduleNow();\n    };\n\n    // Apply volume/mute changes immediately\n    void ensureAudioGraph();\n\n    // Start/stop on play state changes\n    for (const src of playingSourcesRef.current) {\n      try {\n        src.stop();\n      } catch {}\n    }\n    playingSourcesRef.current.clear();\n    if (isPlaying) {\n      void scheduleNow();\n    }\n\n    window.addEventListener(\"playback-seek\", onSeek as EventListener);\n    return () => {\n      window.removeEventListener(\"playback-seek\", onSeek as EventListener);\n      for (const src of playingSourcesRef.current) {\n        try {\n          src.stop();\n        } catch {}\n      }\n      playingSourcesRef.current.clear();\n    };\n  }, [isPlaying, volume, muted, mediaFiles]);\n\n  // Canvas: draw current frame with caching\n  useEffect(() => {\n    const draw = async () => {\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n      const mainCtx = canvas.getContext(\"2d\");\n      if (!mainCtx) return;\n\n      // Set canvas internal resolution to avoid blurry scaling\n      const displayWidth = Math.max(1, Math.floor(previewDimensions.width));\n      const displayHeight = Math.max(1, Math.floor(previewDimensions.height));\n      if (canvas.width !== displayWidth || canvas.height !== displayHeight) {\n        canvas.width = displayWidth;\n        canvas.height = displayHeight;\n      }\n\n      // Throttle rendering to project FPS during playback only\n      const fps = activeProject?.fps || DEFAULT_FPS;\n      const minDelta = 1 / fps;\n      if (isPlaying) {\n        if (currentTime - lastFrameTimeRef.current < minDelta) {\n          return;\n        }\n        lastFrameTimeRef.current = currentTime;\n      }\n\n      const cachedFrame = getCachedFrame(\n        currentTime,\n        tracks,\n        mediaFiles,\n        activeProject,\n        currentScene?.id\n      );\n      if (cachedFrame) {\n        mainCtx.putImageData(cachedFrame, 0, 0);\n\n        // Pre-render nearby frames in background\n        if (!isPlaying) {\n          // Only during scrubbing to avoid interfering with playback\n          preRenderNearbyFrames(\n            currentTime,\n            tracks,\n            mediaFiles,\n            activeProject,\n            async (time: number) => {\n              const tempCanvas = document.createElement(\"canvas\");\n              tempCanvas.width = displayWidth;\n              tempCanvas.height = displayHeight;\n              const tempCtx = tempCanvas.getContext(\"2d\");\n              if (!tempCtx)\n                throw new Error(\"Failed to create temp canvas context\");\n\n              await renderTimelineFrame({\n                ctx: tempCtx,\n                time,\n                canvasWidth: displayWidth,\n                canvasHeight: displayHeight,\n                tracks,\n                mediaFiles,\n                backgroundType: activeProject?.backgroundType,\n                blurIntensity: activeProject?.blurIntensity,\n                backgroundColor:\n                  activeProject?.backgroundType === \"blur\"\n                    ? undefined\n                    : activeProject?.backgroundColor || \"#000000\",\n                projectCanvasSize: canvasSize,\n              });\n\n              return tempCtx.getImageData(0, 0, displayWidth, displayHeight);\n            },\n            currentScene?.id,\n            3\n          );\n        } else {\n          // Small lookahead while playing\n          preRenderNearbyFrames(\n            currentTime,\n            tracks,\n            mediaFiles,\n            activeProject,\n            async (time: number) => {\n              const tempCanvas = document.createElement(\"canvas\");\n              tempCanvas.width = displayWidth;\n              tempCanvas.height = displayHeight;\n              const tempCtx = tempCanvas.getContext(\"2d\");\n              if (!tempCtx)\n                throw new Error(\"Failed to create temp canvas context\");\n\n              await renderTimelineFrame({\n                ctx: tempCtx,\n                time,\n                canvasWidth: displayWidth,\n                canvasHeight: displayHeight,\n                tracks,\n                mediaFiles,\n                backgroundType: activeProject?.backgroundType,\n                blurIntensity: activeProject?.blurIntensity,\n                backgroundColor:\n                  activeProject?.backgroundType === \"blur\"\n                    ? undefined\n                    : activeProject?.backgroundColor || \"#000000\",\n                projectCanvasSize: canvasSize,\n              });\n\n              return tempCtx.getImageData(0, 0, displayWidth, displayHeight);\n            },\n            currentScene?.id,\n            1\n          );\n        }\n        return;\n      }\n\n      // Cache miss - render from scratch\n      if (!offscreenCanvasRef.current) {\n        const hasOffscreen =\n          typeof (globalThis as unknown as { OffscreenCanvas?: unknown })\n            .OffscreenCanvas !== \"undefined\";\n        if (hasOffscreen) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          offscreenCanvasRef.current = new (globalThis as any).OffscreenCanvas(\n            displayWidth,\n            displayHeight\n          ) as OffscreenCanvas;\n        } else {\n          const c = document.createElement(\"canvas\");\n          c.width = displayWidth;\n          c.height = displayHeight;\n          offscreenCanvasRef.current = c;\n        }\n      }\n      // Ensure size matches\n      if (\n        offscreenCanvasRef.current &&\n        (offscreenCanvasRef.current as HTMLCanvasElement).getContext\n      ) {\n        const c = offscreenCanvasRef.current as HTMLCanvasElement;\n        if (c.width !== displayWidth || c.height !== displayHeight) {\n          c.width = displayWidth;\n          c.height = displayHeight;\n        }\n      } else {\n        const c = offscreenCanvasRef.current as OffscreenCanvas;\n        // @ts-ignore width/height exist on OffscreenCanvas in modern browsers\n        if (\n          (c as unknown as { width: number }).width !== displayWidth ||\n          (c as unknown as { height: number }).height !== displayHeight\n        ) {\n          // @ts-ignore\n          (c as unknown as { width: number }).width = displayWidth;\n          // @ts-ignore\n          (c as unknown as { height: number }).height = displayHeight;\n        }\n      }\n      const offscreenCanvas = offscreenCanvasRef.current as\n        | HTMLCanvasElement\n        | OffscreenCanvas;\n      const offCtx = (offscreenCanvas as HTMLCanvasElement).getContext\n        ? (offscreenCanvas as HTMLCanvasElement).getContext(\"2d\")\n        : (offscreenCanvas as OffscreenCanvas).getContext(\"2d\");\n      if (!offCtx) return;\n\n      await renderTimelineFrame({\n        ctx: offCtx as CanvasRenderingContext2D,\n        time: currentTime,\n        canvasWidth: displayWidth,\n        canvasHeight: displayHeight,\n        tracks,\n        mediaFiles,\n        backgroundType: activeProject?.backgroundType,\n        blurIntensity: activeProject?.blurIntensity,\n        backgroundColor:\n          activeProject?.backgroundType === \"blur\"\n            ? undefined\n            : activeProject?.backgroundColor || \"#000000\",\n        projectCanvasSize: canvasSize,\n      });\n\n      const imageData = (offCtx as CanvasRenderingContext2D).getImageData(\n        0,\n        0,\n        displayWidth,\n        displayHeight\n      );\n      cacheFrame(\n        currentTime,\n        imageData,\n        tracks,\n        mediaFiles,\n        activeProject,\n        currentScene?.id\n      );\n\n      // Blit offscreen to visible canvas\n      mainCtx.clearRect(0, 0, displayWidth, displayHeight);\n      if ((offscreenCanvas as HTMLCanvasElement).getContext) {\n        mainCtx.drawImage(offscreenCanvas as HTMLCanvasElement, 0, 0);\n      } else {\n        mainCtx.drawImage(\n          offscreenCanvas as unknown as CanvasImageSource,\n          0,\n          0\n        );\n      }\n    };\n\n    void draw();\n  }, [\n    activeElements,\n    currentTime,\n    previewDimensions.width,\n    previewDimensions.height,\n    canvasSize.width,\n    canvasSize.height,\n    activeProject?.backgroundType,\n    activeProject?.backgroundColor,\n    getCachedFrame,\n    cacheFrame,\n    preRenderNearbyFrames,\n    isPlaying,\n  ]);\n\n  // Get media elements for blur background (video/image only)\n  const getBlurBackgroundElements = (): ActiveElement[] => {\n    return activeElements.filter(\n      ({ element, mediaItem }) =>\n        element.type === \"media\" &&\n        mediaItem &&\n        (mediaItem.type === \"video\" || mediaItem.type === \"image\") &&\n        element.mediaId !== \"test\" // Exclude test elements\n    );\n  };\n\n  const blurBackgroundElements = getBlurBackgroundElements();\n\n  // Render blur background layer (handled by canvas now)\n  const renderBlurBackground = () => null;\n\n  // Render an element (canvas handles visuals now). Audio playback to be implemented via Web Audio.\n  const renderElement = (_elementData: ActiveElement) => null;\n\n  return (\n    <>\n      <div className=\"h-full w-full flex flex-col min-h-0 min-w-0 bg-panel rounded-sm relative\">\n        <div\n          ref={containerRef}\n          className=\"flex-1 flex flex-col items-center justify-center min-h-0 min-w-0\"\n        >\n          <div className=\"flex-1\" />\n          {shouldRenderPreview ? (\n            <div\n              ref={previewRef}\n              className=\"relative overflow-hidden border\"\n              style={{\n                width: previewDimensions.width,\n                height: previewDimensions.height,\n                background:\n                  activeProject?.backgroundType === \"blur\"\n                    ? \"transparent\"\n                    : activeProject?.backgroundColor || \"#000000\",\n              }}\n            >\n              {renderBlurBackground()}\n              <canvas\n                ref={canvasRef}\n                style={{\n                  position: \"absolute\",\n                  left: 0,\n                  top: 0,\n                  width: previewDimensions.width,\n                  height: previewDimensions.height,\n                }}\n                aria-label=\"Video preview canvas\"\n              />\n              {activeElements.length === 0 ? (\n                <></>\n              ) : (\n                activeElements.map((elementData) => renderElement(elementData))\n              )}\n              <LayoutGuideOverlay />\n            </div>\n          ) : null}\n\n          <div className=\"flex-1\" />\n\n          <PreviewToolbar\n            hasAnyElements={hasAnyElements}\n            onToggleExpanded={toggleExpanded}\n            isExpanded={isExpanded}\n            currentTime={currentTime}\n            setCurrentTime={setCurrentTime}\n            toggle={toggle}\n            getTotalDuration={getTotalDuration}\n          />\n        </div>\n      </div>\n\n      {isExpanded && (\n        <FullscreenPreview\n          previewDimensions={previewDimensions}\n          activeProject={activeProject}\n          renderBlurBackground={renderBlurBackground}\n          activeElements={activeElements}\n          renderElement={renderElement}\n          blurBackgroundElements={blurBackgroundElements}\n          hasAnyElements={hasAnyElements}\n          toggleExpanded={toggleExpanded}\n          currentTime={currentTime}\n          setCurrentTime={setCurrentTime}\n          toggle={toggle}\n          getTotalDuration={getTotalDuration}\n        />\n      )}\n    </>\n  );\n}\n\nfunction FullscreenToolbar({\n  hasAnyElements,\n  onToggleExpanded,\n  currentTime,\n  setCurrentTime,\n  toggle,\n  getTotalDuration,\n}: {\n  hasAnyElements: boolean;\n  onToggleExpanded: () => void;\n  currentTime: number;\n  setCurrentTime: (time: number) => void;\n  toggle: () => void;\n  getTotalDuration: () => number;\n}) {\n  const { isPlaying, seek } = usePlaybackStore();\n  const { activeProject } = useProjectStore();\n  const [isDragging, setIsDragging] = useState(false);\n\n  const totalDuration = getTotalDuration();\n  const progress = totalDuration > 0 ? (currentTime / totalDuration) * 100 : 0;\n\n  const handleTimelineClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (!hasAnyElements) return;\n    const rect = e.currentTarget.getBoundingClientRect();\n    const clickX = e.clientX - rect.left;\n    const percentage = Math.max(0, Math.min(1, clickX / rect.width));\n    const newTime = percentage * totalDuration;\n    setCurrentTime(Math.max(0, Math.min(newTime, totalDuration)));\n  };\n\n  const handleTimelineDrag = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (!hasAnyElements) return;\n    e.preventDefault();\n    e.stopPropagation();\n    const rect = e.currentTarget.getBoundingClientRect();\n    setIsDragging(true);\n\n    const handleMouseMove = (moveEvent: MouseEvent) => {\n      moveEvent.preventDefault();\n      const dragX = moveEvent.clientX - rect.left;\n      const percentage = Math.max(0, Math.min(1, dragX / rect.width));\n      const newTime = percentage * totalDuration;\n      setCurrentTime(Math.max(0, Math.min(newTime, totalDuration)));\n    };\n\n    const handleMouseUp = () => {\n      setIsDragging(false);\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n      document.body.style.userSelect = \"\";\n    };\n\n    document.body.style.userSelect = \"none\";\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    document.addEventListener(\"mouseup\", handleMouseUp);\n    handleMouseMove(e.nativeEvent);\n  };\n\n  const skipBackward = () => {\n    const newTime = Math.max(0, currentTime - 1);\n    setCurrentTime(newTime);\n  };\n\n  const skipForward = () => {\n    const newTime = Math.min(totalDuration, currentTime + 1);\n    setCurrentTime(newTime);\n  };\n\n  return (\n    <div\n      data-toolbar\n      className=\"flex items-center gap-2 p-1 pt-2 w-full text-foreground relative\"\n    >\n      <div className=\"flex items-center gap-1 text-[0.70rem] tabular-nums text-foreground/90\">\n        <EditableTimecode\n          time={currentTime}\n          duration={totalDuration}\n          format=\"HH:MM:SS:FF\"\n          fps={activeProject?.fps || DEFAULT_FPS}\n          onTimeChange={seek}\n          disabled={!hasAnyElements}\n          className=\"text-foreground/90 hover:bg-white/10\"\n        />\n        <span className=\"opacity-50\">/</span>\n        <span>\n          {formatTimeCode(\n            totalDuration,\n            \"HH:MM:SS:FF\",\n            activeProject?.fps || DEFAULT_FPS\n          )}\n        </span>\n      </div>\n\n      <div className=\"flex items-center gap-1\">\n        <Button\n          variant=\"text\"\n          size=\"icon\"\n          onClick={skipBackward}\n          disabled={!hasAnyElements}\n          className=\"h-auto p-0 text-foreground\"\n          title=\"Skip backward 1s\"\n        >\n          <SkipBack className=\"h-3 w-3\" />\n        </Button>\n        <Button\n          variant=\"text\"\n          size=\"icon\"\n          onClick={toggle}\n          disabled={!hasAnyElements}\n          className=\"h-auto p-0 text-foreground hover:text-foreground/80\"\n        >\n          {isPlaying ? (\n            <Pause className=\"h-3 w-3\" />\n          ) : (\n            <Play className=\"h-3 w-3\" />\n          )}\n        </Button>\n        <Button\n          variant=\"text\"\n          size=\"icon\"\n          onClick={skipForward}\n          disabled={!hasAnyElements}\n          className=\"h-auto p-0 text-foreground hover:text-foreground/80\"\n          title=\"Skip forward 1s\"\n        >\n          <SkipForward className=\"h-3 w-3\" />\n        </Button>\n      </div>\n\n      <div className=\"flex-1 flex items-center gap-2\">\n        <div\n          className={cn(\n            \"relative h-1 rounded-full cursor-pointer flex-1 bg-foreground/20\",\n            !hasAnyElements && \"opacity-50 cursor-not-allowed\"\n          )}\n          onClick={hasAnyElements ? handleTimelineClick : undefined}\n          onMouseDown={hasAnyElements ? handleTimelineDrag : undefined}\n          style={{ userSelect: \"none\" }}\n        >\n          <div\n            className={cn(\n              \"absolute top-0 left-0 h-full rounded-full bg-foreground\",\n              !isDragging && \"duration-100\"\n            )}\n            style={{ width: `${progress}%` }}\n          />\n          <div\n            className=\"absolute top-1/2 w-3 h-3 rounded-full -translate-y-1/2 -translate-x-1/2 shadow-xs bg-foreground border border-black/20\"\n            style={{ left: `${progress}%` }}\n          />\n        </div>\n      </div>\n\n      <Button\n        variant=\"text\"\n        size=\"icon\"\n        className=\"size-4! text-foreground/80 hover:text-foreground\"\n        onClick={onToggleExpanded}\n        title=\"Exit fullscreen (Esc)\"\n      >\n        <Expand className=\"size-4!\" />\n      </Button>\n    </div>\n  );\n}\n\nfunction FullscreenPreview({\n  previewDimensions,\n  activeProject,\n  renderBlurBackground,\n  activeElements,\n  renderElement,\n  blurBackgroundElements,\n  hasAnyElements,\n  toggleExpanded,\n  currentTime,\n  setCurrentTime,\n  toggle,\n  getTotalDuration,\n}: {\n  previewDimensions: { width: number; height: number };\n  activeProject: any;\n  renderBlurBackground: () => React.ReactNode;\n  activeElements: ActiveElement[];\n  renderElement: (elementData: ActiveElement, index: number) => React.ReactNode;\n  blurBackgroundElements: ActiveElement[];\n  hasAnyElements: boolean;\n  toggleExpanded: () => void;\n  currentTime: number;\n  setCurrentTime: (time: number) => void;\n  toggle: () => void;\n  getTotalDuration: () => number;\n}) {\n  return (\n    <div className=\"fixed inset-0 z-9999 flex flex-col\">\n      <div className=\"flex-1 flex items-center justify-center bg-background\">\n        <div\n          className=\"relative overflow-hidden border border-border m-3\"\n          style={{\n            width: previewDimensions.width,\n            height: previewDimensions.height,\n            background:\n              activeProject?.backgroundType === \"blur\"\n                ? \"#1a1a1a\"\n                : activeProject?.backgroundColor || \"#1a1a1a\",\n          }}\n        >\n          {renderBlurBackground()}\n          {activeElements.length === 0 ? (\n            <div className=\"absolute inset-0 flex items-center justify-center text-white/60\">\n              No elements at current time\n            </div>\n          ) : (\n            activeElements.map((elementData, index) =>\n              renderElement(elementData, index)\n            )\n          )}\n          <LayoutGuideOverlay />\n        </div>\n      </div>\n      <div className=\"p-4 bg-background\">\n        <FullscreenToolbar\n          hasAnyElements={hasAnyElements}\n          onToggleExpanded={toggleExpanded}\n          currentTime={currentTime}\n          setCurrentTime={setCurrentTime}\n          toggle={toggle}\n          getTotalDuration={getTotalDuration}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction PreviewToolbar({\n  hasAnyElements,\n  onToggleExpanded,\n  isExpanded,\n  currentTime,\n  setCurrentTime,\n  toggle,\n  getTotalDuration,\n}: {\n  hasAnyElements: boolean;\n  onToggleExpanded: () => void;\n  isExpanded: boolean;\n  currentTime: number;\n  setCurrentTime: (time: number) => void;\n  toggle: () => void;\n  getTotalDuration: () => number;\n}) {\n  const { isPlaying } = usePlaybackStore();\n  const { layoutGuide, toggleLayoutGuide } = useEditorStore();\n\n  if (isExpanded) {\n    return (\n      <FullscreenToolbar\n        {...{\n          hasAnyElements,\n          onToggleExpanded,\n          currentTime,\n          setCurrentTime,\n          toggle,\n          getTotalDuration,\n        }}\n      />\n    );\n  }\n\n  return (\n    <div\n      data-toolbar\n      className=\"flex justify-end gap-2 h-auto pb-5 pr-5 pt-4 w-full\"\n    >\n      <div className=\"flex items-center gap-2\">\n        <Button\n          variant=\"text\"\n          size=\"icon\"\n          onClick={toggle}\n          disabled={!hasAnyElements}\n          className=\"h-auto p-0\"\n        >\n          {isPlaying ? (\n            <Pause className=\"h-3 w-3\" />\n          ) : (\n            <Play className=\"h-3 w-3\" />\n          )}\n        </Button>\n        <Popover>\n          <PopoverTrigger asChild>\n            <Button\n              variant=\"text\"\n              size=\"icon\"\n              className=\"h-auto p-0 mr-1\"\n              title=\"Toggle layout guide\"\n            >\n              <SocialsIcon className=\"!size-6\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-80\">\n            <div className=\"grid gap-4\">\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium leading-none\">Layout guide</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Show platform-specific layout guides to help align your\n                  content with interface elements like profile pictures,\n                  usernames, and interaction buttons.\n                </p>\n              </div>\n              <div className=\"grid gap-2\">\n                <div className=\"flex items-center space-x-2\">\n                  <Checkbox\n                    id=\"none\"\n                    checked={layoutGuide.platform === null}\n                    onCheckedChange={() =>\n                      toggleLayoutGuide(layoutGuide.platform || \"tiktok\")\n                    }\n                  />\n                  <Label htmlFor=\"none\">None</Label>\n                </div>\n                {Object.entries(PLATFORM_LAYOUTS).map(([platform, label]) => (\n                  <div key={platform} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id={platform}\n                      checked={layoutGuide.platform === platform}\n                      onCheckedChange={() =>\n                        toggleLayoutGuide(platform as PlatformLayout)\n                      }\n                    />\n                    <Label htmlFor={platform}>{label}</Label>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </PopoverContent>\n        </Popover>\n        <Button\n          variant=\"text\"\n          size=\"icon\"\n          className=\"size-4!\"\n          onClick={onToggleExpanded}\n          title=\"Enter fullscreen\"\n        >\n          <Expand className=\"size-4!\" />\n        </Button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 9936, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/panel-preset-selector.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Button } from \"../ui/button\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"../ui/dropdown-menu\";\r\nimport { ChevronDown, RotateCcw, LayoutPanelTop } from \"lucide-react\";\r\nimport { usePanelStore, type PanelPreset } from \"@/stores/panel-store\";\r\n\r\nconst PRESET_LABELS: Record<PanelPreset, string> = {\r\n  default: \"Default\",\r\n  media: \"Media\",\r\n  inspector: \"Inspector\",\r\n  \"vertical-preview\": \"Vertical Preview\",\r\n};\r\n\r\nconst PRESET_DESCRIPTIONS: Record<PanelPreset, string> = {\r\n  default: \"Media, preview, and inspector on top row, timeline on bottom\",\r\n  media: \"Full height media on left, preview and inspector on top row\",\r\n  inspector: \"Full height inspector on right, media and preview on top row\",\r\n  \"vertical-preview\": \"Full height preview on right for vertical videos\",\r\n};\r\n\r\nexport function PanelPresetSelector() {\r\n  const { activePreset, setActivePreset, resetPreset } = usePanelStore();\r\n\r\n  const handlePresetChange = (preset: PanelPreset) => {\r\n    setActivePreset(preset);\r\n  };\r\n\r\n  const handleResetPreset = (preset: PanelPreset, event: React.MouseEvent) => {\r\n    event.stopPropagation();\r\n    resetPreset(preset);\r\n  };\r\n\r\n  return (\r\n    <DropdownMenu>\r\n      <DropdownMenuTrigger asChild>\r\n        <Button\r\n          variant=\"secondary\"\r\n          size=\"sm\"\r\n          className=\"h-8 px-2 flex items-center gap-1 text-xs\"\r\n          title=\"Panel Presets\"\r\n        >\r\n          <LayoutPanelTop className=\"h-4 w-4\" />\r\n          <ChevronDown className=\"h-3 w-3\" />\r\n        </Button>\r\n      </DropdownMenuTrigger>\r\n      <DropdownMenuContent align=\"start\" className=\"w-64\">\r\n        <div className=\"px-3 py-2 text-xs font-medium text-muted-foreground\">\r\n          Panel Presets\r\n        </div>\r\n        <DropdownMenuSeparator />\r\n        {(Object.keys(PRESET_LABELS) as PanelPreset[]).map((preset) => (\r\n          <DropdownMenuItem\r\n            key={preset}\r\n            onClick={() => handlePresetChange(preset)}\r\n            className=\"flex items-start justify-between gap-2 py-2 px-3 cursor-pointer\"\r\n          >\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"font-medium text-sm\">\r\n                  {PRESET_LABELS[preset]}\r\n                </span>\r\n                {activePreset === preset && (\r\n                  <div className=\"h-2 w-2 rounded-full bg-primary\" />\r\n                )}\r\n              </div>\r\n              <p className=\"text-xs text-muted-foreground mt-0.5 leading-tight\">\r\n                {PRESET_DESCRIPTIONS[preset]}\r\n              </p>\r\n            </div>\r\n            <Button\r\n              variant=\"secondary\"\r\n              size=\"icon\"\r\n              className=\"h-6 w-6 shrink-0 opacity-60 hover:opacity-100\"\r\n              onClick={(e) => handleResetPreset(preset, e)}\r\n              title={`Reset ${PRESET_LABELS[preset]} preset`}\r\n            >\r\n              <RotateCcw className=\"h-3 w-3\" />\r\n            </Button>\r\n          </DropdownMenuItem>\r\n        ))}\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAOA;AAAA;AAAA;AACA;AAXA;;;;;;AAaA,MAAM,gBAA6C;IACjD,SAAS;IACT,OAAO;IACP,WAAW;IACX,oBAAoB;AACtB;AAEA,MAAM,sBAAmD;IACvD,SAAS;IACT,OAAO;IACP,WAAW;IACX,oBAAoB;AACtB;AAEO,SAAS;IACd,MAAM,EAAE,YAAY,EAAE,eAAe,EAAE,WAAW,EAAE,GAAG,CAAA,GAAA,8IAAA,CAAA,gBAAa,AAAD;IAEnE,MAAM,qBAAqB,CAAC;QAC1B,gBAAgB;IAClB;IAEA,MAAM,oBAAoB,CAAC,QAAqB;QAC9C,MAAM,eAAe;QACrB,YAAY;IACd;IAEA,qBACE,mTAAC,2JAAA,CAAA,eAAY;;0BACX,mTAAC,2JAAA,CAAA,sBAAmB;gBAAC,OAAO;0BAC1B,cAAA,mTAAC,iJAAA,CAAA,SAAM;oBACL,SAAQ;oBACR,MAAK;oBACL,WAAU;oBACV,OAAM;;sCAEN,mTAAC,+SAAA,CAAA,iBAAc;4BAAC,WAAU;;;;;;sCAC1B,mTAAC,qSAAA,CAAA,cAAW;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAG3B,mTAAC,2JAAA,CAAA,sBAAmB;gBAAC,OAAM;gBAAQ,WAAU;;kCAC3C,mTAAC;wBAAI,WAAU;kCAAsD;;;;;;kCAGrE,mTAAC,2JAAA,CAAA,wBAAqB;;;;;oBACpB,OAAO,IAAI,CAAC,eAAiC,GAAG,CAAC,CAAC,uBAClD,mTAAC,2JAAA,CAAA,mBAAgB;4BAEf,SAAS,IAAM,mBAAmB;4BAClC,WAAU;;8CAEV,mTAAC;oCAAI,WAAU;;sDACb,mTAAC;4CAAI,WAAU;;8DACb,mTAAC;oDAAK,WAAU;8DACb,aAAa,CAAC,OAAO;;;;;;gDAEvB,iBAAiB,wBAChB,mTAAC;oDAAI,WAAU;;;;;;;;;;;;sDAGnB,mTAAC;4CAAE,WAAU;sDACV,mBAAmB,CAAC,OAAO;;;;;;;;;;;;8CAGhC,mTAAC,iJAAA,CAAA,SAAM;oCACL,SAAQ;oCACR,MAAK;oCACL,WAAU;oCACV,SAAS,CAAC,IAAM,kBAAkB,QAAQ;oCAC1C,OAAO,CAAC,MAAM,EAAE,aAAa,CAAC,OAAO,CAAC,OAAO,CAAC;8CAE9C,cAAA,mTAAC,iSAAA,CAAA,YAAS;wCAAC,WAAU;;;;;;;;;;;;2BAxBlB;;;;;;;;;;;;;;;;;AA+BjB","debugId":null}},
    {"offset": {"line": 10111, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/export-button.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { TransitionUpIcon } from \"../icons\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"../ui/popover\";\nimport { Button } from \"../ui/button\";\nimport { Label } from \"../ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"../ui/radio-group\";\nimport { Progress } from \"../ui/progress\";\nimport { Checkbox } from \"../ui/checkbox\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  exportProject,\n  getExportMimeType,\n  getExportFileExtension,\n  DEFAULT_EXPORT_OPTIONS,\n} from \"@/lib/export\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport { Check, Copy, Download, RotateCcw, X } from \"lucide-react\";\nimport { ExportFormat, ExportQuality, ExportResult } from \"@/types/export\";\nimport { PropertyGroup } from \"./properties-panel/property-item\";\n\nexport function ExportButton() {\n  const [isExportPopoverOpen, setIsExportPopoverOpen] = useState(false);\n  const { activeProject } = useProjectStore();\n\n  const handleVideoExport = () => {\n    setIsExportPopoverOpen(true);\n  };\n\n  const hasProject = !!activeProject;\n\n  return (\n    <Popover open={isExportPopoverOpen} onOpenChange={setIsExportPopoverOpen}>\n      <PopoverTrigger asChild>\n        <button\n          type=\"button\"\n          className={cn(\n            \"flex items-center gap-1.5 bg-[#38BDF8] text-white rounded-md px-[0.12rem] py-[0.12rem] transition-all duration-200\",\n            hasProject\n              ? \"cursor-pointer hover:brightness-95\"\n              : \"cursor-not-allowed opacity-50\"\n          )}\n          onClick={hasProject ? handleVideoExport : undefined}\n          disabled={!hasProject}\n          onKeyDown={(event) => {\n            if (hasProject && (event.key === \"Enter\" || event.key === \" \")) {\n              event.preventDefault();\n              handleVideoExport();\n            }\n          }}\n        >\n          <div className=\"flex items-center gap-1.5 bg-linear-270 from-[#2567EC] to-[#37B6F7] rounded-[0.8rem] px-4 py-1 relative shadow-[0_1px_3px_0px_rgba(0,0,0,0.65)]\">\n            <TransitionUpIcon className=\"z-50\" />\n            <span className=\"text-[0.875rem] z-50\">Export Video</span>\n            <div className=\"absolute w-full h-full left-0 top-0 bg-linear-to-t from-white/0 to-white/50 z-10 rounded-[0.8rem] flex items-center justify-center\">\n              <div className=\"absolute w-[calc(100%-2px)] h-[calc(100%-2px)] top-[0.08rem] bg-linear-270 from-[#2567EC] to-[#37B6F7] z-50 rounded-[0.8rem]\"></div>\n            </div>\n          </div>\n        </button>\n      </PopoverTrigger>\n      {hasProject && <ExportPopover onOpenChange={setIsExportPopoverOpen} />}\n    </Popover>\n  );\n}\n\nfunction ExportPopover({\n  onOpenChange,\n}: {\n  onOpenChange: (open: boolean) => void;\n}) {\n  const { activeProject } = useProjectStore();\n  const [format, setFormat] = useState<ExportFormat>(\n    DEFAULT_EXPORT_OPTIONS.format\n  );\n  const [quality, setQuality] = useState<ExportQuality>(\n    DEFAULT_EXPORT_OPTIONS.quality\n  );\n  const [includeAudio, setIncludeAudio] = useState<boolean>(\n    DEFAULT_EXPORT_OPTIONS.includeAudio || true\n  );\n  const [isExporting, setIsExporting] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [exportResult, setExportResult] = useState<ExportResult | null>(null);\n\n  const handleExport = async () => {\n    if (!activeProject) return;\n\n    setIsExporting(true);\n    setProgress(0);\n    setExportResult(null);\n\n    const result = await exportProject({\n      format,\n      quality,\n      fps: activeProject.fps,\n      includeAudio,\n      onProgress: setProgress,\n      onCancel: () => false, // TODO: Add cancel functionality\n    });\n\n    setIsExporting(false);\n    setExportResult(result);\n\n    if (result.success && result.buffer) {\n      // Download the file\n      const mimeType = getExportMimeType(format);\n      const extension = getExportFileExtension(format);\n      const blob = new Blob([result.buffer], { type: mimeType });\n      const url = URL.createObjectURL(blob);\n\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `${activeProject.name}${extension}`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n\n      onOpenChange(false);\n      setExportResult(null);\n      setProgress(0);\n    }\n  };\n\n  const handleClose = () => {\n    if (!isExporting) {\n      onOpenChange(false);\n      setExportResult(null);\n      setProgress(0);\n    }\n  };\n\n  return (\n    <PopoverContent className=\"w-80 mr-4 flex flex-col gap-3 bg-background\">\n      <>\n        {exportResult && !exportResult.success ? (\n          <ExportError\n            error={exportResult.error || \"Unknown error occurred\"}\n            onRetry={handleExport}\n          />\n        ) : (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\" font-medium\">\n                {isExporting ? \"Exporting project\" : \"Export project\"}\n              </h3>\n              <Button variant=\"text\" size=\"icon\" onClick={handleClose}>\n                <X className=\"!size-5 text-foreground/85\" />\n              </Button>\n            </div>\n\n            <div className=\"flex flex-col gap-4\">\n              {!isExporting && (\n                <>\n                  <div className=\"flex flex-col gap-3\">\n                    <PropertyGroup\n                      title=\"Format\"\n                      titleClassName=\"text-sm\"\n                      defaultExpanded={false}\n                    >\n                      <RadioGroup\n                        value={format}\n                        onValueChange={(value) =>\n                          setFormat(value as ExportFormat)\n                        }\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"mp4\" id=\"mp4\" />\n                          <Label htmlFor=\"mp4\">\n                            MP4 (H.264) - Better compatibility\n                          </Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"webm\" id=\"webm\" />\n                          <Label htmlFor=\"webm\">\n                            WebM (VP9) - Smaller file size\n                          </Label>\n                        </div>\n                      </RadioGroup>\n                    </PropertyGroup>\n\n                    <PropertyGroup\n                      title=\"Quality\"\n                      titleClassName=\"text-sm\"\n                      defaultExpanded={false}\n                    >\n                      <RadioGroup\n                        value={quality}\n                        onValueChange={(value) =>\n                          setQuality(value as ExportQuality)\n                        }\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"low\" id=\"low\" />\n                          <Label htmlFor=\"low\">Low - Smallest file size</Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"medium\" id=\"medium\" />\n                          <Label htmlFor=\"medium\">Medium - Balanced</Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"high\" id=\"high\" />\n                          <Label htmlFor=\"high\">High - Recommended</Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"very_high\" id=\"very_high\" />\n                          <Label htmlFor=\"very_high\">\n                            Very High - Largest file size\n                          </Label>\n                        </div>\n                      </RadioGroup>\n                    </PropertyGroup>\n\n                    <PropertyGroup\n                      title=\"Audio\"\n                      titleClassName=\"text-sm\"\n                      defaultExpanded={false}\n                    >\n                      <div className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id=\"include-audio\"\n                          checked={includeAudio}\n                          onCheckedChange={(checked) =>\n                            setIncludeAudio(!!checked)\n                          }\n                        />\n                        <Label htmlFor=\"include-audio\">\n                          Include audio in export\n                        </Label>\n                      </div>\n                    </PropertyGroup>\n                  </div>\n\n                  <Button onClick={handleExport} className=\"w-full gap-2\">\n                    <Download className=\"w-4 h-4\" />\n                    Export\n                  </Button>\n                </>\n              )}\n\n              {isExporting && (\n                <div className=\"space-y-4\">\n                  <div className=\"flex flex-col\">\n                    <div className=\"text-center flex items-center justify-between\">\n                      <p className=\"text-sm text-muted-foreground mb-2\">\n                        {Math.round(progress * 100)}%\n                      </p>\n                      <p className=\"text-sm text-muted-foreground mb-2\">100%</p>\n                    </div>\n                    <Progress value={progress * 100} className=\"w-full\" />\n                  </div>\n\n                  <Button\n                    variant=\"outline\"\n                    className=\"rounded-md w-full\"\n                    onClick={() => {}}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              )}\n            </div>\n          </>\n        )}\n      </>\n    </PopoverContent>\n  );\n}\n\nfunction ExportError({\n  error,\n  onRetry,\n}: {\n  error: string;\n  onRetry: () => void;\n}) {\n  const [copied, setCopied] = useState(false);\n\n  const handleCopy = async () => {\n    await navigator.clipboard.writeText(error);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 1000);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-col gap-1.5\">\n        <p className=\"text-sm font-medium text-red-400\">Export failed</p>\n        <p className=\"text-xs text-muted-foreground\">\n          {error}\n        </p>\n      </div>\n\n      <div className=\"flex gap-2\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"flex-1 text-xs h-8\"\n          onClick={handleCopy}\n        >\n          {copied ? <Check className=\"text-green-500\" /> : <Copy />}\n          Copy\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"flex-1 text-xs h-8\"\n          onClick={onRetry}\n        >\n          <RotateCcw />\n          Retry\n        </Button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 10763, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/editor-header.tsx"],"sourcesContent":["\"use client\";\n\nimport { Button } from \"../ui/button\";\nimport { ChevronDown, ArrowLeft, SquarePen, Trash } from \"lucide-react\";\nimport { HeaderBase } from \"../header-base\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport { KeyboardShortcutsHelp } from \"../keyboard-shortcuts-help\";\nimport { useState } from \"react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"../ui/dropdown-menu\";\nimport Link from \"next/link\";\nimport { RenameProjectDialog } from \"../rename-project-dialog\";\nimport { DeleteProjectDialog } from \"../delete-project-dialog\";\nimport { useRouter } from \"next/navigation\";\nimport { FaDiscord } from \"react-icons/fa6\";\nimport { PanelPresetSelector } from \"./panel-preset-selector\";\nimport { ExportButton } from \"./export-button\";\nimport { ThemeToggle } from \"../theme-toggle\";\n\nexport function EditorHeader() {\n  const { activeProject, renameProject, deleteProject } = useProjectStore();\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n  const [isRenameDialogOpen, setIsRenameDialogOpen] = useState(false);\n  const router = useRouter();\n\n  const handleNameSave = async (newName: string) => {\n    console.log(\"handleNameSave\", newName);\n    if (activeProject && newName.trim() && newName !== activeProject.name) {\n      try {\n        await renameProject(activeProject.id, newName.trim());\n        setIsRenameDialogOpen(false);\n      } catch (error) {\n        console.error(\"Failed to rename project:\", error);\n      }\n    }\n  };\n\n  const handleDelete = () => {\n    if (activeProject) {\n      deleteProject(activeProject.id);\n      setIsDeleteDialogOpen(false);\n      router.push(\"/projects\");\n    }\n  };\n\n  const leftContent = (\n    <div className=\"flex items-center gap-2\">\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          <Button\n            variant=\"secondary\"\n            className=\"h-auto py-1.5 px-2.5 flex items-center justify-center\"\n          >\n            <ChevronDown className=\"text-muted-foreground\" />\n            <span className=\"text-[0.85rem] mr-2\">{activeProject?.name}</span>\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align=\"start\" className=\"w-40 z-100\">\n          <Link href=\"/projects\">\n            <DropdownMenuItem className=\"flex items-center gap-1.5\">\n              <ArrowLeft className=\"h-4 w-4\" />\n              Projects\n            </DropdownMenuItem>\n          </Link>\n          <DropdownMenuItem\n            className=\"flex items-center gap-1.5\"\n            onClick={() => setIsRenameDialogOpen(true)}\n          >\n            <SquarePen className=\"h-4 w-4\" />\n            Rename project\n          </DropdownMenuItem>\n          <DropdownMenuItem\n            variant=\"destructive\"\n            className=\"flex items-center gap-1.5\"\n            onClick={() => setIsDeleteDialogOpen(true)}\n          >\n            <Trash className=\"h-4 w-4\" />\n            Delete Project\n          </DropdownMenuItem>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem asChild>\n            <Link\n              href=\"https://discord.gg/zmR9N35cjK\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"flex items-center gap-1.5\"\n            >\n              <FaDiscord className=\"h-4 w-4\" />\n              Discord\n            </Link>\n          </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n      <RenameProjectDialog\n        isOpen={isRenameDialogOpen}\n        onOpenChange={setIsRenameDialogOpen}\n        onConfirm={handleNameSave}\n        projectName={activeProject?.name || \"\"}\n      />\n      <DeleteProjectDialog\n        isOpen={isDeleteDialogOpen}\n        onOpenChange={setIsDeleteDialogOpen}\n        onConfirm={handleDelete}\n        projectName={activeProject?.name || \"\"}\n      />\n    </div>\n  );\n\n  const rightContent = (\n    <nav className=\"flex items-center gap-2\">\n      <PanelPresetSelector />\n      <KeyboardShortcutsHelp />\n      <ExportButton />\n      <ThemeToggle />\n    </nav>\n  );\n\n  return (\n    <HeaderBase\n      leftContent={leftContent}\n      rightContent={rightContent}\n      className=\"bg-background h-[3.2rem] px-3 items-center mt-0.5\"\n    />\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 11040, "column": 0}, "map": {"version":3,"sources":["file:///C:/shawn/1code/1project-cur/video-remake/clip/OpenCut-main/apps/web/src/components/editor/onboarding.tsx"],"sourcesContent":["\"use client\";\n\nimport { Dialog, DialogContent, DialogTitle } from \"../ui/dialog\";\nimport { Button } from \"../ui/button\";\nimport { ArrowRightIcon } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\n\nexport function Onboarding() {\n  const [step, setStep] = useState(0);\n  const [isOpen, setIsOpen] = useState(false);\n\n  useEffect(() => {\n    const hasSeenOnboarding = localStorage.getItem(\"hasSeenOnboarding\");\n    if (!hasSeenOnboarding) {\n      setIsOpen(true);\n    }\n  }, []);\n\n  const handleNext = () => {\n    setStep(step + 1);\n  };\n\n  const handleClose = () => {\n    setIsOpen(false);\n    localStorage.setItem(\"hasSeenOnboarding\", \"true\");\n  };\n\n  const getStepTitle = () => {\n    switch (step) {\n      case 0:\n        return \"Welcome to OpenCut Beta! 🎉\";\n      case 1:\n        return \"⚠️ This is a super early beta!\";\n      case 2:\n        return \"🦋 Have fun testing!\";\n      default:\n        return \"OpenCut Onboarding\";\n    }\n  };\n\n  const renderStepContent = () => {\n    switch (step) {\n      case 0:\n        return (\n          <div className=\"space-y-5\">\n            <div className=\"space-y-3\">\n              <Title title=\"Welcome to OpenCut Beta! 🎉\" />\n              <Description description=\"You're among the first to try OpenCut - the fully open source CapCut alternative.\" />\n            </div>\n            <NextButton onClick={handleNext}>Next</NextButton>\n          </div>\n        );\n      case 1:\n        return (\n          <div className=\"space-y-5\">\n            <div className=\"space-y-3\">\n              <Title title={getStepTitle()} />\n              <Description description=\"OpenCut started just one month ago. There's still a ton of things to do to make this editor amazing.\" />\n              <Description description=\"A lot of features are still missing, like the export functionality. We're working hard to build them out!\" />\n              <Description description=\"If you're curious, check out our roadmap [here](https://opencut.app/roadmap)\" />\n            </div>\n            <NextButton onClick={handleNext}>Next</NextButton>\n          </div>\n        );\n      case 2:\n        return (\n          <div className=\"space-y-5\">\n            <div className=\"space-y-3\">\n              <Title title={getStepTitle()} />\n              <Description description=\"Join our [Discord](https://discord.gg/zmR9N35cjK), chat with cool people and share feedback to help make OpenCut the best editor ever.\" />\n            </div>\n            <NextButton onClick={handleClose}>Finish</NextButton>\n          </div>\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[425px] !outline-none pt-2\">\n        <DialogTitle>\n          <span className=\"sr-only\">{getStepTitle()}</span>\n        </DialogTitle>\n        {renderStepContent()}\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction Title({ title }: { title: string }) {\n  return <h2 className=\"text-lg md:text-xl font-bold\">{title}</h2>;\n}\n\nfunction Subtitle({ subtitle }: { subtitle: string }) {\n  return <h3 className=\"text-lg font-medium\">{subtitle}</h3>;\n}\n\nfunction Description({ description }: { description: string }) {\n  return (\n    <div className=\"text-muted-foreground\">\n      <ReactMarkdown\n        components={{\n          p: ({ children }) => <p className=\"mb-0\">{children}</p>,\n          a: ({ href, children }) => (\n            <a\n              href={href}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-foreground hover:text-foreground/80 underline\"\n            >\n              {children}\n            </a>\n          ),\n        }}\n      >\n        {description}\n      </ReactMarkdown>\n    </div>\n  );\n}\n\nfunction NextButton({\n  children,\n  onClick,\n}: {\n  children: React.ReactNode;\n  onClick: () => void;\n}) {\n  return (\n    <Button onClick={onClick} variant=\"default\" className=\"w-full\">\n      {children}\n      <ArrowRightIcon className=\"w-4 h-4\" />\n    </Button>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAQO,SAAS;IACd,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,0QAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,0QAAA,CAAA,WAAQ,AAAD,EAAE;IAErC,CAAA,GAAA,0QAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,oBAAoB,aAAa,OAAO,CAAC;QAC/C,IAAI,CAAC,mBAAmB;YACtB,UAAU;QACZ;IACF,GAAG,EAAE;IAEL,MAAM,aAAa;QACjB,QAAQ,OAAO;IACjB;IAEA,MAAM,cAAc;QAClB,UAAU;QACV,aAAa,OAAO,CAAC,qBAAqB;IAC5C;IAEA,MAAM,eAAe;QACnB,OAAQ;YACN,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT;gBACE,OAAO;QACX;IACF;IAEA,MAAM,oBAAoB;QACxB,OAAQ;YACN,KAAK;gBACH,qBACE,mTAAC;oBAAI,WAAU;;sCACb,mTAAC;4BAAI,WAAU;;8CACb,mTAAC;oCAAM,OAAM;;;;;;8CACb,mTAAC;oCAAY,aAAY;;;;;;;;;;;;sCAE3B,mTAAC;4BAAW,SAAS;sCAAY;;;;;;;;;;;;YAGvC,KAAK;gBACH,qBACE,mTAAC;oBAAI,WAAU;;sCACb,mTAAC;4BAAI,WAAU;;8CACb,mTAAC;oCAAM,OAAO;;;;;;8CACd,mTAAC;oCAAY,aAAY;;;;;;8CACzB,mTAAC;oCAAY,aAAY;;;;;;8CACzB,mTAAC;oCAAY,aAAY;;;;;;;;;;;;sCAE3B,mTAAC;4BAAW,SAAS;sCAAY;;;;;;;;;;;;YAGvC,KAAK;gBACH,qBACE,mTAAC;oBAAI,WAAU;;sCACb,mTAAC;4BAAI,WAAU;;8CACb,mTAAC;oCAAM,OAAO;;;;;;8CACd,mTAAC;oCAAY,aAAY;;;;;;;;;;;;sCAE3B,mTAAC;4BAAW,SAAS;sCAAa;;;;;;;;;;;;YAGxC;gBACE,OAAO;QACX;IACF;IAEA,qBACE,mTAAC,iJAAA,CAAA,SAAM;QAAC,MAAM;QAAQ,cAAc;kBAClC,cAAA,mTAAC,iJAAA,CAAA,gBAAa;YAAC,WAAU;;8BACvB,mTAAC,iJAAA,CAAA,cAAW;8BACV,cAAA,mTAAC;wBAAK,WAAU;kCAAW;;;;;;;;;;;gBAE5B;;;;;;;;;;;;AAIT;AAEA,SAAS,MAAM,EAAE,KAAK,EAAqB;IACzC,qBAAO,mTAAC;QAAG,WAAU;kBAAgC;;;;;;AACvD;AAEA,SAAS,SAAS,EAAE,QAAQ,EAAwB;IAClD,qBAAO,mTAAC;QAAG,WAAU;kBAAuB;;;;;;AAC9C;AAEA,SAAS,YAAY,EAAE,WAAW,EAA2B;IAC3D,qBACE,mTAAC;QAAI,WAAU;kBACb,cAAA,mTAAC,0QAAA,CAAA,UAAa;YACZ,YAAY;gBACV,GAAG,CAAC,EAAE,QAAQ,EAAE,iBAAK,mTAAC;wBAAE,WAAU;kCAAQ;;;;;;gBAC1C,GAAG,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,iBACpB,mTAAC;wBACC,MAAM;wBACN,QAAO;wBACP,KAAI;wBACJ,WAAU;kCAET;;;;;;YAGP;sBAEC;;;;;;;;;;;AAIT;AAEA,SAAS,WAAW,EAClB,QAAQ,EACR,OAAO,EAIR;IACC,qBACE,mTAAC,iJAAA,CAAA,SAAM;QAAC,SAAS;QAAS,SAAQ;QAAU,WAAU;;YACnD;0BACD,mTAAC,uSAAA,CAAA,iBAAc;gBAAC,WAAU;;;;;;;;;;;;AAGhC","debugId":null}}]
}